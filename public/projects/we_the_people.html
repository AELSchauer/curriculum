
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>We The People - Jumpstart Lab Curriculum</title>
  <meta name="author" content="Jumpstart Lab">

  
  <meta name="description" content="We The People                              IntroductionWe the People seeks to &quot;[give] all Americans a way to &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tutorials.jumpstartlab.com/projects/we_the_people.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet" type="text/css">

  <link href="/atom.xml" rel="alternate" title="Jumpstart Lab Curriculum" type="application/atom+xml">

  <!-- TAB SLIDE OUT -->
  <script src="/javascripts/jquery-1.3.2.min.js" type="text/javascript"></script>
  <script src="/javascripts/jquery.tabSlideOut.v1.3.js"></script>

  <!-- SEARCH -->
  <script src="/search.js"></script>

  <script type="text/javascript">
    $(function(){
      $('.slide-out-div').tabSlideOut({
        tabHandle: '.handle',                     //class of the element that will become your tab
        pathToTabImage: '/images/feedback_tabv2.png', //path to the image for the tab //Optionally can be set using css
        imageHeight: '130px',                     //height of tab image           //Optionally can be set using css
        imageWidth: '36px',                       //width of tab image            //Optionally can be set using css
        tabLocation: 'left',                      //side of screen where tab lives, top, right, bottom, or left
        speed: 300,                               //speed of animation
        action: 'click',                          //options: 'click' or 'hover', action to trigger animation
        topPos: '200px',                          //position from the top/ use if tabLocation is left or right
        leftPos: '20px',                          //position from left/ use if tabLocation is bottom or top
        fixedPosition: true                      //options: true makes it stick(fixed position) on scroll
        });
      });
  </script>

  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body  >
  <header role="banner">
    <hgroup>
  <h1>Jumpstart Lab Curriculum</h1>
  
</hgroup>

  </header>

  <nav role="navigation">
    <ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tutorials.jumpstartlab.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>

<ul class="main-navigation">
  <li><a href="/">Curriculum Index</a></li>
  <li><div id="search">
  <form>
    <input type="text" id="st-search-input" class="st-search-input" />
  </form>
</div>
</li>
</ul>
  </nav>

  <div id="main">
    <div id="content">
      <div>
  <article role="article">
    
    
      <header>
        <h1 class="entry-title">
          We The People
        </h1>
        
      </header>
    
    <h2>Introduction</h2>

<p><a href="https://petitions.whitehouse.gov/">We the People</a> seeks to &quot;[give] all Americans a way to engage their government on the issues that matter to them.&quot; The application provides an <a href="">API</a> which allows us to both read existing data and write new data to the application.</p>

<p>Jeremy McAnally and a team of contributors created the <a href="https://github.com/jm/we_the_people">We the People Gem</a> to make it easy for Ruby developers to ignore many of the details of accessing the API. The library uses <a href="https://github.com/archiloque/rest-client">RestClient</a> to encapsulate the details of communication over HTTP.</p>

<p>Within the library itself, you have two options:</p>

<ol>
<li>Use the <em>simple</em> access tools, which return you just raw Ruby hashes. It&#8217;s then up to you to pick through the keys, values, and nested data. This approach is simple to get started, relatively robust over time as the API changes, but leads to reading a lot of hash-soup.</li>
<li>Use the <em>resources</em> objects, which model the data from the API into logical Ruby objects (like petition data becoming a <code>WeThePeople::Resources::Petition</code>). This approach means reading/learning more of the gem&#8217;s structure upfront, slightly more brittleness if the API changes, but more readable and maintainable Ruby code.</li>
</ol>

<p>Let&#8217;s take a look at each approach.</p>

<h2>General Setup</h2>

<p>There are just a few small steps to get going.</p>

<h3>Environment Configuration</h3>

<h4>Ruby Version</h4>

<p>This tutorial assumes that you&#8217;re using Ruby version 1.9.3. Validate your Ruby version by:</p>

<ul>
<li>Opening your <strong>Terminal</strong> on Mac OS X (Applications &gt; Utilities &gt; Terminal) or <strong>Command Prompt</strong> on Windows (Start &gt; Run &gt; cmd)</li>
<li>Run <code>ruby -v</code> like below and observe the output:</li>
</ul>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>ruby -v</span><span class='line output'>ruby 1.9.3p327 (2012-11-10 revision 37606) [x86_64-darwin12.2.0]</span></code></pre></td></tr></table></div></div>
        </div>

<p>If you get an older version (like Ruby 1.8.7) or an error (like <code>-bash: ruby: command not found</code>) then your need to install/update Ruby. Hop over to our <a href="http://tutorials.jumpstartlab.com/topics/environment/environment.html">Environment Setup Tutorial</a> to get your system ready to go.</p>

<h4>Editor</h4>

<p>You&#8217;ll need a text editor to write your code. We recommend <a href="http://www.sublimetext.com/">SublimeText</a>.</p>

<h3>Install the Gem</h3>

<h4>Traditional Installation</h4>

<p>The gem is available on <a href="http://rubygems.org">Rubygems</a>, so it can be installed from your Terminal:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>gem install we_the_people</span></code></pre></td></tr></table></div></div>
        </div>

<p><strong>But</strong>, it&#8217;s best to manage your gems using <strong>Bundler</strong>.</p>

<h4>Using Bundler</h4>

<h5>Install the Latest Released Version</h5>

<p>If you&#8217;re creating a significant Ruby project you want to use <a href="http://gembundler.com">Bundler</a>. In your project directory, create a file named <code>Gemfile</code> with these contents:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;we_the_people&#39;</span>
</span></code></pre></td></tr></table></div></figure>

<h5>Edge Gem</h5>

<p>Want to live on the edge, building the gem directly from the source on GitHub? Modify your <code>Gemfile</code> to point directly to the repository on GitHub:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;we_the_people&#39;</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s2">&quot;git@github.com:jm/we_the_people.git&quot;</span>
</span></code></pre></td></tr></table></div></figure>

<h5>Process the <code>Gemfile</code></h5>

<p>From your terminal, run <code>bundle</code> to install the gem and dependencies:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<br></pre></td><td class='code'><pre><code><span class='line command'>bundle</span><span class='line output'>Updating git@github.com:jm/we_the_people.git</span><span class='line output'>Fetching gem metadata from https://rubygems.org/..........</span><span class='line output'>Fetching gem metadata from https://rubygems.org/..</span><span class='line output'>Installing activesupport (3.0.0)</span><span class='line output'>Installing active_support (3.0.0)</span><span class='line output'>Installing json (1.7.7) with native extensions</span><span class='line output'>Installing mime-types (1.21)</span><span class='line output'>Using rest-client (1.6.7)</span><span class='line output'>Using we_the_people (0.0.2) from git@github.com:jm/we_the_people.git (at master)</span><span class='line output'>Using bundler (1.2.3)</span><span class='line output'>Your bundle is complete! Use `bundle show [gemname]` to see where a bundled gem is installed.</span></code></pre></td></tr></table></div></div>
        </div>

<h3>Register for an API Key</h3>

<p>[ Instructions for registering for an API key forthcoming ]</p>

<h4>Demo API Key</h4>

<p>Until you have a person API key, you can use <code>your_api_key_here</code>.</p>

<h3>Proof of Concept</h3>

<p>Let&#8217;s run through a short IRB session to prove that things are wired up correctly.</p>

<p>Start up an IRB session:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>bundle exec irb</span></code></pre></td></tr></table></div></div>
        </div>

<p>The once you&#8217;re inside IRB, set your API key and a specific petition:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<br><span class='line-number'>&nbsp;</span>
<br><br><br><br><br><br><br><br><br><br><br><br><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line output'>1.9.3-p327 :001 &gt; require 'we_the_people'</span><span class='line output'>=&gt; true</span><span class='line output'>1.9.3-p327 :002 &gt; WeThePeople::Config.api_key = "your_api_key_here"</span><span class='line output'>=&gt; "your_api_key_here"</span><span class='line output'>1.9.3-p327 :003 &gt; petition = WeThePeople::Resources::Petition.find('50a3fd762f2c88cd65000015')</span><span class='line output'>=&gt; #&lt;WeThePeople::Resources::Petition:0x007fc523699d90 @parent=nil, @attributes={"id"=&gt;"50a3fd762f2c88cd65000015", "type"=&gt;"petition", "title"=&gt;"Secure resources and funding, and begin construction of a Death Star by 2016.", "body"=&gt;"Those who sign here petition the United States government to secure funding and resources, and begin construction on a Death Star by 2016.\r\n\r\nBy focusing our defense resources into a space-superiority platform and weapon system such as a Death Star, the government can spur job creation in the fields of construction, engineering, space exploration, and more, and strengthen our national defense.\r\n\r\n", "status"=&gt;"responded", "deadline"=&gt;1355516534, "created"=&gt;1352924534, "response"=&gt;#&lt;struct WeThePeople::Resources::Response id="716", url="https://petitions.whitehouse.gov/response/isnt-petition-response-youre-looking"&gt;, "issues"=&gt;[#&lt;struct WeThePeople::Resources::Issue id="12", name="Defense"&gt;, #&lt;struct WeThePeople::Resources::Issue id="97", name="Job Creation"&gt;, #&lt;struct WeThePeople::Resources::Issue id="139", name="Science and Space Policy"&gt;]}&gt;</span><span class='line output'>1.9.3-p327 :04 &gt; petition.title</span><span class='line output'>=&gt; "Secure resources and funding, and begin construction of a Death Star by 2016."</span></code></pre></td></tr></table></div></div>
        </div>

<p>Tada!</p>

<h2>Understanding the API</h2>

<p>Let&#8217;s back up and dig into the details of this all works.</p>

<h3>API Structure</h3>

<p>The We The People API, like most HTTP-based APIs, uses JSON to communicate. You, or your program, puts together a carefully formatted HTTP request, submits it to the server, and gets back a package of JSON data.</p>

<p>For example, use a web browser like Chrome to visit this URL:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>https://petitions.whitehouse.gov/api/v1/petitions/50a3fd762f2c88cd65000015.json?limit=100&offset=0&key=your_api_key_here</span></code></pre></td></tr></table></div></figure>

<p>You should see a JSON response like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'>{"metadata":{"execution time":0},"results":[{"id":"50a3fd762f2c88cd65000015","type":"petition","title":"Secure resources and funding, and begin construction of a Death Star by 2016.","body":"Those who sign here petition the United States government to secure funding and resources, and begin construction on a Death Star by 2016.\r\n\r\nBy focusing our defense resources into a space-superiority platform and weapon system such as a Death Star, the government can spur job creation in the fields of construction, engineering, space exploration, and more, and strengthen our national defense.\r\n\r\n","issues":[{"id":"12","name":"Defense"},{"id":"97","name":"Job Creation"},{"id":"139","name":"Science and Space Policy"}],"signature threshold":25000,"signature count":34435,"signatures needed":0,"url":"https://petitions.whitehouse.gov/petition/secure-resources-and-funding-and-begin-construction-death-star-2016/wlfKzFkN","deadline":1355516534,"status":"responded","response":{"id":"716","url":"https://petitions.whitehouse.gov/response/isnt-petition-response-youre-looking","association time":"1357944472"},"created":1352924534}]}</span></code></pre></td></tr></table></div></figure>

<h4>Picking Apart the URL</h4>

<p>Let&#8217;s look at the components of the request URL</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>https://petitions.whitehouse.gov/api/v1/petitions/50a3fd762f2c88cd65000015.json?key=your_api_key_here</span></code></pre></td></tr></table></div></figure>

<p>Broken down:</p>

<ul>
<li><code>https://</code> &#8211; the browser is communicating with the server using the HTTPS protocol</li>
<li><code>petitions.whitehouse.gov</code> &#8211; the server or computer that is actually running the We The People application</li>
<li><code>api/v1/</code> &#8211; all API calls are run under this folder or &quot;namespace&quot;</li>
<li><code>petitions/</code> &#8211; we&#8217;re looking at petitions</li>
<li><code>50a3fd762f2c88cd65000015</code> &#8211; the unique ID of the petition we&#8217;re interested in</li>
<li><code>.json</code> &#8211; we&#8217;d like the response formatted in JSON</li>
<li><code>?key=your_api_key_here</code> &#8211; we identify our request with our unique API key, obtained earlier</li>
</ul>

<p>Using this URL structure, you could manually request the details of any presentation if you know the ID number. For instance, substituting in another ID:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>https://petitions.whitehouse.gov/api/v1/petitions/5057ad98adfd95100b000008.json?key=your_api_key_here</span></code></pre></td></tr></table></div></figure>

<p>Which retrieves the JSON details about that second petition.</p>

<h4>API Endpoints</h4>

<p>The API offers dozens of &quot;endpoints&quot; &#8211; URLs that you can access to retrieve data.</p>

<h4>So this is all about URLs?</h4>

<p>Experimenting with a few URLs manually is a great way to get your feet wet with the API, but it&#8217;s not practical for building code. Instead, we&#8217;ll use the gem library to automate requests and processing of the responses.</p>

<p>But whenever you&#8217;re using an HTTP-based API, remember that there&#8217;s no real magic going on: it&#8217;s just a carefully constructed web request, just like any other page you visit on the web.</p>

<h4>Why Use a Gem?</h4>

<p>There are three main reasons to use an API wrapper gem:</p>

<h5>Insulation</h5>

<p>Manipulating URLs by hand is error-prone and fragile. Imagine that you write a big program using dozens of URLs representing API endpoints. Then the We The People team decides to change the URL structure! You might have to rewrite large parts of your application.</p>

<p>Gem gem wrapper provides a <em>layer of abstraction</em>. If your program depends on and utilizes the gem, then a few small changes in the gem can make up for massive changes in the API. Ideally, as a gem user you might not even need to know that the API changed. The gem can insulate you from the API.</p>

<h5>Ignore Transport Details</h5>

<p>But more importantly, API gems provide a way to ignore the HTTP details. Without the gem, you might think &quot;I need to make a request to <em>X</em> endpoint, using <em>Y</em> URL format, with <em>Z</em> parameters, then parse the response JSON and find the data I need.&quot; You&#8217;re likely to make typos in the URLs, maybe not get the parameters quite right, etc. Your implementation is mostly about manipulating strings and trying to make sense of the data.</p>

<h5>Think In Domain Objects</h5>

<p>Many API gems, beyond the other two uses, allow you to think in domain objects. Instead of concerning yourself with URL details and JSON, you can think in domain objects: &quot;I want to fetch a petition and find it&#8217;s current number of signatures.&quot;</p>

<p>The <code>we_the_people</code> gem allows you to insulate yourself from the API, ignore the transport details, and (optionally) work in domain objects.</p>

<h2>Simple API Access</h2>

<p>Let&#8217;s first look at the lower level gem usage which just allows us to ignore the URL/HTTP details.</p>

<p>We&#8217;ll use the <code>WeThePeople::Simple</code> object. It helps us make the HTTP requests and returns raw JSON.</p>

<h3>An Example</h3>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>2.1.1 :001&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<br><br><br><br><br><br><br><br><br><br><br><br><br></pre></td><td class='code'><pre><code><span class='line command'>bundle exec irb</span><span class='line output'>&gt; require 'we_the_people'</span><span class='line output'>=&gt; true</span><span class='line output'>&gt; require 'we_the_people/simple'</span><span class='line output'>=&gt; true</span><span class='line output'>&gt; WeThePeople::Config.api_key = "your_api_key_here"</span><span class='line output'>=&gt; "your_api_key_here"</span><span class='line output'>&gt; petition = WeThePeople::Simple.petition("50a3fd762f2c88cd65000015")</span><span class='line output'>=&gt; {"id"=&gt;"50a3fd762f2c88cd65000015", "type"=&gt;"petition", "title"=&gt;"Secure resources and funding, and begin construction of a Death Star by 2016.", "body"=&gt;"Those who sign here petition the United States government to secure funding and resources, and begin construction on a Death Star by 2016.\r\n\r\nBy focusing our defense resources into a space-superiority platform and weapon system such as a Death Star, the government can spur job creation in the fields of construction, engineering, space exploration, and more, and strengthen our national defense.\r\n\r\n", "issues"=&gt;[{"id"=&gt;"12", "name"=&gt;"Defense"}, {"id"=&gt;"97", "name"=&gt;"Job Creation"}, {"id"=&gt;"139", "name"=&gt;"Science and Space Policy"}], "signature threshold"=&gt;25000, "signature count"=&gt;34435, "signatures needed"=&gt;0, "url"=&gt;"https://petitions.whitehouse.gov/petition/secure-resources-and-funding-and-begin-construction-death-star-2016/wlfKzFkN", "deadline"=&gt;1355516534, "status"=&gt;"responded", "response"=&gt;{"id"=&gt;"716", "url"=&gt;"https://petitions.whitehouse.gov/response/isnt-petition-response-youre-looking", "association time"=&gt;"1357944472"}, "created"=&gt;1352924534}</span></code></pre></td></tr></table></div></div>
        </div>

<p>See that result? By the leading <code>{</code> and trailing <code>}</code> you can see it&#8217;s a Ruby hash. You can navigate that hash to find the data you&#8217;re looking for:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line output'>&gt; petition["title"]</span><span class='line output'>=&gt; "Secure resources and funding, and begin construction of a Death Star by 2016."</span></code></pre></td></tr></table></div></div>
        </div>

<h3>Digging In To Signatures</h3>

<p>Or maybe you want to find information about the signatures on that petition:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<br><br><br><span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line output'>&gt; sigs = WeThePeople::Simple.signatures("50a3fd762f2c88cd65000015")</span><span class='line output'>=&gt; [{"id"=&gt;"50f0b6637043013f5d000005", "type"=&gt;"signature", "name"=&gt;"EZ", "zip"=&gt;"07940", "created"=&gt;1357952611}, {"id"=&gt;"50f0b56e2f2c88ff3700000b", "type"=&gt;"signature", "name"=&gt;"JY", "zip"=&gt;nil, "created"=&gt;1357952366}, {"id"=&gt;"50f0b554c988d4551e000004", "type"=&gt;"signature", "name"=&gt;"cc", "zip"=&gt;</span><span class='line output'>...</span></code></pre></td></tr></table></div></div>
        </div>

<p>That&#8217;s a huge chunk of data!</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<br></pre></td><td class='code'><pre><code><span class='line output'>&gt; sigs.count</span><span class='line output'>=&gt; 1000</span><span class='line output'>&gt; sigs.class</span><span class='line output'>=&gt; Array</span><span class='line output'>&gt; sigs.first</span><span class='line output'>=&gt; {"id"=&gt;"50f0b6637043013f5d000005", "type"=&gt;"signature", "name"=&gt;"EZ", "zip"=&gt;"07940", "created"=&gt;1357952611}</span></code></pre></td></tr></table></div></div>
        </div>

<p>Specifically it&#8217;s 1000 signitures from that petition, which we see are collected in an <code>Array</code>. Looking at the first element of the array, it&#8217;s a hash with keys <code>&quot;id&quot;</code>, <code>&quot;type&quot;</code>, <code>&quot;name&quot;</code>, <code>&quot;zip&quot;</code>, and <code>&quot;created&quot;</code>. </p>

<h4>Top Zipcodes</h4>

<p>What could we do with that? How about &quot;find the top 10 zipcodes with the most signitures&quot;:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line output'>&gt; zipcodes = sigs.collect{|sig| sig['zip']}</span><span class='line output'>=&gt; ["07940", nil, "02769", " 20181", "21040", "80814", "95624", "30518", #...</span><span class='line output'>&gt; grouped_zipcodes = zipcodes.group_by{|zip| zip.to_s.strip}</span><span class='line output'>=&gt; {"07940"=&gt;["07940"], "02769"=&gt;["02769"], #...</span><span class='line output'>&gt; sorted_groups = grouped_zipcodes.sort_by{|zipcode, instances| instances.count}</span><span class='line output'>=&gt; [["07940", ["07940"]], ["80040-070", ["80040-070"]], ["02769", ["02769"]], #...</span><span class='line output'>&gt; highest_groups_first = sorted_groups.reverse</span><span class='line output'>=&gt; [["", [nil, nil, nil, nil, #...</span><span class='line output'>&gt; top_ten = highest_groups_first.take(10)</span><span class='line output'>=&gt; [["", [nil, nil, nil, nil, #...</span><span class='line output'>&gt; top_ten.each do |zipcode, instances|</span><span class='line output'>&gt;   puts "#{zipcode} (#{instances.count})"</span><span class='line output'>&gt; end</span><span class='line output'>(112)</span><span class='line output'>32780 (4)</span><span class='line output'>43068 (4)</span><span class='line output'>44256 (3)</span><span class='line output'>80918 (3)</span><span class='line output'>14450 (3)</span><span class='line output'>20850 (3)</span><span class='line output'>91342 (3)</span><span class='line output'>90210 (3)</span><span class='line output'>45241 (2)</span></code></pre></td></tr></table></div></div>
        </div>

<p>Which shows us that, among the first 1000 signatures, 112 of them recorded no zipcode, four of them were from 32780, etc.</p>

<h4>But with ALL the Signatures</h4>

<p>But then you want <em>all</em> the signatures, not just the first 1000. Add an <code>offset</code> option to the <code>signatures</code> method, fetching 1000 signatures at a time:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">id</span> <span class="o">=</span> <span class="s2">&quot;50a3fd762f2c88cd65000015&quot;</span>
</span><span class='line'><span class="n">all_signatures</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'><span class="n">response</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'><span class="k">until</span> <span class="n">response</span> <span class="o">==</span> <span class="o">[]</span>
</span><span class='line'>  <span class="n">response</span> <span class="o">=</span> <span class="no">WeThePeople</span><span class="o">::</span><span class="no">Simple</span><span class="o">.</span><span class="n">signatures</span><span class="p">(</span><span class="s2">&quot;50a3fd762f2c88cd65000015&quot;</span><span class="p">,</span> <span class="ss">:offset</span> <span class="o">=&gt;</span> <span class="mi">1000</span><span class="o">*</span><span class="n">counter</span><span class="p">)</span>
</span><span class='line'>  <span class="n">all_signatures</span> <span class="o">=</span> <span class="n">all_signatures</span> <span class="o">+</span> <span class="n">response</span>
</span><span class='line'>  <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>At the time of this writing, this process takes a few minutes to make over 30 API requests. Then follow it with the same process as before:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">zipcodes</span> <span class="o">=</span> <span class="n">all_signatures</span><span class="o">.</span><span class="n">collect</span><span class="p">{</span><span class="o">|</span><span class="n">sig</span><span class="o">|</span> <span class="n">sig</span><span class="o">[</span><span class="s1">&#39;zip&#39;</span><span class="o">]</span><span class="p">}</span>
</span><span class='line'><span class="n">grouped_zipcodes</span> <span class="o">=</span> <span class="n">zipcodes</span><span class="o">.</span><span class="n">group_by</span><span class="p">{</span><span class="o">|</span><span class="n">zip</span><span class="o">|</span> <span class="n">zip</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">strip</span><span class="p">}</span>
</span><span class='line'><span class="n">sorted_groups</span> <span class="o">=</span> <span class="n">grouped_zipcodes</span><span class="o">.</span><span class="n">sort_by</span><span class="p">{</span><span class="o">|</span><span class="n">zipcode</span><span class="p">,</span> <span class="n">instances</span><span class="o">|</span> <span class="n">instances</span><span class="o">.</span><span class="n">count</span><span class="p">}</span>
</span><span class='line'><span class="n">highest_groups_first</span> <span class="o">=</span> <span class="n">sorted_groups</span><span class="o">.</span><span class="n">reverse</span>
</span><span class='line'><span class="n">top_ten</span> <span class="o">=</span> <span class="n">highest_groups_first</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span class='line'><span class="n">top_ten</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">zipcode</span><span class="p">,</span> <span class="n">instances</span><span class="o">|</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">zipcode</span><span class="si">}</span><span class="s2"> (</span><span class="si">#{</span><span class="n">instances</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span class='line'><span class="k">end</span><span class="p">;</span> <span class="kp">nil</span>
</span></code></pre></td></tr></table></div></figure>

<p>Which, when run against the full set of signatures, would create this list:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> (4877)
</span><span class='line'>90210 (107)
</span><span class='line'>85281 (24)
</span><span class='line'>10001 (22)
</span><span class='line'>98052 (22)
</span><span class='line'>12345 (21)
</span><span class='line'>98034 (20)
</span><span class='line'>47906 (20)
</span><span class='line'>66062 (19)
</span><span class='line'>48104 (19)</span></code></pre></td></tr></table></div></figure>

<p>Almost 5000 had no zipcode stored, while we learn that Beverly Hills is <em>very</em> interested in death stars.</p>

<h3>Next Steps</h3>

<p>If you enjoy working with Ruby hashes and Arrays, dig into the <a href="https://github.com/jm/we_the_people/blob/master/lib/we_the_people/simple.rb"><code>WeThePeople::Simple</code> source code</a> and you&#8217;ll find all the different end points it supports.</p>

<h2>Resource Objects API Access</h2>

<p>Digging through hashes is a bit of a pain. Let&#8217;s step up a level of abstraction and deal with domain objects.</p>

<h2>Example Data Access</h2>

<p>In the <code>WeThePeople</code> gem there are classes collected under the namespace <code>Resource</code>:</p>

<p><a href="https://github.com/jm/we_the_people/tree/master/lib/we_the_people/resources">https://github.com/jm/we_the_people/tree/master/lib/we_the_people/resources</a></p>

<p>Each class represents a domain object in the We the People system. Let&#8217;s explore&#8230;</p>

<h3>Finding with <code>Petition</code></h3>

<p>Starting a fresh IRB session:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line output'>we_the_people ⚡ bundle exec irb</span><span class='line output'>&gt; require 'we_the_people'</span><span class='line output'>=&gt; true</span><span class='line output'>&gt; WeThePeople::Config.api_key = "your_api_key_here"</span><span class='line output'>=&gt; "your_api_key_here"</span><span class='line output'>&gt; petition = WeThePeople::Resources::Petition.find('50a3fd762f2c88cd65000015')</span><span class='line output'>=&gt; #&lt;WeThePeople::Resources::Petition:0x007f88d3c16548 #...</span></code></pre></td></tr></table></div></div>
        </div>

<p>When using the <code>Simple</code> fetcher, you got back a hash. Now the response looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#&lt;WeThePeople::Resources::Petition:0x007</span></code></pre></td></tr></table></div></figure>

<p>Which shows you that it&#8217;s an instance of the <code>WeThePeople::Resources::Petition</code> class. You could <a href="https://github.com/jm/we_the_people/blob/master/lib/we_the_people/resources/petition.rb">browse the source of that class</a>, and see that there are many attributes available including:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line output'>&gt; p.signature_threshold</span><span class='line output'>=&gt; 25000</span><span class='line output'>&gt; p.signature_count</span><span class='line output'>=&gt; 38023</span><span class='line output'>&gt; p.status</span><span class='line output'>=&gt; "responded"</span></code></pre></td></tr></table></div></div>
        </div>

<p>That&#8217;s a little cleaner and easier than digging through Hash keys. And, in the case of <code>signature_threshold</code> and <code>signature_count</code>, you can see they values have been converted to integers where the hash would have simply given strings. </p>

<p>If you looked at the data as it comes back in JSON form, the <code>deadline</code> attribute comes back at <code>&quot;1350515352&quot;</code>. What is that? It&#8217;s the time offset since the Unix epoch:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line output'>&gt; Time.at("1350515352".to_i)</span><span class='line output'>=&gt; 2012-10-17 19:09:12 -0400</span></code></pre></td></tr></table></div></div>
        </div>

<p>It&#8217;d be a pain to remembwer to do this conversion every time you use a date from the response, but the <code>Petition</code> object does the tedius work for you:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line output'>&gt; p.deadline</span><span class='line output'>=&gt; 2012-10-17 19:09:12 -0400</span><span class='line output'>&gt; p.deadline.class</span><span class='line output'>=&gt; Time</span></code></pre></td></tr></table></div></div>
        </div>

<p>Instead of giving you back the offset, when you call the <code>deadline</code> method you get back an instance of Ruby&#8217;s <code>Time</code> class which is much more useful.</p>

<h3>Associated Objects</h3>

<p>Beyond just attribute manipulation, the <code>Resource</code> objects are able to navigate between relationships:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line output'>&gt; p = WeThePeople::Resources::Petition.find("5057ad98adfd95100b000008")</span><span class='line output'>=&gt; #&lt;WeThePeople::Resources::Petition:0x007fde79591410 @parent=nil #...</span><span class='line output'>&gt; p.response.url</span><span class='line output'>=&gt; "https://petitions.whitehouse.gov/response/addressing-freedoms-speech-and-religion"</span></code></pre></td></tr></table></div></div>
        </div>

<p>We get the URL of the official response to the petition. Did it require another API request? Was it embedded in the JSON about the <code>Petition</code>? We don&#8217;t have to know or care &#8211; the gem&#8217;s domain models hide that complexity from you.</p>

<h2>Sample Problems</h2>

<p>Let&#8217;s solve some realistic questions assuming:</p>

<ul>
<li>Code is running inside IRB or as a Ruby script</li>
<li>The API key has already been set</li>
</ul>

<h3>What are the most popular petitions posted in the last week?</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">begin</span>
</span><span class='line'>  <span class="n">one_week</span> <span class="o">=</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">7</span>  <span class="c1"># One week in seconds</span>
</span><span class='line'>  <span class="n">start_time</span> <span class="o">=</span> <span class="p">(</span><span class="no">Date</span><span class="o">.</span><span class="n">today</span><span class="o">.</span><span class="n">beginning_of_day</span> <span class="o">-</span> <span class="n">one_week</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">recent_petitions</span> <span class="o">=</span> <span class="no">WeThePeople</span><span class="o">::</span><span class="no">Resources</span><span class="o">::</span><span class="no">Petition</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="kp">nil</span><span class="p">,</span> <span class="ss">:createdAfter</span> <span class="o">=&gt;</span> <span class="n">start_time</span><span class="p">)</span>
</span><span class='line'>  <span class="n">sorted_petitions</span> <span class="o">=</span> <span class="n">recent_petitions</span><span class="o">.</span><span class="n">sort_by</span><span class="p">{</span><span class="o">|</span><span class="n">petition</span><span class="o">|</span> <span class="n">petition</span><span class="o">.</span><span class="n">signature_count</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">highest_first</span> <span class="o">=</span> <span class="n">sorted_petitions</span><span class="o">.</span><span class="n">reverse</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">top_10</span> <span class="o">=</span> <span class="n">highest_first</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span class='line'>  <span class="n">top_10</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">petition</span><span class="p">,</span> <span class="n">rank</span><span class="o">|</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">rank</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">. </span><span class="si">#{</span> <span class="n">petition</span><span class="o">.</span><span class="n">title</span> <span class="si">}</span><span class="s2"> (</span><span class="si">#{</span> <span class="n">petition</span><span class="o">.</span><span class="n">signature_count</span> <span class="si">}</span><span class="s2">)&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<h3>Which active petitions are closest to the response threshold?</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">begin</span>
</span><span class='line'>  <span class="n">thirty_days</span> <span class="o">=</span> <span class="mi">30</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span>
</span><span class='line'>  <span class="n">active_petitions</span> <span class="o">=</span> <span class="no">WeThePeople</span><span class="o">::</span><span class="no">Resources</span><span class="o">::</span><span class="no">Petition</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="kp">nil</span><span class="p">,</span> <span class="ss">:createdAfter</span> <span class="o">=&gt;</span> <span class="n">thirty_days</span><span class="p">)</span>
</span><span class='line'>  <span class="n">pending_petitions</span> <span class="o">=</span> <span class="n">active_petitions</span><span class="o">.</span><span class="n">select</span> <span class="k">do</span> <span class="o">|</span><span class="n">petition</span><span class="o">|</span>
</span><span class='line'>    <span class="p">(</span><span class="n">petition</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;open&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">petition</span><span class="o">.</span><span class="n">signatures_needed</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">sorted_petitions</span> <span class="o">=</span> <span class="n">pending_petitions</span><span class="o">.</span><span class="n">sort_by</span><span class="p">{</span><span class="o">|</span><span class="n">petition</span><span class="o">|</span> <span class="n">petition</span><span class="o">.</span><span class="n">signatures_needed</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">top_10</span> <span class="o">=</span> <span class="n">sorted_petitions</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span class='line'>  <span class="n">top_10</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">petition</span><span class="p">,</span> <span class="n">rank</span><span class="o">|</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">rank</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">. </span><span class="si">#{</span> <span class="n">petition</span><span class="o">.</span><span class="n">title</span> <span class="si">}</span><span class="s2"> (needs </span><span class="si">#{</span> <span class="n">petition</span><span class="o">.</span><span class="n">signatures_needed</span> <span class="si">}</span><span class="s2">)&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<h3>For a given petition, what states do the signers come from?</h3>

<p>This script makes use of the <code>geokit</code> gem, install it with <code>gem install geokit</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;geocoder&#39;</span>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'>  <span class="n">petition</span> <span class="o">=</span> <span class="no">WeThePeople</span><span class="o">::</span><span class="no">Resources</span><span class="o">::</span><span class="no">Petition</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;5126762c688938c751000010&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">all_signatures</span> <span class="o">=</span> <span class="n">petition</span><span class="o">.</span><span class="n">signatures</span><span class="o">.</span><span class="n">get_all</span>
</span><span class='line'>  <span class="n">by_state</span> <span class="o">=</span> <span class="n">all_signatures</span><span class="o">.</span><span class="n">group_by</span> <span class="k">do</span> <span class="o">|</span><span class="n">signature</span><span class="o">|</span>
</span><span class='line'>    <span class="n">zipcode</span> <span class="o">=</span> <span class="n">signature</span><span class="o">.</span><span class="n">zip</span>
</span><span class='line'>    <span class="n">geo</span> <span class="o">=</span> <span class="no">GeoKit</span><span class="o">::</span><span class="no">Geocoders</span><span class="o">::</span><span class="no">MultiGeocoder</span><span class="o">.</span><span class="n">multi_geocoder</span><span class="p">(</span><span class="n">zipcode</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">geo</span><span class="o">.</span><span class="n">success</span>
</span><span class='line'>      <span class="n">geo</span><span class="o">.</span><span class="n">state</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="s2">&quot;none&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">by_state</span> <span class="o">=</span> <span class="n">by_state</span><span class="o">.</span><span class="n">sort_by</span><span class="p">{</span><span class="o">|</span><span class="n">state</span><span class="p">,</span> <span class="n">sigs</span><span class="o">|</span> <span class="n">state</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>
</span><span class='line'>  <span class="n">by_state</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">state</span><span class="p">,</span> <span class="n">sigs</span><span class="o">|</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">state</span><span class="si">}</span><span class="s2"> : </span><span class="si">#{</span><span class="n">sigs</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="k">end</span><span class="p">;</span><span class="kp">nil</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<h3>What petitions are people near me signing?</h3>

<p>[ Needs API support for /petitions.json ]</p>

<h2>SupportMapper</h2>

    
    
      <footer>
        
        
          <div class="sharing">
  
  
</div>

        
      </footer>
    
  </article>


</div>


  <span class="toggle-sidebar"></span>

<aside class="sidebar">
  <div> </div>
</aside>

<script src="/javascripts/sidebar.js" type="text/javascript"> </script>


    </div>

    <div class="footer">
  <p>
    All materials licensed <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0</a>&nbsp;
    <img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" />
  </p>
</div>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-42709122-1', 'jumpstartlab.com');
ga('send', 'pageview');
</script>
  </div>

  


  <div class="slide-out-div">
  <a class="handle" href="#">Feedback</a>
  <h3>Have Feedback?</h3>
  <p>Did you find an error? Something confusing? We'd love your help:</p>
  <ul>
    <li><a href="#" id="edit_source">Edit the source code of this page directly on GitHub</a></li>
    <li><a href="https://github.com/JumpstartLab/curriculum/issues">Create a new issue on the project's GitHub page</a></li>
  </ul>
  <p>Thanks!</p>
</div>

<script>
  $(function(){
    var pathname = window.location.pathname.replace( ".html", ".markdown" );
    var github_url = "https://github.com/JumpstartLab/curriculum/blob/master/source" + pathname;
    $("a#edit_source").attr('href', github_url);
  });
</script>

</body>
</html>
