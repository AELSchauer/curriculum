
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>IdeaBox - Jumpstart Lab Curriculum</title>
  <meta name="author" content="Jumpstart Lab">

  
  <meta name="description" content="IdeaBox                              Every developer has more ideas than time. As David Allen likes to say &quot; &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tutorials.jumpstartlab.com/projects/idea_box.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet" type="text/css">

  <link href="/atom.xml" rel="alternate" title="Jumpstart Lab Curriculum" type="application/atom+xml">

  <!-- TAB SLIDE OUT -->
  <script src="/javascripts/jquery-1.3.2.min.js" type="text/javascript"></script>
  <script src="/javascripts/jquery.tabSlideOut.v1.3.js"></script>

  <!-- SEARCH -->
  <script src="/search.js"></script>

  <script type="text/javascript">
    $(function(){
      $('.slide-out-div').tabSlideOut({
        tabHandle: '.handle',                     //class of the element that will become your tab
        pathToTabImage: '/images/feedback_tabv2.png', //path to the image for the tab //Optionally can be set using css
        imageHeight: '130px',                     //height of tab image           //Optionally can be set using css
        imageWidth: '36px',                       //width of tab image            //Optionally can be set using css
        tabLocation: 'left',                      //side of screen where tab lives, top, right, bottom, or left
        speed: 300,                               //speed of animation
        action: 'click',                          //options: 'click' or 'hover', action to trigger animation
        topPos: '200px',                          //position from the top/ use if tabLocation is left or right
        leftPos: '20px',                          //position from left/ use if tabLocation is bottom or top
        fixedPosition: true                      //options: true makes it stick(fixed position) on scroll
        });
      });
  </script>

  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body  >
  <header role="banner">
    <hgroup>
  <h1>Jumpstart Lab Curriculum</h1>
  
</hgroup>

  </header>

  <nav role="navigation">
    <ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tutorials.jumpstartlab.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>

<ul class="main-navigation">
  <li><a href="/">Curriculum Index</a></li>
  <li><div id="search">
  <form>
    <input type="text" id="st-search-input" class="st-search-input" />
  </form>
</div>
</li>
</ul>
  </nav>

  <div id="main">
    <div id="content">
      <div>
  <article role="article">
    
    
      <header>
        <h1 class="entry-title">
          IdeaBox
        </h1>
        
      </header>
    
    <p>Every developer has more ideas than time. As David Allen likes to say &quot;the
human brain is for creating ideas, not remembering them.&quot; Let&#8217;s build a system
to record your good, bad, and awful ideas.</p>

<h2>Goal Setting</h2>

<h3>Before You Begin</h3>

<p>Coming into this tutorial you&#8217;ve got a solid understanding of fundamental TDD.
You have some understanding of how the web works, but probably haven&#8217;t built web applications.</p>

<h3>Process</h3>

<p>This is a hybrid guided tutorial and independent work project. The text will walk you through the step-by-step process of building the fundamental functionality. Then the tutorial ends with a list of possible extensions. You should choose and implement several of these extensions to practice and refine the learnings from the tutorial.</p>

<h3>Learning Goals</h3>

<p>After completing this tutorial you should be able to:</p>

<ul>
<li>lay out a Sinatra application</li>
<li>define routes/endpoints for that application</li>
<li>use view templates to render HTML</li>
<li>store data across requests with <code>YAML::Store</code></li>
<li>write a simple HTML form</li>
<li>read and react to HTTP parameters from the form</li>
<li>explain the statelessness of the HTTP request/response cycle</li>
</ul>

<h2>I0: Getting Started</h2>

<h3>Environment Setup</h3>

<p>For this project you need to have setup:</p>

<ul>
<li>Ruby 2.1</li>
<li>Ruby&#8217;s Bundler gem</li>
</ul>

<h3>File/Folder Structure</h3>

<p>Let&#8217;s start our project with the minimum and build up from there. We need:</p>

<ul>
<li>a project folder</li>
<li>a <code>Gemfile</code> in that folder</li>
<li>an <code>app.rb</code> file in that folder</li>
</ul>

<h3><code>Gemfile</code></h3>

<p>The <code>Gemfile</code> is used to express the dependencies of our application. We need the Sinatra library for our app to work, so we add it to the <code>Gemfile</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;sinatra&#39;</span><span class="p">,</span> <span class="nb">require</span><span class="p">:</span> <span class="s1">&#39;sinatra/base&#39;</span>
</span></code></pre></td></tr></table></div></figure>

<p>And save it.</p>

<h4>Install the Dependency</h4>

<p>Return to your terminal and, from your project directory, run <code>bundle</code>. The Bundler gem will read the <code>Gemfile</code>, decide if anything needs to be installed from RubyGems, and install it.</p>

<h3>Beginning <code>app.rb</code></h3>

<p>In the <code>app.rb</code> we&#8217;ll start writing the body of our application.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;bundler&#39;</span>
</span><span class='line'><span class="no">Bundler</span><span class="o">.</span><span class="n">require</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">IdeaBoxApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="s2">&quot;Hello, World!&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">run!</span> <span class="k">if</span> <span class="n">app_file</span> <span class="o">==</span> <span class="vg">$0</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Save the file.</p>

<h3>Starting the Server</h3>

<p>From your project directory, start the server:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>ruby app.rb</span><span class='line output'>[2013-07-08 10:27:00] INFO  WEBrick 1.3.1</span><span class='line output'>[2013-07-08 10:27:00] INFO  ruby 2.1.1 (2013-02-22) [x86_64-darwin12.4.0]</span><span class='line output'>== Sinatra/1.4.3 has taken the stage on 4567 for development with backup from WEBrick</span><span class='line output'>[2013-07-08 10:27:00] INFO  WEBrick::HTTPServer#start: pid=94643 port=4567</span></code></pre></td></tr></table></div></div>
        </div>

<p>In the third line of output note that the server is, by default, running on
port <code>4567</code>.</p>

<p>Access <a href="http://localhost:4567">http://localhost:4567</a> in your web browser.
You should see <code>Hello, World</code> then pat yourself on the back for developing a
web application.</p>

<h3>What Just Happened?</h3>

<h4>Require dependencies</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;bundler&#39;</span>
</span><span class='line'><span class="no">Bundler</span><span class="o">.</span><span class="n">require</span>
</span></code></pre></td></tr></table></div></figure>

<p>In the first two lines of <code>app.rb</code> we loaded Bundler and told it to require everything specified in the <code>Gemfile</code>.</p>

<h3>Create the Application Container</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">IdeaBoxApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then we create a Ruby class which is going to be our application. It
inherits from <code>Sinatra::Base</code>, which provides the application with all the Sinatra functionality.</p>

<h3>Define the URL to Match</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">IdeaBoxApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>We call a method named <code>get</code>, giving it a parameter
<code>/</code> and a block of code. The string parameter to <code>get</code> is the URL pattern to
match against the incoming HTTP request.</p>

<p>Our Sinatra application knows that it is running on
<a href="http://localhost:4567">http://localhost:4567</a>, so we only need to define the
part of the url that comes after that.</p>

<p>In this case we passed <code>'/'</code>, which will match when someone visits the
homepage, also known as the <em>root</em> of the application.</p>

<h3>Defining the Response</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">IdeaBoxApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="s1">&#39;Hello, world!&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>The block of code that we pass to the <code>get</code> method, the stuff between the <code>do</code>
and the <code>end</code>, is the code that Sinatra is going to run when someone requests
the matching page.</p>

<p>The response to the request is a string, in this case <code>'Hello, World!'</code>, which
is sent to the browser.</p>

<h4>Run the Application</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">IdeaBoxApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="c1"># ...</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">run!</span> <span class="k">if</span> <span class="n">app_file</span> <span class="o">==</span> <span class="vg">$0</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>This functionality will be important later. Basically we only want to call <code>run!</code>, which actually starts the application, if this file was run directly like this:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>ruby app.rb</span></code></pre></td></tr></table></div></div>
        </div>

<h3>Refactoring to use <code>rackup</code></h3>

<p>It&#8217;s not a very good idea to have the app run itself. That line
<code>run! if app_file == $0</code> is ugly. Let&#8217;s separate the concerns of <em>defining</em> the application from <em>running</em> the
application.</p>

<h4>Rack, In Brief</h4>

<p>There&#8217;s a standard named Rack that&#8217;s used by most Ruby web frameworks, including both Sinatra and Rails. It&#8217;s a small interface that each framework follows.</p>

<p>This allows the community to share tools across frameworks. The Puma web server, for instance, supports Rack applications. So that means it can run either Sinatra or Rails apps without knowing anything more than the fact that they adhere to the Rack interface.</p>

<p>Let&#8217;s take advantage of Rack to run our application.</p>

<h4>Creating <code>config.ru</code></h4>

<p>Rack applications have a file in their project root named <code>config.ru</code>. When a Rack-compatible server is told to load the application, it&#8217;ll try to run this file. Despite having the extension <code>.ru</code>, it&#8217;s just another Ruby file.</p>

<p>Create an empty file called <code>config.ru</code>. Your
<code>idea_box</code> project directory should now look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>idea_box/
</span><span class='line'>├── Gemfile
</span><span class='line'>├── Gemfile.lock
</span><span class='line'>├── app.rb
</span><span class='line'>└── config.ru</span></code></pre></td></tr></table></div></figure>

<p><code>config.ru</code> is called a <em>rack up</em> file, hence the <code>ru</code> file extension. We&#8217;re going to move the business of actually running the application into that file.</p>

<h4>Filling In <code>config.ru</code></h4>

<p>Open up the file and add the following code to it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;bundler&#39;</span>
</span><span class='line'><span class="no">Bundler</span><span class="o">.</span><span class="n">require</span>
</span><span class='line'>
</span><span class='line'><span class="n">run</span> <span class="no">IdeaBoxApp</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Starting the Application</h4>

<p>Try starting your application with:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>rackup</span></code></pre></td></tr></table></div></div>
        </div>

<p>It will give you the following error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>path/to/idea_box/config.ru:4:in `block in &lt;main&gt;': uninitialized constant IdeaBoxApp (NameError)</span></code></pre></td></tr></table></div></figure>

<h5>Reading the Error Message</h5>

<p>Let&#8217;s pick that error message apart. First, it tells us what the name of the file is where the error occurred:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>path/to/idea_box/config.ru</span></code></pre></td></tr></table></div></figure>

<p>So it&#8217;s in the <code>config.ru</code> file.</p>

<p>Then it tells us which line the error occurred on:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>path/to/idea_box/config.ru:4</span></code></pre></td></tr></table></div></figure>

<p>So it happened on line 4. What&#8217;s on line 4 of <code>config.ru</code>?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">run</span> <span class="no">IdeaBoxApp</span>
</span></code></pre></td></tr></table></div></figure>

<p>OK, so it has something to do with running the application we wrote. But what is it complaining about, really?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>path/to/idea_box/config.ru:4:in `block in &lt;main&gt;': uninitialized constant IdeaBoxApp (NameError)</span></code></pre></td></tr></table></div></figure>

<p>It doesn&#8217;t know anything about any <code>IdeaBoxApp</code>. That&#8217;s because we haven&#8217;t
told our <code>config.ru</code> file where to find it.</p>

<h4>Adding the Requires</h4>

<p>We need to tell the <code>config.ru</code> file to load the application we defined. Modify it like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;bundler&#39;</span>
</span><span class='line'><span class="no">Bundler</span><span class="o">.</span><span class="n">require</span>
</span><span class='line'>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;./app&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">run</span> <span class="no">IdeaBoxApp</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Start It Again</h4>

<p>Now, if you run</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>rackup</span></code></pre></td></tr></table></div></div>
        </div>

<p>The application should start normally.</p>

<h4>Default Ports</h4>

<p>Earlier when we started the application directly it started on port 4567. In our browser we opened <a href="http://localhost:4567">localhost:4567</a>.</p>

<p><code>rackup</code> defaults to the port <code>9292</code> instead of port <code>4567</code>, so we&#8217;d access the page at <a href="http://localhost:9292">localhost:9292</a>.</p>

<p>You can pick whatever port you like, and tell <code>rackup</code> to use it. Let&#8217;s stick with Sinatra&#8217;s default, <code>4567</code>:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>rackup -p 4567</span></code></pre></td></tr></table></div></div>
        </div>

<h4>Remove the <code>run!</code> and Requires</h4>

<p>We can now delete the redundant <code>run!</code> line inside of <code>app.rb</code> and our <code>config.ru</code> has taken care of requiring the dependencies. So we can cut down our <code>app.rb</code> to just this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">IdeaBoxApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="s1">&#39;Hello, world!&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Now you&#8217;re ready to start building the application.</p>

<h2>I1: Recording Ideas</h2>

<p>For the early iterations we&#8217;re going to ignore authentication and
authorization. Just imagine that our users are going to run this app on their
local machine behind a firewall, so they don&#8217;t care about security.</p>

<p>When they visit the root URL, we should&#8230;</p>

<ul>
<li>Display a text field where they can store a new idea with a &quot;SAVE&quot; button</li>
<li>Show a list of their existing ideas</li>
</ul>

<p>Let&#8217;s build that functionality now. Assume all work is taking place in <code>app.rb</code> unless we say otherwise.</p>

<h3>View Templating Basics</h3>

<p>Our current &quot;application&quot; is just rendering a plain text string. Let&#8217;s make it render some HTML. Change the <code>get '/'</code> block to look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="s2">&quot;&lt;h1&gt;Hello, World!&lt;/h1&gt;&lt;blockquote&gt;I guess I always felt even if the world came to an end, McDonald&#39;s would still be open. &lt;cite&gt;Susan Beth Pfeffer&lt;/cite&gt;&lt;/blockquote&gt;&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Refresh the page in your browser and you should see this:</p>

<p><img src="idea_box/hello_world.png" alt="Hello World">
</p>

<p>HTML is really just a string with some special tags in it. The browser understands that tag structure and has opinions about what it should look like.</p>

<p>Putting our HTML in the block of the <code>get</code> method works, but it&#8217;s difficult to read, write, and maintain. We need a better way to render the response.</p>

<h4>Creating a View Template</h4>

<p>Within your project folder, create a folder named <code>views</code>. In that folder, create a file named <code>index.erb</code> with the following contents:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;html&gt;</span>
</span><span class='line'><span class="x">  &lt;head&gt;</span>
</span><span class='line'><span class="x">    &lt;title&gt;IdeaBox&lt;/title&gt;</span>
</span><span class='line'><span class="x">  &lt;/head&gt;</span>
</span><span class='line'><span class="x">  &lt;body&gt;</span>
</span><span class='line'><span class="x">    &lt;h1&gt;Hello World, View Template Edition&lt;/h1&gt;</span>
</span><span class='line'><span class="x">  &lt;/body&gt;</span>
</span><span class='line'><span class="x">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Go to your browser and refresh the root page. You should see no change, still
just <code>Hello, World</code>.</p>

<h4>Rendering the Template</h4>

<p>Back in your <code>app.rb</code>, change your <code>get</code> method like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">erb</span> <span class="ss">:index</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Flip over to your browser, refresh, and&#8230;still see <code>Hello, World</code>???</p>

<h3>Reloading Application Code</h3>

<p>If you&#8217;ve developed anything in Rails before, you&#8217;ve been spoiled by automatic
reloading. In Ruby it&#8217;s actually pretty complex to dynamically undefine and
redefine classes when files change. In Sinatra, this functionality is <strong>not</strong>
built in by default.</p>

<p>Go to your server terminal session and hit <code>CTRL-C</code> to stop the process.
Restart the server (<code>rackup -p 4567</code>), flip over to your browser, and refresh
the page. Now you should see the &quot;View Template Edition&quot; content.</p>

<h4>Automatic Reloading</h4>

<p>Below are two ways to setup automatic reloading. Choose one.</p>

<h4>#1: Sinatra Reloader</h4>

<p>One to get automatic reloading is to use the <code>sinatra/reloader</code> functionality of the <code>sinatra-contrib</code> gem.</p>

<p>Add <code>sinatra-contrib</code> to your <code>Gemfile</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;sinatra-contrib&#39;</span><span class="p">,</span> <span class="nb">require</span><span class="p">:</span> <span class="s1">&#39;sinatra/reloader&#39;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then run <code>bundle</code> from your terminal to install the gem.</p>

<p>Add this <code>configure</code> block into your <code>app.rb</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">IdeaBoxApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">configure</span> <span class="ss">:development</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">register</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Reloader</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># ... other stuff</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Kill your server process (<code>CTRL-C</code>) and restart it using <code>rackup</code>:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>rackup -p 4567</span><span class='line output'>== WEBrick on http://127.0.0.1:4567/</span><span class='line output'>[2013-02-26 17:41:28] INFO  WEBrick 1.3.1</span><span class='line output'>[2013-02-26 17:41:28] INFO  ruby 2.1.1 (2013-02-06) [x86_64-darwin11.4.2]</span><span class='line output'>[2013-02-26 17:41:28] INFO  WEBrick::HTTPServer#start: pid=9648 port=4567</span></code></pre></td></tr></table></div></div>
        </div>

<p>Now go to your <code>index.erb</code> and change the H1 header to just <code>IdeaBox</code>. Save
the template, go to your browser, refresh, and you should see the updated
heading.</p>

<p>Your files are now reloading each request without you manually stopping and restarting the server.</p>

<h4>#2: Shotgun</h4>

<p><a href="https://github.com/rtomayko/shotgun">Shotgun</a> is an automatic reloader for Rack. It works with any Rack-supported server. According to the documentation, &quot;Each time a request is received, it forks, loads the application in the child process, processes the request, and exits the child process. The
result is clean, application-wide reloading of all source files and templates on
each request.&quot;</p>

<p>To use Shotgun, add it to your Gemfile:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;shotgun&#39;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then from the command line, run <code>shotgun</code>. </p>

<h3>Creating a Form</h3>

<h4>HTML Form</h4>

<p>Now we need to add a little HTML form which is, itself, outside the scope of
this tutorial. Here&#8217;s the HTML we want to use:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;html&gt;</span>
</span><span class='line'><span class="x">  &lt;head&gt;</span>
</span><span class='line'><span class="x">    &lt;title&gt;IdeaBox&lt;/title&gt;</span>
</span><span class='line'><span class="x">  &lt;/head&gt;</span>
</span><span class='line'><span class="x">  &lt;body&gt;</span>
</span><span class='line'><span class="x">    &lt;h1&gt;IdeaBox&lt;/h1&gt;</span>
</span><span class='line'><span class="x">    &lt;form action=&#39;/&#39; method=&#39;POST&#39;&gt;</span>
</span><span class='line'><span class="x">      &lt;p&gt;</span>
</span><span class='line'><span class="x">        Your Idea:</span>
</span><span class='line'><span class="x">      &lt;/p&gt;</span>
</span><span class='line'><span class="x">      &lt;input type=&#39;text&#39; name=&#39;idea_title&#39;/&gt;&lt;br/&gt;</span>
</span><span class='line'><span class="x">      &lt;textarea name=&#39;idea_description&#39;&gt;&lt;/textarea&gt;&lt;br/&gt;</span>
</span><span class='line'><span class="x">      &lt;input type=&#39;submit&#39;/&gt;</span>
</span><span class='line'><span class="x">    &lt;/form&gt;</span>
</span><span class='line'><span class="x">  &lt;/body&gt;</span>
</span><span class='line'><span class="x">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Preview it in the browser.</p>

<p><img src="idea_box/idea_box_v1.png" alt="Idea Box v1">
</p>

<p>Pretty ugly, eh? Go ahead and fill in a title and
brief description, then hit <code>Submit</code>.</p>

<h4>Sinatra Doesn&#8217;t Know This Ditty</h4>

<p><img src="idea_box/missing_error.png" alt="Missing Error">
</p>

<p>Get used to seeing this screen. It&#8217;s Sinatra&#8217;s default <code>404</code> page, which is
rendered whenever you submit a request which doesn&#8217;t have a matching route.</p>

<p>Typically it means you:</p>

<ol>
<li>Didn&#8217;t define the route pattern at all</li>
<li>Your method is using the wrong HTTP verb
(ex: your method uses <code>get</code>, but the request is coming in as a <code>post</code>)</li>
<li>The route pattern doesn&#8217;t match the request like you thought it did</li>
</ol>

<p>The default error page is pretty useless for debugging. Let&#8217;s create a
better error page.</p>

<h4>Call the <code>not_found</code> Method</h4>

<p>Within your <code>app.rb</code>, call the <code>not_found</code> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">IdeaBoxApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">not_found</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">erb</span> <span class="ss">:error</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># ...</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>The block you supply to <code>not_found</code> will be run by Sinatra whenever a request does not match any of the defined routes.</p>

<h4>Create the Error View</h4>

<p>Then in your <code>views</code> folder, define a file named <code>error.erb</code> with these
contents:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;html&gt;</span>
</span><span class='line'><span class="x">  &lt;head&gt;</span>
</span><span class='line'><span class="x">    &lt;title&gt;IdeaBox Error&lt;/title&gt;</span>
</span><span class='line'><span class="x">  &lt;/head&gt;</span>
</span><span class='line'><span class="x">  &lt;body&gt;</span>
</span><span class='line'><span class="x">    &lt;h1&gt;An Error Occured&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="x">    &lt;h3&gt;Params&lt;/h3&gt;</span>
</span><span class='line'><span class="x">    &lt;table&gt;</span>
</span><span class='line'><span class="x">      &lt;tr&gt;</span>
</span><span class='line'><span class="x">        &lt;th&gt;Request Verb&lt;/th&gt;</span>
</span><span class='line'><span class="x">        &lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">request</span><span class="o">.</span><span class="n">request_method</span> <span class="cp">%&gt;</span><span class="x">&lt;/td&gt;</span>
</span><span class='line'><span class="x">      &lt;/tr&gt;</span>
</span><span class='line'><span class="x">      &lt;tr&gt;</span>
</span><span class='line'><span class="x">        &lt;th&gt;Request Path&lt;/th&gt;</span>
</span><span class='line'><span class="x">        &lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span> <span class="cp">%&gt;</span><span class="x">&lt;/td&gt;</span>
</span><span class='line'><span class="x">      &lt;/tr&gt;</span>
</span><span class='line'><span class="x">      &lt;tr&gt;</span>
</span><span class='line'><span class="x">        &lt;th colspan=2&gt;Parameters&lt;/th&gt;</span>
</span><span class='line'><span class="x">      &lt;/tr&gt;</span>
</span><span class='line'><span class="x">      </span><span class="cp">&lt;%</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">        &lt;tr&gt;</span>
</span><span class='line'><span class="x">          &lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">key</span> <span class="cp">%&gt;</span><span class="x">&lt;/td&gt;</span>
</span><span class='line'><span class="x">          &lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">value</span> <span class="cp">%&gt;</span><span class="x">&lt;/td&gt;</span>
</span><span class='line'><span class="x">        &lt;/tr&gt;</span>
</span><span class='line'><span class="x">      </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">    &lt;/table&gt;</span>
</span><span class='line'><span class="x">  &lt;/body&gt;</span>
</span><span class='line'><span class="x">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Refresh your browser page which generated the error  and you should see more useful information about the error itself.</p>

<p><em>Note</em>: If you&#8217;d like to output other things about the request, check out the
<a href="http://rdoc.info/gems/rack/Rack/Request">API documentation</a> for <code>Rack::Request</code>.</p>

<h4>Handling POST requests to <code>/</code></h4>

<p>You&#8217;ve already defined what to do for some requests to <code>/</code> using the <code>get</code> methods. But when the browser submits the request from the form it&#8217;s making a <code>POST</code> request. We need to define what should happen for a <code>POST</code> to <code>/</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="s2">&quot;Creating an IDEA!&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Refresh the browser and that line of text should appear. But what should our
<code>POST /</code> path actually do? Let&#8217;s write some pseudocode:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># 1. Create an idea based on the form parameters</span>
</span><span class='line'>  <span class="c1"># 2. Store it</span>
</span><span class='line'>  <span class="c1"># 3. Send us back to the index page to see all ideas</span>
</span><span class='line'>  <span class="s2">&quot;Creating an IDEA!&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Step 1: Create an <code>Idea</code></h4>

<p>We could write our entire application inside the <code>app.rb</code> file. But, instead, let&#8217;s pull out the business logic about an idea out in to a class named <code>Idea</code>. Create a file in the root of your project named <code>idea.rb</code> with these contents:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Idea</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then, in your <code>POST /</code> path method, try to create an instance of <code>Idea</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># 1. Create an idea based on the form parameters</span>
</span><span class='line'>  <span class="n">idea</span> <span class="o">=</span> <span class="no">Idea</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># 2. Store it</span>
</span><span class='line'>  <span class="c1"># 3. Send us back to the index page to see all ideas</span>
</span><span class='line'>  <span class="s2">&quot;Creating an IDEA!&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Refresh your browser and you&#8217;ll get&#8230;</p>

<h5><code>uninitialized constant IdeaBoxApp::Idea</code></h5>

<p>We need to tell Sinatra to load our new <code>Idea</code> file. At the top of your <code>app.rb</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;./idea&#39;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Flip to the browser, refresh, and you&#8217;ll see &quot;Creating an IDEA!&quot;. This means
that it got to that line in the <code>post '/'</code> method without any errors.</p>

<h5>Step 2: Saving the Idea</h5>

<p>Our step 2 is &quot;store it&quot;, which we&#8217;d like to be as easy as calling <code>.save</code> on
the instance:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># 1. Create an idea based on the form parameters</span>
</span><span class='line'>  <span class="n">idea</span> <span class="o">=</span> <span class="no">Idea</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># 2. Store it</span>
</span><span class='line'>  <span class="n">idea</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># 3. Send us back to the index page to see all ideas</span>
</span><span class='line'>  <span class="s2">&quot;Creating an IDEA!&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Refresh the page and boom: <code>undefined method 'save'</code> for an <code>Idea</code> instance.</p>

<h5>Defining Save</h5>

<p>Hop into the <code>idea.rb</code> and add a <code>save</code> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Idea</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">save</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Refresh the browser and you&#8217;re back to &quot;Creating an IDEA!&quot;. This <code>save</code> method exists and ran without error &#8211; it just didn&#8217;t do anything.</p>

<h2>I2: Saving Ideas</h2>

<p>How should we save our data? Should we store it in memory, to a file, or to a database?</p>

<p>Almost every web application is backed by a database that stores its data.
We&#8217;re going to use an incredibly simple database that comes with Ruby called
<code>YAML::Store</code> to store our ideas.</p>

<h3>Saving</h3>

<p>The first problem in front of us is how to make <code>Idea#save</code> work, so instances
of <code>Idea</code> need access to the database.</p>

<p>Let&#8217;s define a <code>database</code> method that either fetches the database referenced by <code>@database</code> or creates a new database named <code>ideabox</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Idea</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">save</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">database</span>
</span><span class='line'>    <span class="vi">@database</span> <span class="o">||=</span> <span class="no">YAML</span><span class="o">::</span><span class="no">Store</span><span class="o">.</span><span class="n">new</span> <span class="s2">&quot;ideabox&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<h3>Simplistic Save</h3>

<p>With that database at hand, let&#8217;s write a <code>save</code> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">save</span>
</span><span class='line'>  <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span> <span class="o">|</span><span class="n">db</span><span class="o">|</span>
</span><span class='line'>    <span class="n">db</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">]</span> <span class="o">||=</span> <span class="o">[]</span>
</span><span class='line'>    <span class="n">db</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">]</span> <span class="o">&lt;&lt;</span> <span class="p">{</span><span class="n">title</span><span class="p">:</span> <span class="s1">&#39;diet&#39;</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;pizza all the time&#39;</span><span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Here our call to <code>database</code> is returning an instance of <code>YAML::Store</code>. The <code>YAML::Store</code> instance has a method named <code>transaction</code>. A transaction is a set of database operations that are grouped together. In this transaction we&#8217;re referring to the database with the local variable <code>db</code>, telling the database that there should be a collection named <code>ideas</code> or creating one and starting it as an empty set. Then we shovel an idea with fake data into that collection of <code>ideas</code>.</p>

<h3>Testing Ideas in the Database</h3>

<p>We&#8217;re building some complex functionality here. Let&#8217;s see if things are
actually working. From a terminal in the project directory, fire up IRB:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>irb</span></code></pre></td></tr></table></div></div>
        </div>

<p>Then within IRB:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>2.1.1 :001&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>2.1.1 :002&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>2.1.1 :003&gt;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>require './idea'</span><span class='line output'>=&gt; true</span><span class='line command'>idea = Idea.new</span><span class='line output'>=&gt; #&lt;Idea:0x007f86fc04a0a8&gt;</span><span class='line command'>idea.save</span><span class='line output'>=&gt; NameError: uninitialized constant Idea::YAML</span></code></pre></td></tr></table></div></div>
        </div>

<p>Loading <code>idea.rb</code> goes fine, but when we try to save, it blows up in
<code>save</code> when it calls the <code>database</code> method because it doesn&#8217;t know what <code>YAML</code> is.</p>

<h4>Require &#8216;yaml/store&#8217;</h4>

<p>Let&#8217;s just tell irb to load <code>YAML</code>, then try to save again:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>2.1.1 :001&gt;</span>
<span class='line-number'>2.1.1 :002&gt;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>require 'yaml'</span><span class='line command'>idea.save</span><span class='line output'>=&gt; NameError: uninitialized constant Psych::Store</span></code></pre></td></tr></table></div></div>
        </div>

<p>OK, so we get a new error message. We didn&#8217;t require enough pieces.</p>

<p>The thing we&#8217;re using in the <code>database</code> method, <code>YAML::Store</code>, is a
wrapper around another library named <code>Psych::Store</code>. We can pull it in by requiring &#8216;yaml/store&#8217;:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>2.1.1 :001&gt;</span>
<span class='line-number'>2.1.1 :002&gt;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>require 'yaml/store'</span><span class='line command'>idea.save</span><span class='line output'>=&gt; {title: 'diet', description: 'pizza all the time'}</span></code></pre></td></tr></table></div></div>
        </div>

<h4>Verifying Data in the Database</h4>

<p>But did it really save anything? Within IRB you can look at what&#8217;s in the database:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>2.1.1 :001&gt;</span>
<span class='line-number'>2.1.1 :002&gt;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>idea = Idea.new</span><span class='line command'>idea.database.transaction { idea.database['ideas'] }</span><span class='line output'>=&gt; [{:title=&gt;"diet", :description=&gt;"pizza all the time"}]</span></code></pre></td></tr></table></div></div>
        </div>

<p>What happens if we save another one?</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>2.1.1 :001&gt;</span>
<span class='line-number'>2.1.1 :002&gt;</span>
<span class='line-number'>2.1.1 :003&gt;</span>
<span class='line-number'>&nbsp;</span>
<br></pre></td><td class='code'><pre><code><span class='line command'>idea = Idea.new</span><span class='line command'>idea.save</span><span class='line command'>idea.database.transaction { idea.database['ideas'] }</span><span class='line output'>=&gt; [{:title=&gt;"diet", :description=&gt;"pizza all the time"}, {:title=&gt;"diet", :description=&gt;"pizza all the time"}]</span></code></pre></td></tr></table></div></div>
        </div>

<p>They&#8217;re definitely going into the database. It&#8217;s kind of pointless, since
we&#8217;re saving the same idea over and over again, but the basic functionality is
working.</p>

<p>For this to work in our web app, then, we need to add <code>require 'yaml/store'</code> to the top of <code>idea.rb</code>.</p>

<h3>Inspecting the Database</h3>

<p>Take a look at the files in your project:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>├── Gemfile
</span><span class='line'>├── Gemfile.lock
</span><span class='line'>├── app.rb
</span><span class='line'>├── config.ru
</span><span class='line'>├── idea.rb
</span><span class='line'>├── ideabox
</span><span class='line'>└── views
</span><span class='line'>    ├── error.erb
</span><span class='line'>    └── index.erb</span></code></pre></td></tr></table></div></figure>

<p>Notice the new one named <code>ideabox</code>? Open it up.</p>

<h4>The YAML</h4>

<p>You&#8217;ll see this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="nn">---</span>
</span><span class='line'><span class="l-Scalar-Plain">ideas</span><span class="p-Indicator">:</span>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">:title</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">diet</span>
</span><span class='line'>  <span class="l-Scalar-Plain">:description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pizza all the time</span>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">:title</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">diet</span>
</span><span class='line'>  <span class="l-Scalar-Plain">:description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pizza all the time</span>
</span></code></pre></td></tr></table></div></figure>

<p>Our database is in a regular, plain text file right there on the file system. It&#8217;s in a structured format known as <code>YAML</code>. Try editing the contents of the file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="nn">---</span>
</span><span class='line'><span class="l-Scalar-Plain">ideas</span><span class="p-Indicator">:</span>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">:title</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">diet</span>
</span><span class='line'>  <span class="l-Scalar-Plain">:description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pizza all the time</span>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">:title</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">exercise</span>
</span><span class='line'>  <span class="l-Scalar-Plain">:description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">play video games</span>
</span></code></pre></td></tr></table></div></figure>

<h3>Seeing Data Changes</h3>

<p>Start a new IRB session if you don&#8217;t already have one running:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>irb</span></code></pre></td></tr></table></div></div>
        </div>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>2.1.1 :001&gt;</span>
<span class='line-number'>2.1.1 :002&gt;</span>
<span class='line-number'>2.1.1 :003&gt;</span>
<span class='line-number'>&nbsp;</span>
<br></pre></td><td class='code'><pre><code><span class='line command'>require './idea'</span><span class='line command'>idea = Idea.new</span><span class='line command'>idea.database.transaction { idea.database['ideas'] }</span><span class='line output'>=&gt; [{:title=&gt;"diet", :description=&gt;"pizza all the time"}, {:title=&gt;"exercise", :description=&gt;"play video games"}]</span></code></pre></td></tr></table></div></div>
        </div>

<p>Note that the second idea that came back had our modified description.</p>

<h3>Saving Real Ideas</h3>

<p>Rather than saving the same pizza idea every time, let&#8217;s save data passed in when the <code>Idea</code> instance is created:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">idea</span> <span class="o">=</span> <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="s2">&quot;social network for dogs&quot;</span><span class="p">)</span>
</span><span class='line'><span class="err">$</span> <span class="n">idea</span><span class="o">.</span><span class="n">save</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Try It</h4>

<p>What happens if we try doing this in IRB?</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>2.1.1 :001&gt;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>idea = Idea.new("app", "social network for dogs")</span><span class='line output'>=&gt; ArgumentError: wrong number of arguments(2 for 0)</span></code></pre></td></tr></table></div></div>
        </div>

<p>The <code>new</code> method for <code>Idea</code> doesn&#8217;t like this at all. The error is telling us
that we&#8217;re trying to give it two arguments, but it accepts zero.</p>

<h4>Add an <code>initialize</code></h4>

<p>We can change this by adding an <code>initialize</code> method to <code>Idea</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Idea</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># ...</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Try It Again</h4>

<p>Now if we exit the IRB session and start over, we won&#8217;t get an error:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>2.1.1 :001&gt;</span>
<span class='line-number'>2.1.1 :002&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>2.1.1 :003&gt;</span>
<span class='line-number'>&nbsp;</span>
<br></pre></td><td class='code'><pre><code><span class='line command'>require './idea'</span><span class='line command'>idea = Idea.new("app", "social network for dogs")</span><span class='line output'>=&gt; #&lt;Idea:0x007f7f608472b8&gt;</span><span class='line command'>idea.save</span><span class='line output'>=&gt; [{:title=&gt;"diet", :description=&gt;"pizza all the time"}, {:title=&gt;"exercise", :description=&gt;"play video games"}, {:title=&gt;"diet", :description=&gt;"pizza all the time"}]</span></code></pre></td></tr></table></div></div>
        </div>

<p>It didn&#8217;t crash, but it didn&#8217;t work either. If you take a look inside your database YAML file it saved the same old pizza idea. We&#8217;re almost there, though.</p>

<h4>Using <code>title</code> and <code>description</code></h4>

<p>We need to take the <code>title</code> and <code>description</code> and make them available to the
<code>save</code> method. Let&#8217;s store them in instance variables:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Idea</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:description</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@title</span> <span class="o">=</span> <span class="n">title</span>
</span><span class='line'>    <span class="vi">@description</span> <span class="o">=</span> <span class="n">description</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># ...</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>And change the <code>save</code> method to use them:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">save</span>
</span><span class='line'>  <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span> <span class="o">|</span><span class="n">db</span><span class="o">|</span>
</span><span class='line'>    <span class="n">db</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">]</span> <span class="o">||=</span> <span class="o">[]</span>
</span><span class='line'>    <span class="n">db</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">]</span> <span class="o">&lt;&lt;</span> <span class="p">{</span><span class="n">title</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="n">description</span><span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Final IRB Test</h4>

<p>Restart your IRB session and try this:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>2.1.1 :001&gt;</span>
<span class='line-number'>2.1.1 :002&gt;</span>
<span class='line-number'>2.1.1 :003&gt;</span>
<span class='line-number'>2.1.1 :004&gt;</span>
</pre></td><td class='code'><pre><code><span class='line command'>require './idea'</span><span class='line command'>Idea.new("app", "social network for dogs").save</span><span class='line command'>Idea.new("excursion", "take everyone to the zoo").save</span><span class='line command'>Idea.new("party", "dance all night and all day").save</span></code></pre></td></tr></table></div></div>
        </div>

<p>Open your <code>ideabox</code> file and make sure that the ideas you just created are
there with the correct content.</p>

<h3>Ideas from the Browser</h3>

<p>Remember back when we were building a web application? Let&#8217;s hop
over there and see what&#8217;s going on.</p>

<ul>
<li>Go to <a href="http://localhost:4567">localhost:4567</a> in your browser</li>
<li>Enter an idea in the form</li>
<li>Click <code>Submit</code></li>
</ul>

<p>Are you surprised to see an exception?</p>

<h4>Debugging the Idea Submission</h4>

<p>We&#8217;re getting an <code>ArgumentError</code> that says <code>wrong number of arguments (0 for
2)</code>. This sounds kind of familiar. It says the problem is in <code>app.rb</code> the
line:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">idea</span> <span class="o">=</span> <span class="no">Idea</span><span class="o">.</span><span class="n">new</span>
</span></code></pre></td></tr></table></div></figure>

<p>We changed the definition of <code>initialize</code> in <code>Idea</code> to take <code>title</code> and
<code>description</code> &#8211; 2 arguments. We need to send in the data from the form.</p>

<h4>Finding the Form Data</h4>

<p>Sinatra gives us a <code>params</code> method that returns an object holding the data we need.Let&#8217;s take a look at it by calling <code>inspect</code> and commenting out the rest of the <code>post '/'</code> block:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">params</span><span class="o">.</span><span class="n">inspect</span>
</span><span class='line'>  <span class="c1">## 1. Create an idea based on the form parameters</span>
</span><span class='line'>  <span class="c1"># idea = Idea.new</span>
</span><span class='line'>  <span class="c1">#</span>
</span><span class='line'>  <span class="c1">## 2. Store it</span>
</span><span class='line'>  <span class="c1"># idea.save</span>
</span><span class='line'>  <span class="c1">#</span>
</span><span class='line'>  <span class="c1">## 3. Send us back to the index page to see all ideas</span>
</span><span class='line'>  <span class="c1"># &quot;Creating an IDEA!&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Now go to <a href="http://localhost:4567">localhost:4567</a> and fill in a new idea.
Click submit, and the page shows you the following.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{"idea_title"=&gt;"story", "idea_description"=&gt;"a princess steals a spaceship"}</span></code></pre></td></tr></table></div></figure>

<p>So we learn that the hash returned by <code>params</code> has keys <code>idea_title</code> and <code>idea_description</code>. Those names come the tags we defined in the HTML form.</p>

<h4>Using the Form Data</h4>

<p>Now we can use those keys in the code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># 1. Create an idea based on the form parameters</span>
</span><span class='line'>  <span class="n">idea</span> <span class="o">=</span> <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="s1">&#39;idea_title&#39;</span><span class="o">]</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="s1">&#39;idea_description&#39;</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># 2. Store it</span>
</span><span class='line'>  <span class="n">idea</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># 3. Send us back to the index page to see all ideas</span>
</span><span class='line'>  <span class="s2">&quot;Creating an IDEA!&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Try submitting a new idea through the web interface again. You&#8217;ll still see &quot;Creating an IDEA!&quot;.</p>

<p><strong>BUT</strong> take a look inside your database file. The idea you put in the browser is there!</p>

<h4>Redirecting After Save</h4>

<p>So we&#8217;re doing step 1 and step 2 correctly. Step 3 <em>Send us back to the index
page to see all the ideas</em> is still not right.</p>

<p>Replace &quot;Creating an IDEA!&quot; with <code>redirect '/'</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># 1. Create an idea based on the form parameters</span>
</span><span class='line'>  <span class="n">idea</span> <span class="o">=</span> <span class="no">Idea</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># 2. Store it</span>
</span><span class='line'>  <span class="n">idea</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># 3. Send us back to the index page to see all ideas</span>
</span><span class='line'>  <span class="n">redirect</span> <span class="s1">&#39;/&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>The <code>redirect</code> method is provided by Sinatra. We give it a string parameter which is the path we want to redirect to. The redirect will come in as a <code>get</code> request.</p>

<h4>Full Save Cycle</h4>

<p>Go back to your root page, submit the form again, and&#8230;did it work? Maybe?</p>

<p>The new idea has been saved because we can see it in the database file. We&#8217;re back on the index page because we&#8217;re seeing the form. But we&#8217;re not showing the ideas.</p>

<p>We need to get the data back out of the database and into the view template.</p>

<h3>Viewing Ideas</h3>

<p>Hop over to the <code>index.erb</code>. We&#8217;ll use a bit of ERB to run non-printing Ruby code (with <code>&lt;%</code> and <code>%&gt;</code>) and a bit of Ruby (<code>.each</code>) to iterate through a collection named <code>ideas</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;html&gt;</span>
</span><span class='line'><span class="x">  &lt;head&gt;...&lt;/head&gt;</span>
</span><span class='line'><span class="x">  &lt;body&gt;</span>
</span><span class='line'><span class="x">    &lt;h1&gt;...&lt;/h1&gt;</span>
</span><span class='line'><span class="x">    &lt;form&gt;...&lt;/form&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="x">    &lt;h3&gt;Existing Ideas&lt;/h3&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="x">    &lt;ul&gt;</span>
</span><span class='line'><span class="x">      </span><span class="cp">&lt;%</span> <span class="n">ideas</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">idea</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">        &lt;li&gt;</span>
</span><span class='line'><span class="x">          </span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">title</span> <span class="cp">%&gt;</span><span class="x">&lt;br/&gt;</span>
</span><span class='line'><span class="x">          </span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">description</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">        &lt;/li&gt;</span>
</span><span class='line'><span class="x">      </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">    &lt;/ul&gt;</span>
</span><span class='line'><span class="x">  &lt;/body&gt;</span>
</span><span class='line'><span class="x">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Reload the page in your browser, but you&#8217;ll get an error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NameError: undefined local variable or method 'ideas'</span></code></pre></td></tr></table></div></figure>

<p>We don&#8217;t have a collection named <code>ideas</code>.</p>

<h4>Querying for the <code>ideas</code></h4>

<p>Open up <code>app.rb</code>, and change the <code>GET /</code> action to include <code>locals</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">erb</span> <span class="ss">:index</span><span class="p">,</span> <span class="n">locals</span><span class="p">:</span> <span class="p">{</span><span class="n">ideas</span><span class="p">:</span> <span class="o">[]</span><span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>This means <em>render the ERB template named <code>index</code> and define in that scope the local variable named <code>ideas</code> with the value <code>[]</code></em>.</p>

<p>We don&#8217;t really want to pass over an empty array. How do we get all the ideas?</p>

<p>We&#8217;d like it to look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">erb</span> <span class="ss">:index</span><span class="p">,</span> <span class="n">locals</span><span class="p">:</span> <span class="p">{</span><span class="n">ideas</span><span class="p">:</span> <span class="no">Idea</span><span class="o">.</span><span class="n">all</span><span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Since we&#8217;re programming by wishful thinking, let&#8217;s see what our application
thinks about this. Reload the root page of the app.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NoMethodError: undefined method 'all' for Idea:Class</span></code></pre></td></tr></table></div></figure>

<p>We&#8217;ll now define a method <code>all</code> on the <code>Idea</code> class.</p>

<h4>Implementing <code>Idea.all</code></h4>

<p>We&#8217;ll use our <code>database</code> method to get the database instance, then call <code>transaction</code> to start a set of operations. We&#8217;ll fetch the entire <code>ideas</code> collection or, if it doesn&#8217;t exist, return just an empty array:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Idea</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">all</span>
</span><span class='line'>    <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span> <span class="o">|</span><span class="n">db</span><span class="o">|</span>
</span><span class='line'>      <span class="n">db</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="o">[]</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># ...</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Reload the page and you&#8217;ll get a new error.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NameError: undefined local variable or method `database' for Idea:Class</span></code></pre></td></tr></table></div></figure>

<p>We have a <code>database</code> method, but it&#8217;s only
available to the <em>instances</em> of <code>Idea</code>, not the <code>Idea</code> class itself.</p>

<h5>Make <code>database</code> a Class Method</h5>

<p>Let&#8217;s change <code>database</code> method to be defined on the class:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Idea</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">all</span>
</span><span class='line'>    <span class="c1"># ...</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">database</span>
</span><span class='line'>    <span class="vi">@database</span> <span class="o">||=</span> <span class="no">YAML</span><span class="o">::</span><span class="no">Store</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;ideabox&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># ...</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">database</span>
</span><span class='line'>    <span class="no">Idea</span><span class="o">.</span><span class="n">database</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Notice that the old instance method <code>database</code> now just calls <code>Idea.database</code>. The result is that, in either an instance method or class method, we can now call <code>database</code> to get our database.</p>

<p>Reload the page and you&#8217;ll get another error.</p>

<h3>Building Objects from a Hash</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NoMethodError: undefined method `title' for {:title=&gt;"diet", :description=&gt;"pizza all the time"}:Hash</span></code></pre></td></tr></table></div></figure>

<p>The view template is trying to call the <code>title</code> method on what it gets back from <code>.all</code>. But <code>all</code> is returning a collection of hashes with what <code>YAML::Store</code> returns. That hash has a key <code>:title</code>, but not a method <code>.title</code>.</p>

<p>We could modify the view template to treat the idea as a hash, but that defeats the purpose of having an <code>Idea</code> model. Our call to <code>all</code> should return <code>Idea</code> instances.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">all</span>
</span><span class='line'>  <span class="n">raw_ideas</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span> <span class="o">|</span><span class="n">db</span><span class="o">|</span>
</span><span class='line'>    <span class="n">db</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="o">[]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">raw_ideas</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">data</span><span class="o">|</span>
</span><span class='line'>    <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">data</span><span class="o">[</span><span class="ss">:title</span><span class="o">]</span><span class="p">,</span> <span class="n">data</span><span class="o">[</span><span class="ss">:description</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>This works, but let&#8217;s break it into two methods:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">all</span>
</span><span class='line'>  <span class="n">raw_ideas</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">data</span><span class="o">|</span>
</span><span class='line'>    <span class="kp">new</span><span class="p">(</span><span class="n">data</span><span class="o">[</span><span class="ss">:title</span><span class="o">]</span><span class="p">,</span> <span class="n">data</span><span class="o">[</span><span class="ss">:description</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">raw_ideas</span>
</span><span class='line'>  <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span> <span class="o">|</span><span class="n">db</span><span class="o">|</span>
</span><span class='line'>    <span class="n">db</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="o">[]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Refresh your browser and your should see all the ideas.</p>

<h3>The Big Test</h3>

<ul>
<li>Stop your server with <code>CTRL-C</code></li>
<li>Delete the <code>ideabox</code> database file</li>
<li>Start the server</li>
<li>Visit the root page in your browser</li>
<li>It should load without error and display no ideas</li>
<li>Add an idea using the form</li>
<li>You should return to the root page and see your idea</li>
<li>Repeat until you&#8217;re bored</li>
</ul>

<h2>I3: Deleting Ideas</h2>

<p>It&#8217;s great that you can record ideas, but what happens to the bad ones? They sit there forever, taunting you. Let&#8217;s build out features to edit and delete ideas.</p>

<h3>Big Picture</h3>

<p>For deletion to work, we need a few things:</p>

<ol>
<li>We need to be able to find a particular idea in the database.
Right now they only have a title and a description, but what if we have the
same idea in the database twice by accident? We only want to delete one of
them.</li>
<li>We need a route that, given some unique identifier, will tell
the <code>Idea</code> model to delete the specified idea.</li>
<li>We need the <code>Idea</code> model to know how to delete an idea.</li>
</ol>

<h3>Unique Identifier</h3>

<p>Let&#8217;s use the position of the idea in the list to identify the idea.</p>

<h4>Adding the Position to the View</h4>

<p>In the view we can get the position, or index, by changing the <code>ideas.each</code> loop to be an <code>ideas.each_with_index</code> loop:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;ul&gt;</span>
</span><span class='line'><span class="x">  </span><span class="cp">&lt;%</span> <span class="n">ideas</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">idea</span><span class="p">,</span> <span class="nb">id</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">    &lt;li&gt;</span>
</span><span class='line'><span class="x">      </span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">title</span> <span class="cp">%&gt;</span><span class="x"> (</span><span class="cp">&lt;%=</span> <span class="nb">id</span> <span class="cp">%&gt;</span><span class="x">)&lt;br/&gt;</span>
</span><span class='line'><span class="x">      </span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">description</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">    &lt;/li&gt;</span>
</span><span class='line'><span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;/ul&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Refresh the page and each idea will have its position number next to the title.</p>

<h3>Adding a Delete Button</h3>

<p>We can then use the <code>id</code> to find a certain idea. Let&#8217;s create a small form for each idea that has a delete button:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;ul&gt;</span>
</span><span class='line'><span class="x">  </span><span class="cp">&lt;%</span> <span class="n">ideas</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">idea</span><span class="p">,</span> <span class="nb">id</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">    &lt;li&gt;</span>
</span><span class='line'><span class="x">      </span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">title</span> <span class="cp">%&gt;</span><span class="x"> (</span><span class="cp">&lt;%=</span> <span class="nb">id</span> <span class="cp">%&gt;</span><span class="x">)&lt;br/&gt;</span>
</span><span class='line'><span class="x">      </span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">description</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">      &lt;form action=&quot;/</span><span class="cp">&lt;%=</span> <span class="nb">id</span> <span class="cp">%&gt;</span><span class="x">&quot; method=&quot;POST&quot;&gt;</span>
</span><span class='line'><span class="x">        &lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;DELETE&quot;&gt;</span>
</span><span class='line'><span class="x">        &lt;input type=&quot;submit&quot; value=&quot;delete&quot;/&gt;</span>
</span><span class='line'><span class="x">      &lt;/form&gt;</span>
</span><span class='line'><span class="x">    &lt;/li&gt;</span>
</span><span class='line'><span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;/ul&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>HTTP has a <code>DELETE</code> verb, like the <code>GET</code> and <code>POST</code> we&#8217;ve seen before, but few browsers actually use it.</p>

<p>Instead we&#8217;ll use a common pattern to work around the limitation. Our form will send a <code>POST</code> request, but in the form data we&#8217;ll embed a marker indicating that we want to delete a record. The convention is to name this marker <code>_method</code> as you can see in the hidden field above.</p>

<p>Refresh the page, click a delete button, and&#8230; boom.</p>

<h3>Defining the Delete Route</h3>

<p>It fails because we haven&#8217;t defined <code>delete '/:id'</code>. Let&#8217;s do that now:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">delete</span> <span class="s1">&#39;/:id&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>  <span class="s2">&quot;DELETING an idea!&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Try deleting an idea again and&#8230; still boom.</p>

<h3>Sinatra&#8217;s <code>method_override</code></h3>

<p>Sinatra is still looking for a <code>POST</code> route, not a <code>DELETE</code>.</p>

<p>Sinatra knows about the workaround using the <code>_method</code> parameter, but we need to enable it.</p>

<p>In your <code>app.rb</code> file add this line to the top of your class definition:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">IdeaBoxApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">set</span> <span class="ss">:method_override</span><span class="p">,</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># ...</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Now Sinatra will pretend that the incoming request used the <code>DELETE</code> verb instead of <code>POST</code>.</p>

<p>Try deleting an idea again, and you should see &quot;DELETING an idea!&quot; in the browser.</p>

<h3>A Real Delete Action</h3>

<p>What do we want <code>delete '/:id'</code> to actually do?</p>

<ul>
<li>Delete the idea</li>
<li>Redirect back to the root page</li>
</ul>

<p>We&#8217;d like it to work like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">delete</span> <span class="s1">&#39;/:id&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>  <span class="no">Idea</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span class='line'>  <span class="n">redirect</span> <span class="s1">&#39;/&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Flip back to your browser, and try to delete an idea. You should get an error saying that there is no <code>delete</code> method on the <code>Idea</code> class.</p>

<h3>Add <code>delete</code> to <code>Idea</code></h3>

<p>We can fix this by adding a <code>delete</code> method in <code>idea.rb</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Idea</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">delete</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
</span><span class='line'>    <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">].</span><span class="n">delete_at</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>The <code>delete</code> method starts a transaction, accesses the <code>ideas</code> collection, then uses the <code>delete_at</code> method to remove the element at a certain position.</p>

<p>This is an example of &quot;duck typing.&quot; The <code>delete_at</code> method in <code>YAML::Store</code> is built to work like the <code>delete_at</code> method on <code>Array</code>. You as a developer don&#8217;t have to think about how <code>YAML::Store</code> works, you just pretend it&#8217;s an <code>Array</code>.</p>

<p>Now try deleting the idea again in your browser.</p>

<h3>Positions are Integers, Parameters are Strings</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>can't convert String into Integer</span></code></pre></td></tr></table></div></figure>

<p>We&#8217;re trying doing the equivalent of this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="o">].</span><span class="n">delete_at</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<p>The position needs to be an integer, not a string. Where did the string come from?</p>

<p>HTTP requests are just made of strings. So when you use <code>params</code> in a Sinatra app, the values from the request are <em>always</em> strings. Our form is submitting the position as a parameter in the HTTP request. When we pass that parameter into the <code>delete</code> method the position is a string. But <code>delete_at</code> will only work with an integer.</p>

<p>Let&#8217;s deal with that by calling <code>.to_i</code> on the <code>id</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">delete</span> <span class="s1">&#39;/:id&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>  <span class="no">Idea</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">to_i</span><span class="p">)</span>
</span><span class='line'>  <span class="n">redirect</span> <span class="s1">&#39;/&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Refresh and try deleting an idea from the browser &#8211; it works!</p>

<h2>I4: Editing an Idea</h2>

<p>We can add new ideas and delete ideas we don&#8217;t like, but sometimes things are <em>almost</em> right. We should be able to improve existing ideas. Let&#8217;s add a link for each idea that will take us to a page where we can edit it.</p>

<h3>Adding an Edit Link</h3>

<p>We&#8217;ll use the same positional identifier to figure out which element to edit. Let&#8217;s use the url pattern <code>id/edit</code> where <code>id</code> is the position of the idea.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;ul&gt;</span>
</span><span class='line'><span class="x">  </span><span class="cp">&lt;%</span> <span class="n">ideas</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">idea</span><span class="p">,</span> <span class="nb">id</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">    &lt;li&gt;</span>
</span><span class='line'><span class="x">      </span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">title</span> <span class="cp">%&gt;</span><span class="x">&lt;br/&gt;</span>
</span><span class='line'><span class="x">      </span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">description</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">      &lt;a href=&quot;/</span><span class="cp">&lt;%=</span> <span class="nb">id</span> <span class="cp">%&gt;</span><span class="x">/edit&quot;&gt;Edit&lt;/a&gt;</span>
</span><span class='line'><span class="x">      &lt;form action=&quot;/</span><span class="cp">&lt;%=</span> <span class="nb">id</span> <span class="cp">%&gt;</span><span class="x">&quot; method=&quot;POST&quot;&gt;</span>
</span><span class='line'><span class="x">        &lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;DELETE&quot;&gt;</span>
</span><span class='line'><span class="x">        &lt;input type=&quot;submit&quot; value=&quot;delete&quot;/&gt;</span>
</span><span class='line'><span class="x">      &lt;/form&gt;</span>
</span><span class='line'><span class="x">    &lt;/li&gt;</span>
</span><span class='line'><span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;/ul&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Reload the page, and click the <em>edit</em> link for one of the ideas.</p>

<h3>Add the Edit Action</h3>

<p>Our error tells us that the request <code>id/edit</code> didn&#8217;t match any known actions. Let&#8217;s add an action with that pattern:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">get</span> <span class="s1">&#39;/:id/edit&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>  <span class="s2">&quot;Edit an idea!&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Refresh the browser and click an edit link, then you will see <code>Edit an idea!</code>.</p>

<h3>Render an Edit Template</h3>

<p>Let&#8217;s render a view template instead of just returning a string:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">get</span> <span class="s1">&#39;/:id/edit&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>  <span class="n">erb</span> <span class="ss">:edit</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Refresh the browser and you&#8217;ll get an error since the template doesn&#8217;t exist yet.</p>

<h4>Create the Edit Template</h4>

<p>You see:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Errno::ENOENT at /0/edit
</span><span class='line'>No such file or directory - /Users/code/idea_box/views/edit.erb</span></code></pre></td></tr></table></div></figure>

<p>Create a file in the <em>views</em> directory named <code>edit.erb</code>, and put the following
code into it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;html&gt;</span>
</span><span class='line'><span class="x">  &lt;head&gt;</span>
</span><span class='line'><span class="x">    &lt;title&gt;IdeaBox&lt;/title&gt;</span>
</span><span class='line'><span class="x">  &lt;/head&gt;</span>
</span><span class='line'><span class="x">  &lt;body&gt;</span>
</span><span class='line'><span class="x">    &lt;h1&gt;IdeaBox&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="x">    &lt;form action=&quot;/</span><span class="cp">&lt;%=</span> <span class="nb">id</span> <span class="cp">%&gt;</span><span class="x">&quot; method=&quot;POST&quot;&gt;</span>
</span><span class='line'><span class="x">      &lt;p&gt;</span>
</span><span class='line'><span class="x">        Edit your Idea:</span>
</span><span class='line'><span class="x">      &lt;/p&gt;</span>
</span><span class='line'><span class="x">      &lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;PUT&quot; /&gt;</span>
</span><span class='line'><span class="x">      &lt;input type=&#39;text&#39; name=&#39;idea_title&#39; value=&quot;</span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">title</span> <span class="cp">%&gt;</span><span class="x">&quot;/&gt;&lt;br/&gt;</span>
</span><span class='line'><span class="x">      &lt;textarea name=&#39;idea_description&#39;&gt;</span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">description</span> <span class="cp">%&gt;</span><span class="x">&lt;/textarea&gt;&lt;br/&gt;</span>
</span><span class='line'><span class="x">      &lt;input type=&#39;submit&#39;/&gt;</span>
</span><span class='line'><span class="x">    &lt;/form&gt;</span>
</span><span class='line'><span class="x">  &lt;/body&gt;</span>
</span><span class='line'><span class="x">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Again we&#8217;re creating a form which uses the <code>POST</code> method, and giving Sinatra the
extra information in <code>_method=PUT</code> to say that even though this is coming in
with the <code>POST</code> verb, we actually want it to be a <code>PUT</code>.</p>

<p>Then the form has <code>input</code> tags for the title and description. The <code>value</code> attribute uses the current values for the idea rather than having blank boxes.</p>

<h4>Setting Up the <code>id</code></h4>

<p>Refresh and the next error is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NameError: undefined local variable or method `id'</span></code></pre></td></tr></table></div></figure>

<p>The <code>edit.erb</code> references <code>id</code> on line 8, but that local variable doesn&#8217;t exist. Jump back into the <code>app.rb</code> file and change the <code>get '/:id/edit'</code> method to specify a local variable named <code>id</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">get</span> <span class="s1">&#39;/:id/edit&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>  <span class="n">erb</span> <span class="ss">:edit</span><span class="p">,</span> <span class="n">locals</span><span class="p">:</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="nb">id</span><span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>What&#8217;s up with <code>id: id</code>? In the <code>get</code> call of the action you&#8217;ll see <code>:id</code> in the route pattern. Sinatra will automatically take the value in that spot of the URL and make it available to us in a local variable with the name we specified in the pattern. We could have used <code>:idea_id</code> in the pattern, for instance, then that would have been the name of the variable.</p>

<p>So the <code>locals: {id: id}</code> is saying &quot;create a local variable for the ERB template with the name <code>id</code> which is a reference to the value in the <code>id</code> variable in this action&#8217;s scope.&quot;</p>

<h4>What is <code>idea</code>?</h4>

<p>Reload the page again, and you should get a new error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NameError: undefined local variable or method `idea'</span></code></pre></td></tr></table></div></figure>

<p>The edit template is trying to call <code>idea.title</code> and <code>idea.description</code>, but it doesn&#8217;t have a thing named <code>idea</code>. We need get the idea from the database and pass it to the view template.</p>

<p>Change the controller action so that it looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">get</span> <span class="s1">&#39;/:id/edit&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>  <span class="n">idea</span> <span class="o">=</span> <span class="no">Idea</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span class='line'>  <span class="n">erb</span> <span class="ss">:edit</span><span class="p">,</span> <span class="n">locals</span><span class="p">:</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="nb">id</span><span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<h4>What is <code>find</code>?</h4>

<p>Refresh and the application complains about not having a <code>find</code> method on <code>Idea</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">NoMethodError</span><span class="p">:</span> <span class="n">undefined</span> <span class="nb">method</span> <span class="sb">`find&#39; for Idea:Class</span>
</span></code></pre></td></tr></table></div></figure>

<p>Jump into the <code>idea.rb</code> file and add this class method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">find</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span class='line'>  <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">].</span><span class="n">at</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Just like before, we use the <code>at</code> method that&#8217;s a part of both <code>Array</code> and <code>YAML::Store</code>.</p>

<h4>Parameters are Still Strings</h4>

<p>Refresh and you&#8217;ll get this error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>TypeError: can't convert String into Integer</span></code></pre></td></tr></table></div></figure>

<p>Once again, we&#8217;re trying to index into an array with a string rather than an
integer.</p>

<p>Change the action to use <code>to_i</code> on the <code>id</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">get</span> <span class="s1">&#39;/:id/edit&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>  <span class="n">idea</span> <span class="o">=</span> <span class="no">Idea</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">to_i</span><span class="p">)</span>
</span><span class='line'>  <span class="n">erb</span> <span class="ss">:edit</span><span class="p">,</span> <span class="n">locals</span><span class="p">:</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="nb">id</span><span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Setup the <code>idea</code> Local Variable</h4>

<p>Reload the page again, and we&#8217;re back to this error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NameError: undefined local variable or method `idea'</span></code></pre></td></tr></table></div></figure>

<p>We have to actually pass our idea to the view template:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">get</span> <span class="s1">&#39;/:id/edit&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>  <span class="n">idea</span> <span class="o">=</span> <span class="no">Idea</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">to_i</span><span class="p">)</span>
</span><span class='line'>  <span class="n">erb</span> <span class="ss">:edit</span><span class="p">,</span> <span class="n">locals</span><span class="p">:</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span> <span class="n">idea</span><span class="p">:</span> <span class="n">idea</span><span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Reload the page.</p>

<h4>Finding an Object, not a Hash</h4>

<p>Now we&#8217;re getting:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NoMethodError: undefined method `title' for {:title=&gt;"diet", :description=&gt;"pizza all the
</span><span class='line'>time"}:Hash</span></code></pre></td></tr></table></div></figure>

<p>We are getting the raw hash out of the database, and we need to turn it into
an idea. Change the <code>find</code> method in <code>idea.rb</code> so we&#8217;re getting a raw idea and then
creating a new Idea instance with it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">find</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span class='line'>  <span class="n">raw_idea</span> <span class="o">=</span> <span class="n">find_raw_idea</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span class='line'>  <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">raw_idea</span><span class="o">[</span><span class="ss">:title</span><span class="o">]</span><span class="p">,</span> <span class="n">raw_idea</span><span class="o">[</span><span class="ss">:description</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">find_raw_idea</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span class='line'>  <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">].</span><span class="n">at</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>And <em>finally</em>, the edit page shows up with a form and our ideas in it.</p>

<h3>Storing the Idea Changes</h3>

<p>What happens if you tweak the idea title and description then submit the form?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>An Error Occured
</span><span class='line'>
</span><span class='line'>Params
</span><span class='line'>
</span><span class='line'>Request Verb  PUT
</span><span class='line'>Request Path  /0
</span><span class='line'>Parameters
</span><span class='line'>_method   PUT
</span><span class='line'>idea_title    music
</span><span class='line'>idea_description  really fast drums</span></code></pre></td></tr></table></div></figure>

<p>We built a <code>get</code> action to display the edit form, but we need a different action (using <code>PUT</code>) to store the data coming back from that form.</p>

<h4>Add a <code>PUT</code> Action</h4>

<p>Create this action:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">put</span> <span class="s1">&#39;/:id&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>  <span class="s2">&quot;Tweaking the IDEA!&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Refresh and there&#8217;s no error, but it isn&#8217;t updating the content. We need to:</p>

<ul>
<li>update the idea in the database</li>
<li>redirect to the index page</li>
</ul>

<h3>How the Content Should Be Updated</h3>

<p>What should this look like? Maybe something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">put</span> <span class="s1">&#39;/:id&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>  <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="ss">:title</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="s1">&#39;idea_title&#39;</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:description</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="s1">&#39;idea_description&#39;</span><span class="o">]</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="no">Idea</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">to_i</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span class='line'>  <span class="n">redirect</span> <span class="s1">&#39;/&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>This approach builds a hash with the title and description, stores it into the name <code>data</code>, then passes that <code>data</code> to a method named <code>update</code> on <code>Idea</code>. It&#8217;s not pretty, but we can make it work and then improve it later.</p>

<p>Reload the page.</p>

<h3>Writing the <code>update</code> Method</h3>

<p>Then you&#8217;ll see this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NoMethodError: undefined method `update' for Idea:Class</span></code></pre></td></tr></table></div></figure>

<p>We need to write the <code>update</code> class method on <code>Idea</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">update</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span class='line'>  <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">][</span><span class="nb">id</span><span class="o">]</span> <span class="o">=</span> <span class="n">data</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Reload the page again, and you should see your updated idea!</p>

<h2>I5: Refactoring <code>Idea</code></h2>

<p>There&#8217;s a lot that is klunky about our implementation so far.</p>

<h3>How Ideas are Built</h3>

<p>When we create a new instance of <code>Idea</code> we say:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<p>But we often want to create an idea based on a hash that comes out of the
database like in the <code>find</code> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">find</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span class='line'>  <span class="n">raw_idea</span> <span class="o">=</span> <span class="n">find_raw_idea</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span class='line'>  <span class="kp">new</span><span class="p">(</span><span class="n">raw_idea</span><span class="o">[</span><span class="ss">:title</span><span class="o">]</span><span class="p">,</span> <span class="n">raw_idea</span><span class="o">[</span><span class="ss">:description</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>It would be nice if we could just give that hash straight to <code>Idea.new</code> like
this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">raw_idea</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<h4>A Hash-Based <code>initialize</code></h4>

<p>In <code>idea.rb</code> we need to:</p>

<ol>
<li>update the <code>initialize</code> method definition to take a hash.</li>
<li>update the <code>self.find</code> method to pass a hash to <code>new</code>.</li>
<li>update the <code>self.all</code> method to pass a hash to <code>new</code>.</li>
</ol>

<p>We also need to make a change in <code>app.rb</code> in the <code>POST /</code> endpoint to pass a
hash to the <code>Idea.new</code> method instead of two distinct parameters.</p>

<p>The results look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@title</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:title</span><span class="o">]</span>
</span><span class='line'>  <span class="vi">@description</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:description</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">all</span>
</span><span class='line'>  <span class="n">raw_ideas</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">data</span><span class="o">|</span>
</span><span class='line'>    <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">find</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span class='line'>  <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">find_raw_idea</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>And the new <code>POST /</code> action can be like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">idea</span> <span class="o">=</span> <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">title</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="s1">&#39;idea_title&#39;</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>                  <span class="n">description</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="s1">&#39;idea_description&#39;</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="n">idea</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>  <span class="n">redirect</span> <span class="s1">&#39;/&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Test your app to make sure you can still add new ideas and edit them, and that
the right ideas show up in the list of all the ideas.</p>

<h4>Improving the <code>POST /</code> Action</h4>

<p>That <code>POST /</code> endpoint looks worse than it did before. It would be nice if we could
just give the <code>Idea.new</code> a hash straight from the <code>params</code>.</p>

<p>We can by changing the form. Remember that the names of the <code>input</code> tags in the form determine the keys that are available in <code>params</code>. Change the form so the <code>input</code> tags are named like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;form action=&#39;/&#39; method=&#39;POST&#39;&gt;</span>
</span><span class='line'><span class="x">  &lt;p&gt;</span>
</span><span class='line'><span class="x">  Your Idea:</span>
</span><span class='line'><span class="x">  &lt;/p&gt;</span>
</span><span class='line'><span class="x">  &lt;input type=&#39;text&#39; name=&#39;idea[title]&#39;/&gt;&lt;br/&gt;</span>
</span><span class='line'><span class="x">  &lt;textarea name=&#39;idea[description]&#39;&gt;&lt;/textarea&gt;&lt;br/&gt;</span>
</span><span class='line'><span class="x">  &lt;input type=&#39;submit&#39;/&gt;</span>
</span><span class='line'><span class="x">&lt;/form&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Notice how we changed <code>idea_title</code> and <code>idea_description</code> to <code>idea[title]</code> and
<code>idea[description]</code>? Sinatra will automatically group them into a nested hash within <code>params</code>. So in the action receiving the request we&#8217;ll have <code>params</code> like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">{</span><span class="s1">&#39;idea&#39;</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;My Title&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;My Description&#39;</span><span class="p">}}</span>
</span></code></pre></td></tr></table></div></figure>

<p>The nested hash under the key <code>'idea'</code> has the exact same keys that we were previously building up in the <code>POST</code> action. Therefore we can fetch this nested hash out from <code>params</code> and pass that whole thing to the <code>initialize</code> of <code>Idea</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">idea</span> <span class="o">=</span> <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:idea</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="n">idea</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>  <span class="n">redirect</span> <span class="s1">&#39;/&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Test your app, to make sure it still works!</p>

<h4>Fixing Edit and Update Actions</h4>

<p>We also need to fix the form in <code>edit.erb</code>  and the corresponding <code>PUT /:id</code>
endpoint to use the same <code>params</code> style:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;form action=&quot;/</span><span class="cp">&lt;%=</span> <span class="nb">id</span> <span class="cp">%&gt;</span><span class="x">&quot; method=&#39;POST&#39;&gt;</span>
</span><span class='line'><span class="x">  &lt;p&gt;</span>
</span><span class='line'><span class="x">    Edit your Idea:</span>
</span><span class='line'><span class="x">  &lt;/p&gt;</span>
</span><span class='line'><span class="x">  &lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;PUT&quot; /&gt;</span>
</span><span class='line'><span class="x">  &lt;input type=&#39;text&#39; name=&#39;idea[title]&#39; value=&quot;</span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">title</span> <span class="cp">%&gt;</span><span class="x">&quot;/&gt;&lt;br/&gt;</span>
</span><span class='line'><span class="x">  &lt;textarea name=&#39;idea[description]&#39;&gt;</span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">description</span> <span class="cp">%&gt;</span><span class="x">&lt;/textarea&gt;&lt;br/&gt;</span>
</span><span class='line'><span class="x">  &lt;input type=&#39;submit&#39;/&gt;</span>
</span><span class='line'><span class="x">&lt;/form&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">put</span> <span class="s1">&#39;/:id&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>  <span class="no">Idea</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">to_i</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="ss">:idea</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="n">redirect</span> <span class="s1">&#39;/&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<h5>Debugging a Type Issue</h5>

<p>This doesn&#8217;t quite work. When we update ideas, we end up with empty ideas in
the list.</p>

<p>If you look at the database file, some of the ideas look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="nn">---</span>
</span><span class='line'><span class="l-Scalar-Plain">ideas</span><span class="p-Indicator">:</span>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">:title</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">dinner</span>
</span><span class='line'>  <span class="l-Scalar-Plain">:description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pizza</span>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">:title</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">dessert</span>
</span><span class='line'>  <span class="l-Scalar-Plain">:description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">candy, soda, and ice cream</span>
</span></code></pre></td></tr></table></div></figure>

<p>Whereas other ideas look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="nn">---</span>
</span><span class='line'><span class="l-Scalar-Plain">ideas</span><span class="p-Indicator">:</span>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">dinner</span>
</span><span class='line'>  <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pizza</span>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">dessert</span>
</span><span class='line'>  <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">candy, soda, and ice cream</span>
</span></code></pre></td></tr></table></div></figure>

<p>Can you see how they&#8217;re different?</p>

<p>It&#8217;s pretty subtle. In one, the <code>title</code> and <code>description</code> have colons on both
sides of the string, and in the other, they only have a colon at the end of
the string.</p>

<p>Essentially, <code>:title:</code> is the YAML for the Ruby <em>symbol</em> <code>:title</code>, whereas
<code>title:</code> is YAML for the Ruby <em>string</em> <code>&quot;title&quot;</code>.</p>

<p>When the <code>params</code> object comes back, we send it directly to <code>Idea.update</code>.
While we can access fields in the <code>params</code> using both strings and symbols for
the keys, if we just grab the value of <code>params[:idea]</code>, we&#8217;ll get a hash with
<em>string</em> values for the keys:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">{</span><span class="s2">&quot;title&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;game&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;tic tac toe&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

<p>We can either jump through some hoops to deal with both strings and symbols,
or change the update so we explicitly pass symbols to the database, or we can
just use strings all the way through the app. Let&#8217;s just use strings.</p>

<p>We need to update the <code>initialize</code> and <code>save</code> methods in <code>idea.rb</code> to use
strings for the hash keys instead of symbols:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@title</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="s2">&quot;title&quot;</span><span class="o">]</span>
</span><span class='line'>  <span class="vi">@description</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="s2">&quot;description&quot;</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">save</span>
</span><span class='line'>  <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">]</span> <span class="o">||=</span> <span class="o">[]</span>
</span><span class='line'>    <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">]</span> <span class="o">&lt;&lt;</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span> <span class="o">=&gt;</span> <span class="n">title</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span> <span class="o">=&gt;</span> <span class="n">description</span><span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>There. Now both creating and editing ideas should work correctly.</p>

<h2>I6: Using a View Layout</h2>

<p>Our view templates have a lot of duplication. View layouts are used to define the &quot;boilerplate&quot; HTML that should go on every page. Typically this includes the header, navigation, sidebar, and footer. Then the view template only has to focus on the content for that action/page.</p>

<h3>Create <code>layout.erb</code></h3>

<p>Copy your <code>views/index.erb</code> to a file named <code>views/layout.erb</code>. Open up the new
<code>layout.erb</code> file, and delete everything inside the <body> tags so that you
end up with this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;html&gt;</span>
</span><span class='line'><span class="x">  &lt;head&gt;</span>
</span><span class='line'><span class="x">    &lt;title&gt;IdeaBox&lt;/title&gt;</span>
</span><span class='line'><span class="x">  &lt;/head&gt;</span>
</span><span class='line'><span class="x">  &lt;body&gt;</span>
</span><span class='line'><span class="x">  &lt;/body&gt;</span>
</span><span class='line'><span class="x">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Reload the root page in your browser and you should see no content, just a white page. Sinatra is automatically noticing this <code>layout.erb</code> and wrapping the <code>index.erb</code> with the layout.</p>

<p><em>However</em>, this layout doesn&#8217;t allow the content of the view template to actually be rendered. To do that, we need to add a call to <code>yield</code> inside the <code>&lt;body&gt;</code> tags like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;body&gt;</span>
</span><span class='line'><span class="x">  </span><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;/body&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Refresh the page again and you&#8217;ll see the ideas listing. But if you view the HTML source in your browser, you&#8217;ll find that it has duplicated all the <code>&lt;html&gt;</code> and <code>&lt;head&gt;</code> tags.</p>

<p>Open <code>index.erb</code> and <code>edit.erb</code> and delete all the wrapper which is in the layout. Now those view templates are just focused on what&#8217;s unique about that page.</p>

<h2>I7: Idea vs Ideas</h2>

<p>If you open up your <code>idea.rb</code> file, you&#8217;ll notice that most of the methods in
that file are not about a single idea, but about dealing with the storage and
retrieval of ideas. Let&#8217;s move the database operations out of <code>Idea</code> into a separate class named <code>IdeaStore</code>.</p>

<h3>Move Class Methods to <code>IdeaStore</code></h3>

<p>Create a new file <code>idea_store.rb</code> in the root of your project, and move all of
the method definitions that start with <code>self.</code> out of <code>idea.rb</code> and into the
new <code>idea_store.rb</code>.</p>

<p>Go ahead and move <code>require 'yaml/store'</code> as well, since that is relevant to
the storage, not the idea itself.</p>

<p>If you now have any calls to <code>new</code> in <code>IdeaStore</code> change them to
<code>Idea.new</code> instead.</p>

<h4>Modifying <code>app.rb</code> to use <code>IdeaStore</code></h4>

<p>Then we need to require the <code>idea_store</code> file from <code>app.rb</code>.</p>

<p>We also need to update the endpoints in the Sinatra app to talk to the
<code>IdeaStore</code> rather than <code>Idea</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;./idea&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;./idea_store&#39;</span>
</span><span class='line'><span class="k">class</span> <span class="nc">IdeaBoxApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">set</span> <span class="ss">:method_override</span><span class="p">,</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">not_found</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">erb</span> <span class="ss">:error</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">erb</span> <span class="ss">:index</span><span class="p">,</span> <span class="n">locals</span><span class="p">:</span> <span class="p">{</span><span class="n">ideas</span><span class="p">:</span> <span class="no">IdeaStore</span><span class="o">.</span><span class="n">all</span><span class="p">,</span> <span class="n">idea</span><span class="p">:</span> <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="p">)}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">post</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">idea</span> <span class="o">=</span> <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:idea</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="n">idea</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>    <span class="n">redirect</span> <span class="s1">&#39;/&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">delete</span> <span class="s1">&#39;/:id&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>    <span class="no">IdeaStore</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">to_i</span><span class="p">)</span>
</span><span class='line'>    <span class="n">redirect</span> <span class="s1">&#39;/&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">get</span> <span class="s1">&#39;/:id/edit&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>    <span class="n">idea</span> <span class="o">=</span> <span class="no">IdeaStore</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">to_i</span><span class="p">)</span>
</span><span class='line'>    <span class="n">erb</span> <span class="ss">:edit</span><span class="p">,</span> <span class="n">locals</span><span class="p">:</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span> <span class="n">idea</span><span class="p">:</span> <span class="n">idea</span><span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">put</span> <span class="s1">&#39;/:id&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>    <span class="no">IdeaStore</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">to_i</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="ss">:idea</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="n">redirect</span> <span class="s1">&#39;/&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<h4>A Lingering Issue</h4>

<p>We&#8217;re left with something odd. Our <code>idea.rb</code> file still has some database
specific stuff in it, in the <code>save</code> method, and in the Sinatra app, all of the
endpoints are talking to the IdeaStore, except the <code>POST /</code> endpoint.</p>

<p>By moving the database-related operations into a separate class, we can see that
we didn&#8217;t have a very consistent approach to how we&#8217;re dealing with the
database.</p>

<p>Let&#8217;s create a new method in <code>IdeaStore</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
</span><span class='line'>  <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">]</span> <span class="o">||=</span> <span class="o">[]</span>
</span><span class='line'>    <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">]</span> <span class="o">&lt;&lt;</span> <span class="n">attributes</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then we can call this method from the <code>POST /</code> endpoint in the web app,
allowing us to get rid of both the <code>save</code> and <code>database</code> method in <code>Idea</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="no">IdeaStore</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:idea</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="n">redirect</span> <span class="s1">&#39;/&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Now our use of <code>IdeaStore</code> is more consitent and no one outside of <code>IdeaStore</code> needs to know about the database.</p>

<h2>I8: Improving the Project Structure</h2>

<p>Until now we&#8217;ve pretty much been sticking everything into the root of the
project.</p>

<p>It looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>idea_box/
</span><span class='line'>├── Gemfile
</span><span class='line'>├── Gemfile.lock
</span><span class='line'>├── app.rb
</span><span class='line'>├── config.ru
</span><span class='line'>├── idea.rb
</span><span class='line'>├── idea_store.rb
</span><span class='line'>├── ideabox
</span><span class='line'>└── views
</span><span class='line'>    ├── edit.erb
</span><span class='line'>    ├── error.erb
</span><span class='line'>    ├── form.erb
</span><span class='line'>    ├── index.erb
</span><span class='line'>    └── layout.erb</span></code></pre></td></tr></table></div></figure>

<p>Let&#8217;s move towards a somewhat more idiomatic project structure like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>idea_box/
</span><span class='line'>├── Gemfile
</span><span class='line'>├── Gemfile.lock
</span><span class='line'>├── config.ru
</span><span class='line'>├── db
</span><span class='line'>│   └── ideabox
</span><span class='line'>└── lib
</span><span class='line'>    ├── app
</span><span class='line'>    │   └── views
</span><span class='line'>    │       ├── edit.erb
</span><span class='line'>    │       ├── error.erb
</span><span class='line'>    │       ├── index.erb
</span><span class='line'>    │       └── layout.erb
</span><span class='line'>    ├── app.rb
</span><span class='line'>    ├── idea_box
</span><span class='line'>    │   ├── idea.rb
</span><span class='line'>    │   └── idea_store.rb
</span><span class='line'>    └── idea_box.rb</span></code></pre></td></tr></table></div></figure>

<p>This puts all of our application under <code>lib/</code>, but separates the web application
from the pure business logic.</p>

<h3>Moving Files</h3>

<p>To get to that project structure we need to make a few changes:</p>

<p>Create new directories:</p>

<ul>
<li><code>lib/</code></li>
<li><code>lib/idea_box</code></li>
<li><code>lib/app</code></li>
<li><code>db</code></li>
</ul>

<p>Create a new file:</p>

<ul>
<li><code>lib/idea_box.rb</code></li>
</ul>

<p>Move files to their new locations:</p>

<ul>
<li><code>app.rb</code> -&gt; <code>lib/app.rb</code></li>
<li><code>views/</code> -&gt; <code>lib/app/views/</code></li>
<li><code>ideabox</code> -&gt; <code>db/ideabox</code></li>
<li><code>idea.rb</code> -&gt; <code>lib/idea_box/idea.rb</code></li>
<li><code>idea_store.rb</code> -&gt; <code>lib/idea_box/idea_store.rb</code></li>
</ul>

<h3>Updating Requires</h3>

<p>Update the require statements:</p>

<p>In <code>lib/app.rb</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;idea_box&#39;</span>
</span><span class='line'><span class="k">class</span> <span class="nc">IdeaBoxApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="c1"># ...</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>In <code>lib/idea_box.rb</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;idea_box/idea&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;idea_box/idea_store&#39;</span>
</span></code></pre></td></tr></table></div></figure>

<p>In <code>config.ru</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;app&#39;</span>
</span></code></pre></td></tr></table></div></figure>

<p>For all of these require statements to work correctly, we need to put <code>lib</code> on
our PATH.  Add this to the very top of <code>config.ru</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vg">$:</span><span class="o">.</span><span class="n">unshift</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s2">&quot;./../lib&quot;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<h3>Relocating the Database</h3>

<p>We also need to change the name of the database in <code>IdeaStore</code> to point to
the new location:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">IdeaStore</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">database</span>
</span><span class='line'>    <span class="vi">@database</span> <span class="o">||=</span> <span class="no">YAML</span><span class="o">::</span><span class="no">Store</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;db/ideabox&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># ...</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<h3>Where Are the Views?</h3>

<p>Finally, we need to tell the sinatra application where to look for its
templates:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">IdeaBoxApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">set</span> <span class="ss">:method_override</span><span class="p">,</span> <span class="kp">true</span>
</span><span class='line'>  <span class="n">set</span> <span class="ss">:root</span><span class="p">,</span> <span class="s1">&#39;lib/app&#39;</span>
</span><span class='line'>  <span class="c1"># ...</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>There. Instead of a junk drawer of files all in the root, now we have an organized project.</p>

<h2>I9: Ranking and Sorting</h2>

<p>How do we separate the good ideas from the <strong>GREAT</strong> ideas? Let&#8217;s implement
ranking and sorting.</p>

<p>First, we&#8217;ll need to store a rank inside of our ideas.</p>

<p>Update the <code>lib/idea_box/idea.rb</code> to have a rank attribute:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Idea</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:description</span><span class="p">,</span> <span class="ss">:rank</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{})</span>
</span><span class='line'>    <span class="vi">@title</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="s2">&quot;title&quot;</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@description</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="s2">&quot;description&quot;</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@rank</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="s2">&quot;rank&quot;</span><span class="o">]</span> <span class="o">||</span> <span class="mi">0</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">save</span>
</span><span class='line'>    <span class="no">IdeaStore</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;title&quot;</span> <span class="o">=&gt;</span> <span class="n">title</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span> <span class="o">=&gt;</span> <span class="n">description</span><span class="p">,</span> <span class="s2">&quot;rank&quot;</span> <span class="o">=&gt;</span> <span class="n">rank</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>That line inside of <code>save</code> is getting really long. Let&#8217;s move the list of attributes into its own method called <code>to_h</code>, which is an idiomatic way of saying <em>to hash</em>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">save</span>
</span><span class='line'>  <span class="no">IdeaStore</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">to_h</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">to_h</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;title&quot;</span> <span class="o">=&gt;</span> <span class="n">title</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;description&quot;</span> <span class="o">=&gt;</span> <span class="n">description</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;rank&quot;</span> <span class="o">=&gt;</span> <span class="n">rank</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>OK, so we have our rank, now let&#8217;s make it possible to give an idea a higher rank.</p>

<p>In the <code>lib/app/views/index.erb</code> file, add the following form inside the list of ideas, maybe before the edit link:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;form action=&#39;/</span><span class="cp">&lt;%=</span> <span class="nb">id</span> <span class="cp">%&gt;</span><span class="x">/like&#39; method=&#39;POST&#39; style=&quot;display: inline&quot;&gt;</span>
</span><span class='line'><span class="x">  &lt;input type=&#39;submit&#39; value=&quot;+&quot;/&gt;</span>
</span><span class='line'><span class="x">&lt;/form&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Now, when you click the <code>+</code> button, you&#8217;ll get a <code>not_found</code> error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>An Error Occured
</span><span class='line'>
</span><span class='line'>Params
</span><span class='line'>
</span><span class='line'>Request Verb  POST
</span><span class='line'>Request Path  /0/like
</span><span class='line'>Parameters</span></code></pre></td></tr></table></div></figure>

<p>We need an endpoint in our Sinatra application that uses the <code>POST</code> HTTP verb, and has a path that matches <code>/:id/like</code>. Let&#8217;s add it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span> <span class="s1">&#39;/:id/like&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>  <span class="s2">&quot;I like this idea!&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>If you click it again, you should see <em>I like this idea!</em> in the browser. That means that you&#8217;ve hooked up your Sinatra endpoint correctly.</p>

<p>First, let&#8217;s find the right idea. We&#8217;ve done that before:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span> <span class="s1">&#39;/:id/like&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>  <span class="n">idea</span> <span class="o">=</span> <span class="no">IdeaStore</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">to_i</span><span class="p">)</span>
</span><span class='line'>  <span class="s2">&quot;I like this idea!&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then we&#8217;ll <em>like</em> it. That might look something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span> <span class="s1">&#39;/:id/like&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>  <span class="n">idea</span> <span class="o">=</span> <span class="no">IdeaStore</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">to_i</span><span class="p">)</span>
</span><span class='line'>  <span class="n">idea</span><span class="o">.</span><span class="n">like!</span>
</span><span class='line'>  <span class="s2">&quot;I like this idea!&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>We need to make sure that our idea makes it back into the database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span> <span class="s1">&#39;/:id/like&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>  <span class="n">idea</span> <span class="o">=</span> <span class="no">IdeaStore</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">to_i</span><span class="p">)</span>
</span><span class='line'>  <span class="n">idea</span><span class="o">.</span><span class="n">like!</span>
</span><span class='line'>  <span class="no">IdeaStore</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">to_i</span><span class="p">,</span> <span class="n">idea</span><span class="o">.</span><span class="n">to_h</span><span class="p">)</span>
</span><span class='line'>  <span class="s2">&quot;I like this idea!&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>And finally, we&#8217;re going to want to redirect back to the index page:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span> <span class="s1">&#39;/:id/like&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>  <span class="n">idea</span> <span class="o">=</span> <span class="no">IdeaStore</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">to_i</span><span class="p">)</span>
</span><span class='line'>  <span class="n">idea</span><span class="o">.</span><span class="n">like!</span>
</span><span class='line'>  <span class="no">IdeaStore</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">to_i</span><span class="p">,</span> <span class="n">idea</span><span class="o">.</span><span class="n">to_h</span><span class="p">)</span>
</span><span class='line'>  <span class="n">redirect</span> <span class="s1">&#39;/&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Go ahead and try it out by clicking a <code>+</code> button by one of your ideas.</p>

<p>You should get a <code>NoMethodError</code> complaining that Idea doesn&#8217;t know anything about a <code>like!</code> method.</p>

<p>Let&#8217;s create it.</p>

<p>In <code>idea.rb</code> add the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">like!</span>
</span><span class='line'>  <span class="vi">@rank</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then try liking another idea.</p>

<p>This should take you back to the index page, which probably won&#8217;t look any different than it did. To see if it worked, take a look inside of your <code>db/ideabox</code> file.</p>

<p>One of your ideas should now have an extra line:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="nn">---</span>
</span><span class='line'><span class="l-Scalar-Plain">ideas</span><span class="p-Indicator">:</span>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">get noticed</span>
</span><span class='line'>  <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">wear barefoot shoes</span>
</span><span class='line'>  <span class="l-Scalar-Plain">rank</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1</span>
</span></code></pre></td></tr></table></div></figure>

<h3>Sorting ideas</h3>

<p>We want to be able to sort ideas, so let&#8217;s include the Ruby <code>Comparable</code> module in <code>Idea</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Idea</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Comparable</span>
</span><span class='line'>  <span class="c1"># ...</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>For <code>Comparable</code> to help us, we have to tell it how two ideas compare to each other. The way we do that is with the so-called spaceship operator, which looks like this: <code>&lt;=&gt;</code>.</p>

<p>Add this method definition to your Idea class:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">&lt;=&gt;</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span class='line'>  <span class="n">rank</span> <span class="o">&lt;=&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">rank</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Now, in the <code>GET /</code> endpoint of your Sinatra app, go ahead an sort the ideas after you pull them out of IdeaStore:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">erb</span> <span class="ss">:index</span><span class="p">,</span> <span class="n">locals</span><span class="p">:</span> <span class="p">{</span><span class="n">ideas</span><span class="p">:</span> <span class="no">IdeaStore</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">sort</span><span class="p">,</span> <span class="n">idea</span><span class="p">:</span> <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="p">)}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>If you reload your root page, the idea you <em>like</em>d ended up at the bottom. We need to swap the spaceship operator around:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">&lt;=&gt;</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span class='line'>  <span class="n">other</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;=&gt;</span> <span class="n">rank</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p><em>like</em> a few ideas, and see what happens.</p>

<p>Something <em>decidedly strange</em> happens, that&#8217;s what! If you look inside the database, the ideas you&#8217;ve been liking are not the ones with higher ranks. What&#8217;s going on?</p>

<p>It turns out that our simplistic way of giving ideas an <code>id</code> based on their order in the list isn&#8217;t cutting it. The id in the index page is based on the sort order, whereas the id when we update an idea is based on the position of the idea in the database.</p>

<p>Let&#8217;s have the database tell the idea what its id is when it gets pulled out.</p>

<p>Add another attribute <code>id</code> to idea, along with its corresponding <code>attr_reader</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Idea</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Comparable</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:description</span><span class="p">,</span> <span class="ss">:rank</span><span class="p">,</span> <span class="ss">:id</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>    <span class="c1"># ...</span>
</span><span class='line'>    <span class="vi">@id</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="s2">&quot;id&quot;</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># ...</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then, in IdeaStore, tell the Idea what id it has:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">all</span>
</span><span class='line'>  <span class="n">ideas</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>  <span class="n">raw_ideas</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">data</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="n">ideas</span> <span class="o">&lt;&lt;</span> <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="s2">&quot;id&quot;</span> <span class="o">=&gt;</span> <span class="n">i</span><span class="p">))</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">ideas</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">find</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span class='line'>  <span class="n">raw_idea</span> <span class="o">=</span> <span class="n">find_raw_idea</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span class='line'>  <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">raw_idea</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="s2">&quot;id&quot;</span> <span class="o">=&gt;</span> <span class="nb">id</span><span class="p">))</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Next we have to update the index page to use this id rather than the index of the array of ideas:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;ul&gt;</span>
</span><span class='line'><span class="x">  </span><span class="cp">&lt;%</span> <span class="n">ideas</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">idea</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">    &lt;li&gt;</span>
</span><span class='line'><span class="x">      &lt;form action=&#39;/</span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">id</span> <span class="cp">%&gt;</span><span class="x">/like&#39; method=&#39;POST&#39; style=&quot;display: inline&quot;&gt;</span>
</span><span class='line'><span class="x">        &lt;input type=&#39;submit&#39; value=&quot;+&quot;/&gt;</span>
</span><span class='line'><span class="x">      &lt;/form&gt;</span>
</span><span class='line'><span class="x">      </span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">title</span> <span class="cp">%&gt;</span><span class="x">&lt;br/&gt;</span>
</span><span class='line'><span class="x">      </span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">description</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">      &lt;a href=&quot;/</span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">id</span> <span class="cp">%&gt;</span><span class="x">/edit&quot;&gt;Edit&lt;/a&gt;</span>
</span><span class='line'><span class="x">      &lt;form action=&#39;/</span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">id</span> <span class="cp">%&gt;</span><span class="x">&#39; method=&#39;POST&#39;&gt;</span>
</span><span class='line'><span class="x">        &lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;DELETE&quot;&gt;</span>
</span><span class='line'><span class="x">        &lt;input type=&#39;submit&#39; value=&quot;delete&quot;/&gt;</span>
</span><span class='line'><span class="x">      &lt;/form&gt;</span>
</span><span class='line'><span class="x">    &lt;/li&gt;</span>
</span><span class='line'><span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;/ul&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>That takes care of showing ideas on the index page and liking the right ideas, but we&#8217;ve broken the <code>create</code> functionality.</p>

<p>Update the first line of <code>lib/app/views/edit.erb</code> to use <code>idea.id</code> instead of <code>id</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;form action=&#39;/</span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">id</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;edit&quot;</span> <span class="cp">%&gt;</span><span class="x">&#39; method=&#39;POST&#39;&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Now that we have an <code>id</code> on the idea, we don&#8217;t have to tell the edit page the id separately:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">get</span> <span class="s1">&#39;/:id/edit&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>  <span class="n">idea</span> <span class="o">=</span> <span class="no">IdeaStore</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">to_i</span><span class="p">)</span>
</span><span class='line'>  <span class="n">erb</span> <span class="ss">:edit</span><span class="p">,</span> <span class="n">locals</span><span class="p">:</span> <span class="p">{</span><span class="n">idea</span><span class="p">:</span> <span class="n">idea</span><span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then, in the edit page, change <code>id</code> to <code>idea.id</code>.</p>

<p>Notice how we have an id on ideas in the database, but that value is nil if the idea was just created with <code>Idea.new</code>?</p>

<p>This means that we can get rid of the hacky <code>mode</code> variable that we send to the <code>new</code> and <code>edit</code> forms.</p>

<p>Open up the <code>lib/app/views/edit.erb</code> and change it to this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;form action=&#39;/</span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">id</span> <span class="cp">%&gt;</span><span class="x">&#39; method=&#39;POST&#39;&gt;</span>
</span><span class='line'><span class="x">  &lt;p&gt;</span>
</span><span class='line'><span class="x">    </span><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">idea</span><span class="o">.</span><span class="n">id</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">      Edit your Idea:</span>
</span><span class='line'><span class="x">    </span><span class="cp">&lt;%</span> <span class="k">else</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">      Your Idea:</span>
</span><span class='line'><span class="x">    </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">  &lt;/p&gt;</span>
</span><span class='line'><span class="x">  </span><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">idea</span><span class="o">.</span><span class="n">id</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">    &lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;PUT&quot; /&gt;</span>
</span><span class='line'><span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">  &lt;input type=&#39;text&#39; name=&#39;idea[title]&#39; value=&quot;</span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">title</span> <span class="cp">%&gt;</span><span class="x">&quot;/&gt;&lt;br/&gt;</span>
</span><span class='line'><span class="x">  &lt;textarea name=&#39;idea[description]&#39;&gt;</span><span class="cp">&lt;%=</span> <span class="n">idea</span><span class="o">.</span><span class="n">description</span> <span class="cp">%&gt;</span><span class="x">&lt;/textarea&gt;&lt;br/&gt;</span>
</span><span class='line'><span class="x">  &lt;input type=&#39;submit&#39;/&gt;</span>
</span><span class='line'><span class="x">&lt;/form&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Now we can delete the stray <code>mode</code> variables. There&#8217;s one in <code>index.erb</code> and one in <code>edit.erb</code>.</p>

<p>Delete your database, restart your application, and try adding, deleting, editing, and voting on ideas.</p>

<p>We&#8217;ve managed to break the application yet again!</p>

<p>In IdeaStore, we don&#8217;t actually create an empty array in the database until we create the first idea, but we want to get all the ideas and loop through them to show them on the root page. Since they&#8217;re nil, the page is blowing up.</p>

<p>Let&#8217;s fix this by always making sure that the database has an empty array of ideas when we load it up:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">database</span>
</span><span class='line'>  <span class="k">return</span> <span class="vi">@database</span> <span class="k">if</span> <span class="vi">@database</span>
</span><span class='line'>
</span><span class='line'>  <span class="vi">@database</span> <span class="o">=</span> <span class="no">YAML</span><span class="o">::</span><span class="no">Store</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;db/ideabox&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>    <span class="vi">@database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">]</span> <span class="o">||=</span> <span class="o">[]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="vi">@database</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Since we now know that the database always has an array of ideas on it, we can simplify the <code>create</code> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>  <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">]</span> <span class="o">&lt;&lt;</span> <span class="n">data</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>There. This time we really are done.</p>

<h2>Extensions</h2>

<p>Your application is able to capture, rank and sort ideas. If only that was enough
for you. The following extensions allow you to define additional features to
make your application more dynamic and interesting.</p>

<h3>Tagging</h3>

<p>Besides viewing ideas in ranked order  it would be great if you could also view
ideas that are similar to one another or share the same thing that ignited the
idea.</p>

<ul>
<li>When you create an idea you can specify one or more tags.</li>
<li>A tag is a single phrase, a single word or fragment sentence, that you use
to describe an idea.</li>
<li>Each idea can have one or more tags</li>
<li>You are able to view all ideas for a given tag</li>
<li>You are able to view all ideas sorted by tags</li>
</ul>

<h3>Statistics</h3>

<p>After creating ideas you want to start tracking when you create your ideas.</p>

<ul>
<li>When ideas are created the time they were created is captured.</li>
<li>You are able to view a breakdown of ideas created across the hours of the day
(e.g. 12:00AM to 12:59AM, 1:00AM to 1:59AM)</li>
<li>You are able to view a breakdown of ideas created acorss the days of the week
(i.e. Mon, Tue, Wed, Thu, Fri, Sat, Sun)</li>
</ul>

<h3>Revisions</h3>

<p>You start with an idea that eventually changes over time. Where you started from
and where you ended is a very different place. Sometimes you would like to see
the evolution of an idea.</p>

<ul>
<li>When you edit and save an idea the previous version of the idea is also saved.</li>
<li>An idea now has a history or list of revisions</li>
<li>You are able to view the history of an idea</li>
</ul>

<h3>Grouped Ideas</h3>

<p>Tagging allows for you to view ideas that within a certian category. Sometimes
you want to differentiate your work ideas from your personal ideas.</p>

<ul>
<li>By default all ideas are added to a default group</li>
<li>You are to define additional groups</li>
<li>When you create an idea you can specify the group for that idea</li>
<li>An idea can only belong to a single group</li>
<li>You can view only the ideas contained in a particular group</li>
<li>When sorting ideas on rank or tags only the ideas within that group are sorted</li>
</ul>

<h3>Mobile Friendly</h3>

<p>Ideas strike like lightning and it is important to be able to be able to enter
your ideas from a small-screen device. While the original site works with a
mobile device, it would be great to optimize the experience.</p>

<ul>
<li>You are able to add, view, and edit ideas easily through a mobile browser.</li>
</ul>

<h3>Searching for Idea</h3>

<p>After creating so many ideas it becomes hard to manage all the ideas. It would
be great if you could search for a specific idea based on a word or phrase
contained within an idea.</p>

<ul>
<li>The main index page has a search field</li>
<li>The search field allows you to specify a phrase.</li>
<li>A phrase is a word or or fragment sentence</li>
<li>When search is initiated the contents of the search field will be used to
find only the ideas with that contain the phrase, case insensitive, provided
within the search field.</li>
</ul>

<h3>Fuel</h3>

<p>With your defined ideas it would be great to start adding more details and
resources for each of those ideas.</p>

<ul>
<li>For each idea you can add a new resource</li>
<li>A resource is text or link related to the idea</li>
<li>You are not able to see the resources of an idea on the index page</li>
<li>You are able to view all the resources for an idea when you view the details
of an idea.</li>
</ul>

<h3>Haml</h3>

<p>You have templated your application with ERB. It might be interesting to see
what it would look like using Haml.</p>

<ul>
<li>Replace all the <em>erb</em> templates with <em>haml</em> templates.</li>
</ul>

<h3>Image Upload</h3>

<p>Pictures are worth a 1000 words.</p>

<ul>
<li>When you create an idea you can specify an image</li>
<li>When you create a resource for an idea you can specify an image</li>
<li>You are able to upload an image that will be associated with the idea</li>
<li>When viewing an idea the image is displayed within the idea</li>
<li>When viewing a resource the image is displayed within that resource</li>
</ul>

<h3>Sound Upload</h3>

<p>The power of the spoken word</p>

<ul>
<li>When you create an idea you can specify an sound</li>
<li>When you create a resource for an idea you can specify an sound</li>
<li>When viewing an idea the sound is displayed as a downloadable link</li>
<li>When viewing a resource the sound is displayed as a downloadable link</li>
</ul>

<h3>SMS Integration</h3>

<p>Faster than even a mobile website might be the ability to define ideas through
text message.</p>

<ul>
<li>You able to text a new idea to a particular phone number</li>
<li>The message from the text appear in your list of ideas</li>
</ul>

<h3>Users</h3>

<p>Currently you can only track the ideas of one person. What would help you to
generate ideas is if you could take idea generation socially</p>

<ul>
<li>A person is able to generate a user account</li>
<li>A user account has a username</li>
<li>When viewing a user&#8217;s page you are only able to the ideas for that user</li>
<li>When viewing a user&#8217;s page you are able to add ideas as previously defined</li>
</ul>
<blockquote>
<p>At the moment we are not going to discuss the policies for good password
creation and rentention or maintaining a logged in user. The idea of a
user in this implementation simply allows you to segment the ideas across
users. Any person viewing a user&#8217;s page can add a new idea for that user.</p>
</blockquote>
    
    
      <footer>
        
        
          <div class="sharing">
  
  
</div>

        
      </footer>
    
  </article>


</div>


  <span class="toggle-sidebar"></span>

<aside class="sidebar">
  <div> </div>
</aside>

<script src="/javascripts/sidebar.js" type="text/javascript"> </script>


    </div>

    <div class="footer">
  <p>
    All materials licensed <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0</a>&nbsp;
    <img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" />
  </p>
</div>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-42709122-1', 'jumpstartlab.com');
ga('send', 'pageview');
</script>
  </div>

  


  <div class="slide-out-div">
  <a class="handle" href="#">Feedback</a>
  <h3>Have Feedback?</h3>
  <p>Did you find an error? Something confusing? We'd love your help:</p>
  <ul>
    <li><a href="#" id="edit_source">Edit the source code of this page directly on GitHub</a></li>
    <li><a href="https://github.com/JumpstartLab/curriculum/issues">Create a new issue on the project's GitHub page</a></li>
  </ul>
  <p>Thanks!</p>
</div>

<script>
  $(function(){
    var pathname = window.location.pathname.replace( ".html", ".markdown" );
    var github_url = "https://github.com/JumpstartLab/curriculum/blob/master/source" + pathname;
    $("a#edit_source").attr('href', github_url);
  });
</script>

</body>
</html>
