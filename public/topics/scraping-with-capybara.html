
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Scraping data with Capybara - Jumpstart Lab Curriculum</title>
  <meta name="author" content="Jumpstart Lab">

  
  <meta name="description" content="Scraping data with Capybara                              When you would like to retrieve data from a website,you &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tutorials.jumpstartlab.com/topics/scraping-with-capybara.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet" type="text/css">

  <link href="/atom.xml" rel="alternate" title="Jumpstart Lab Curriculum" type="application/atom+xml">

  <!-- TAB SLIDE OUT -->
  <script src="/javascripts/jquery-1.3.2.min.js" type="text/javascript"></script>
  <script src="/javascripts/jquery.tabSlideOut.v1.3.js"></script>

  <!-- SEARCH -->
  <script src="/search.js"></script>

  <script type="text/javascript">
    $(function(){
      $('.slide-out-div').tabSlideOut({
        tabHandle: '.handle',                     //class of the element that will become your tab
        pathToTabImage: '/images/feedback_tabv2.png', //path to the image for the tab //Optionally can be set using css
        imageHeight: '130px',                     //height of tab image           //Optionally can be set using css
        imageWidth: '36px',                       //width of tab image            //Optionally can be set using css
        tabLocation: 'left',                      //side of screen where tab lives, top, right, bottom, or left
        speed: 300,                               //speed of animation
        action: 'click',                          //options: 'click' or 'hover', action to trigger animation
        topPos: '200px',                          //position from the top/ use if tabLocation is left or right
        leftPos: '20px',                          //position from left/ use if tabLocation is bottom or top
        fixedPosition: true                      //options: true makes it stick(fixed position) on scroll
        });
      });
  </script>

  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body  >
  <header role="banner">
    <hgroup>
  <h1>Jumpstart Lab Curriculum</h1>
  
</hgroup>

  </header>

  <nav role="navigation">
    <ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tutorials.jumpstartlab.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>

<ul class="main-navigation">
  <li><a href="/">Curriculum Index</a></li>
  <li><div id="search">
  <form>
    <input type="text" id="st-search-input" class="st-search-input" />
  </form>
</div>
</li>
</ul>
  </nav>

  <div id="main">
    <div id="content">
      <div>
  <article role="article">
    
    
      <header>
        <h1 class="entry-title">
          Scraping data with Capybara
        </h1>
        
      </header>
    
    <p>When you would like to retrieve data from a website,
you can use an API: an Application Programming Interface.
This is a url that emits the data in a paresable format like JSON or XML.
When the program doesn&#8217;t have an API, however, how do you get it?</p>

<h3>Parsing HTML Yourself</h3>

<p>Parsing HTML with regular expressions is a <a href="http://blog.codinghorror.com/parsing-html-the-cthulhu-way/">losing game</a>.
Instead, we&#8217;ll use the industry standard <a href="http://nokogiri.org/">nokogiri</a>.
In many cases, using nokogiri directly is all you need.
Grab the HTML content, get the HTML nodes you want, do your <em>thing</em>.</p>

<h3>Installing Nokogiri</h3>

<p>Install nokogiri from your terminal:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ gem install nokogiri</span></code></pre></td></tr></table></div></figure>

<p>It includes some C code, so it might take a little while to install
(it will say <em>building native extensions</em>).
If there are problems with the gem install,
your development environment isn&#8217;t properly configured.
For instance, you might have an incompatible version of GCC
or be missing some header libraries.
Read through <a href="http://nokogiri.org/tutorials/installing_nokogiri.html">Nokogiri&#8217;s installation instructions</a>
if this is the case.</p>

<h3>An HTML-Nokogiri Experiment</h3>

<p>This is how you&#8217;d get the list of the <em>breaking news</em> links from the Denver post.
Drop this code into a Ruby file and execute it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;nokogiri&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;net/http&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># get the HTML from the website</span>
</span><span class='line'><span class="n">uri</span>  <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s2">&quot;http://www.denverpost.com/frontpage&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">body</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># parse it and use CSS selectors to find all links in list elements</span>
</span><span class='line'><span class="n">document</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</span><span class='line'><span class="n">links</span>    <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">&#39;li a&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># print each interesting looking link</span>
</span><span class='line'><span class="n">links</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">link</span><span class="o">|</span>
</span><span class='line'>  <span class="k">next</span> <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">empty?</span> <span class="o">||</span> <span class="n">link</span><span class="o">[</span><span class="s1">&#39;href&#39;</span><span class="o">].</span><span class="n">empty?</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">link</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;  </span><span class="si">#{</span><span class="n">link</span><span class="o">[</span><span class="s1">&#39;href&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># pry at the bottom so we can play with it</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;pry&quot;</span>
</span><span class='line'><span class="nb">binding</span><span class="o">.</span><span class="n">pry</span>
</span></code></pre></td></tr></table></div></figure>

<p>If you don&#8217;t have pry, install it with</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ gem install pry</span></code></pre></td></tr></table></div></figure>

<h4>What Just Happened</h4>

<p>The program made a URI object to parse our uri (you can think a uri as being the same thing as a url).
Then it made a GET request to that uri to get the page&#8217;s body.
It gives the body to <code>Nokogiri::HTML</code>, which parses the HTML
and gives us back a Nokogiri document, an object we can use to interact with the html.
In this case, we use &quot;css&quot; to give it a css selector that will find all links
inside of list elements.</p>

<p>We also stuck a pry at the bottom so that we can play with those objects if we like.
Maybe we&#8217;d like to see what we can do with a link, we&#8217;ll use Pry&#8217;s <code>ls -v</code> to list out
all the interesting things on it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">link</span> <span class="o">=</span> <span class="n">links</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#(Element:0x3fdb7d741bf0 {</span>
</span><span class='line'>  <span class="nb">name</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="n">attributes</span> <span class="o">=</span> <span class="o">[</span>
</span><span class='line'>    <span class="c1">#(Attr:0x3fdb7df04978 {</span>
</span><span class='line'>      <span class="nb">name</span> <span class="o">=</span> <span class="s2">&quot;href&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;http://www.denverpost.com/news/ci_26538875/colorado-doctors-warn-that-sepsis-can-be-hidden?source=hot-topic-bar&quot;</span>
</span><span class='line'>      <span class="p">})</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>  <span class="n">children</span> <span class="o">=</span> <span class="o">[</span> <span class="c1">#(Text &quot;Hidden Killer&quot;)]</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">ls</span> <span class="o">-</span><span class="n">v</span> <span class="n">link</span>
</span><span class='line'><span class="no">Enumerable</span><span class="c1">#methods:</span>
</span><span class='line'>  <span class="n">all?</span>            <span class="n">count</span>       <span class="n">each_cons</span>         <span class="n">entries</span>     <span class="n">flat_map</span>  <span class="n">lazy</span>     <span class="n">min</span>        <span class="n">one?</span>          <span class="nb">select</span>        <span class="n">take_while</span>
</span><span class='line'>  <span class="n">any?</span>            <span class="n">cycle</span>       <span class="n">each_entry</span>        <span class="n">find</span>        <span class="n">grep</span>      <span class="n">map</span>      <span class="n">min_by</span>     <span class="n">partition</span>     <span class="n">slice_before</span>  <span class="nb">to_a</span>
</span><span class='line'>  <span class="n">chunk</span>           <span class="n">detect</span>      <span class="n">each_slice</span>        <span class="n">find_all</span>    <span class="n">group_by</span>  <span class="n">max</span>      <span class="n">minmax</span>     <span class="n">reduce</span>        <span class="n">sort</span>          <span class="n">to_h</span>
</span><span class='line'>  <span class="n">collect</span>         <span class="n">drop</span>        <span class="n">each_with_index</span>   <span class="n">find_index</span>  <span class="kp">include</span><span class="p">?</span>  <span class="n">max_by</span>   <span class="n">minmax_by</span>  <span class="n">reject</span>        <span class="n">sort_by</span>       <span class="n">zip</span>
</span><span class='line'>  <span class="n">collect_concat</span>  <span class="n">drop_while</span>  <span class="n">each_with_object</span>  <span class="n">first</span>       <span class="n">inject</span>    <span class="n">member?</span>  <span class="n">none?</span>      <span class="n">reverse_each</span>  <span class="n">take</span>
</span><span class='line'><span class="no">Nokogiri</span><span class="o">::</span><span class="no">XML</span><span class="o">::</span><span class="no">Node</span><span class="c1">#methods:</span>
</span><span class='line'>  <span class="o">%</span>                         <span class="n">attribute_nodes</span>         <span class="n">description</span>           <span class="n">internal_subset</span>        <span class="n">node_type</span>                <span class="n">text?</span>
</span><span class='line'>  <span class="o">/</span>                         <span class="n">attribute_with_ns</span>       <span class="n">do_xinclude</span>           <span class="n">key?</span>                   <span class="n">parent</span>                   <span class="n">to_html</span>
</span><span class='line'>  <span class="o">&lt;&lt;</span>                        <span class="n">attributes</span>              <span class="n">document</span>              <span class="n">keys</span>                   <span class="n">parent</span><span class="o">=</span>                  <span class="nb">to_s</span>
</span><span class='line'>  <span class="o">&lt;=&gt;</span>                       <span class="n">before</span>                  <span class="n">document?</span>             <span class="n">last_element_child</span>     <span class="n">parse</span>                    <span class="n">to_str</span>
</span><span class='line'>  <span class="o">==</span>                        <span class="n">blank?</span>                  <span class="nb">dup</span>                   <span class="n">line</span>                   <span class="n">path</span>                     <span class="n">to_xhtml</span>
</span><span class='line'>  <span class="o">&gt;</span>                         <span class="n">canonicalize</span>            <span class="n">each</span>                  <span class="n">matches?</span>               <span class="n">pointer_id</span>               <span class="n">to_xml</span>
</span><span class='line'>  <span class="o">[]</span>                        <span class="n">cdata?</span>                  <span class="n">elem?</span>                 <span class="nb">name</span>                   <span class="n">prepend_child</span>            <span class="n">traverse</span>
</span><span class='line'>  <span class="o">[]=</span>                       <span class="n">child</span>                   <span class="n">element?</span>              <span class="nb">name</span><span class="o">=</span>                  <span class="n">previous</span>                 <span class="n">type</span>
</span><span class='line'>  <span class="n">accept</span>                    <span class="n">children</span>                <span class="n">element_children</span>      <span class="n">namespace</span>              <span class="n">previous</span><span class="o">=</span>                <span class="n">unlink</span>
</span><span class='line'>  <span class="n">add_child</span>                 <span class="n">children</span><span class="o">=</span>               <span class="n">elements</span>              <span class="n">namespace</span><span class="o">=</span>             <span class="n">previous_element</span>         <span class="n">values</span>
</span><span class='line'>  <span class="n">add_namespace</span>             <span class="nb">clone</span>                   <span class="n">encode_special_chars</span>  <span class="n">namespace_definitions</span>  <span class="n">previous_sibling</span>         <span class="n">write_html_to</span>
</span><span class='line'>  <span class="n">add_namespace_definition</span>  <span class="n">comment?</span>                <span class="n">external_subset</span>       <span class="n">namespace_scopes</span>       <span class="n">processing_instruction?</span>  <span class="n">write_to</span>
</span><span class='line'>  <span class="n">add_next_sibling</span>          <span class="n">content</span>                 <span class="n">first_element_child</span>   <span class="n">namespaced_key?</span>        <span class="n">read_only?</span>               <span class="n">write_xhtml_to</span>
</span><span class='line'>  <span class="n">add_previous_sibling</span>      <span class="n">content</span><span class="o">=</span>                <span class="n">fragment</span>              <span class="n">namespaces</span>             <span class="n">remove</span>                   <span class="n">write_xml_to</span>
</span><span class='line'>  <span class="n">after</span>                     <span class="n">create_external_subset</span>  <span class="n">fragment?</span>             <span class="n">native_content</span><span class="o">=</span>        <span class="n">remove_attribute</span>         <span class="n">xml?</span>
</span><span class='line'>  <span class="nb">ancestors</span>                 <span class="n">create_internal_subset</span>  <span class="n">get_attribute</span>         <span class="k">next</span>                   <span class="n">replace</span>                  <span class="n">xpath</span>
</span><span class='line'>  <span class="n">at</span>                        <span class="n">css</span>                     <span class="n">has_attribute?</span>        <span class="k">next</span><span class="o">=</span>                  <span class="n">search</span>
</span><span class='line'>  <span class="n">at_css</span>                    <span class="n">css_path</span>                <span class="n">html?</span>                 <span class="n">next_element</span>           <span class="n">serialize</span>
</span><span class='line'>  <span class="n">at_xpath</span>                  <span class="n">decorate!</span>               <span class="n">inner_html</span>            <span class="n">next_sibling</span>           <span class="n">set_attribute</span>
</span><span class='line'>  <span class="kp">attr</span>                      <span class="n">default_namespace</span><span class="o">=</span>      <span class="n">inner_html</span><span class="o">=</span>           <span class="n">node_name</span>              <span class="n">swap</span>
</span><span class='line'>  <span class="n">attribute</span>                 <span class="n">delete</span>                  <span class="n">inner_text</span>            <span class="n">node_name</span><span class="o">=</span>             <span class="n">text</span>
</span></code></pre></td></tr></table></div></figure>

<p>We see the link has its own <code>css</code> method, so we could run another query from within this node.
And we can see the href attribute, it looks like we get attributes by using bracket notation, like a hash.
This is a great way to play around with a new library and learn about it,</p>

<p>You can check out the <a href="http://nokogiri.org/Nokogiri/XML/Node.html">documentation</a>
to learn more about what you can do with Nokogiri,
but this isn&#8217;t a lesson about Nokogiri, lets get on to Capybara!</p>

<h2>Beyond HTML</h2>

<p>Sometimes, though, websites want you to do pesky things like fill in forms and
follow redirects. Websites check your cookies and store session data, and
Nokogiri isn&#8217;t optimized to handle that sort of thing.</p>

<p>For this, you&#8217;d want a tool that understands these things.
Mechanize is a common library for this, but it just parses html like we did with
Nokogiri, and then makes more get requests when we &quot;click&quot; on a link,
or &quot;submit&quot; a form. It&#8217;s great for this purpose&#8230; except that many webpages
require JavaScript to run correctly, and Nokogiri doesn&#8217;t have a JavaScript
engine in it, it&#8217;s just reflecting on the static structure of the page.</p>

<h3>Phantom.js, Capybara and Poltergeist</h3>

<p>To really interact with the page, we&#8217;d need to be in a browser.
This is what Phantom.js is, a browser like Opera or Firefox,
but it&#8217;s specifically intended to be run by programs. It doesn&#8217;t pop up a
window like the browser you use, it does all the work without ever displaying
the pages.</p>

<p>Capybara provides an interface for interacting with websites from Ruby.
It is specifically intended for testing, but all the functionality it provides
is useful for scraping, too.
It leaves the specifics of how to talk to the website to a &quot;driver&quot;
This allows you to use it with numerous tools, such as rack-test,
Which hooks it into your rack layer, allowing you to navigate your website
Without ever loading a server.</p>

<p>The driver that knows how to talk to Phantom.js is called Poltergeist
So we&#8217;ll use Capybara to navigate the web, click links, and so forth,
like Mechanize, but we&#8217;ll have it use Poltergeist so it does this in Phantom.js,
and we can interact with JavaScript</p>

<h3>Installation</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ brew install phantomjs
</span><span class='line'>$ gem install capybara poltergeist launchy</span></code></pre></td></tr></table></div></figure>

<h3>Setup</h3>

<p>To set these things up, we need to:
* require the gems in order to have the code available
* configure Poltergeist to not blow up on JavaScript errors (aka every website w/ js)
* then tell Capybara to use Poltergeist as its driver
* then get an object from Capybara that we can use to navigate the web (we&#8217;ll name ours &quot;browser&quot;)</p>

<p>Lets save the below code in <code>setup-capybara.rb</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Require the gems</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;capybara/poltergeist&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Configure Poltergeist to not blow up on websites with js errors aka every website with js</span>
</span><span class='line'><span class="c1"># See more options at https://github.com/teampoltergeist/poltergeist#customization</span>
</span><span class='line'><span class="no">Capybara</span><span class="o">.</span><span class="n">register_driver</span> <span class="ss">:poltergeist</span> <span class="k">do</span> <span class="o">|</span><span class="n">app</span><span class="o">|</span>
</span><span class='line'>  <span class="no">Capybara</span><span class="o">::</span><span class="no">Poltergeist</span><span class="o">::</span><span class="no">Driver</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">js_errors</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Configure Capybara to use Poltergeist as the driver</span>
</span><span class='line'><span class="no">Capybara</span><span class="o">.</span><span class="n">default_driver</span> <span class="o">=</span> <span class="ss">:poltergeist</span>
</span></code></pre></td></tr></table></div></figure>

<p>And then we&#8217;ll load it up in pry and open Capybara&#8217;s documentation with it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">pry</span> <span class="o">-</span><span class="n">r</span> <span class="s1">&#39;./setup-capybara.rb&#39;</span>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="c1"># The object we&#39;ll interact with</span>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">browser</span> <span class="o">=</span> <span class="no">Capybara</span><span class="o">.</span><span class="n">current_session</span>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="c1"># Go to a web page (first request will take a bit)</span>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/jnicklas/capybara&quot;</span>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">browser</span><span class="o">.</span><span class="n">visit</span> <span class="n">url</span>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="c1"># Save the page locally, and open it (this is what Launchy does)</span>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">browser</span><span class="o">.</span><span class="n">save_and_open_page</span>
</span></code></pre></td></tr></table></div></figure>

<p>And now lets head over to the Denver Post and try getting the information we previously had.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">pry</span><span class="o">&gt;</span> <span class="n">ls</span> <span class="o">-</span><span class="n">v</span> <span class="n">browser</span>
</span><span class='line'><span class="c1"># ...</span>
</span><span class='line'><span class="no">Capybara</span><span class="o">::</span><span class="no">Session</span><span class="c1">#methods:</span>
</span><span class='line'>  <span class="n">accept_alert</span>          <span class="n">dismiss_prompt</span>         <span class="n">has_no_link?</span>             <span class="n">save_and_open_page</span>
</span><span class='line'>  <span class="n">accept_confirm</span>        <span class="n">document</span>               <span class="n">has_no_select?</span>           <span class="n">save_and_open_screenshot</span>
</span><span class='line'>  <span class="n">accept_prompt</span>         <span class="n">driver</span>                 <span class="n">has_no_selector?</span>         <span class="n">save_page</span>
</span><span class='line'>  <span class="n">all</span>                   <span class="n">evaluate_script</span>        <span class="n">has_no_table?</span>            <span class="n">save_screenshot</span>
</span><span class='line'>  <span class="n">app</span>                   <span class="n">execute_script</span>         <span class="n">has_no_text?</span>             <span class="nb">select</span>
</span><span class='line'>  <span class="n">assert_no_selector</span>    <span class="n">field_labeled</span>          <span class="n">has_no_title?</span>            <span class="n">server</span>
</span><span class='line'>  <span class="n">assert_no_text</span>        <span class="n">fill_in</span>                <span class="n">has_no_unchecked_field?</span>  <span class="n">source</span>
</span><span class='line'>  <span class="n">assert_no_title</span>       <span class="n">find</span>                   <span class="n">has_no_xpath?</span>            <span class="n">status_code</span>
</span><span class='line'>  <span class="n">assert_selector</span>       <span class="n">find_button</span>            <span class="n">has_select?</span>              <span class="n">switch_to_window</span>
</span><span class='line'>  <span class="n">assert_text</span>           <span class="n">find_by_id</span>             <span class="n">has_selector?</span>            <span class="n">synchronized</span>
</span><span class='line'>  <span class="n">assert_title</span>          <span class="n">find_field</span>             <span class="n">has_table?</span>               <span class="n">synchronized</span><span class="o">=</span>
</span><span class='line'>  <span class="n">attach_file</span>           <span class="n">find_link</span>              <span class="n">has_text?</span>                <span class="n">text</span>
</span><span class='line'>  <span class="n">body</span>                  <span class="n">first</span>                  <span class="n">has_title?</span>               <span class="n">title</span>
</span><span class='line'>  <span class="n">check</span>                 <span class="n">go_back</span>                <span class="n">has_unchecked_field?</span>     <span class="n">uncheck</span>
</span><span class='line'>  <span class="n">choose</span>                <span class="n">go_forward</span>             <span class="n">has_xpath?</span>               <span class="n">unselect</span>
</span><span class='line'>  <span class="n">cleanup!</span>              <span class="n">has_button?</span>            <span class="n">html</span>                     <span class="n">visit</span>
</span><span class='line'>  <span class="n">click_button</span>          <span class="n">has_checked_field?</span>     <span class="nb">inspect</span>                  <span class="n">window_opened_by</span>
</span><span class='line'>  <span class="n">click_link</span>            <span class="n">has_content?</span>           <span class="n">mode</span>                     <span class="n">windows</span>
</span><span class='line'>  <span class="n">click_link_or_button</span>  <span class="n">has_css?</span>               <span class="n">open_new_window</span>          <span class="n">within</span>
</span><span class='line'>  <span class="n">click_on</span>              <span class="n">has_field?</span>             <span class="n">query</span>                    <span class="n">within_fieldset</span>
</span><span class='line'>  <span class="n">current_host</span>          <span class="n">has_link?</span>              <span class="n">raise_server_error!</span>      <span class="n">within_frame</span>
</span><span class='line'>  <span class="n">current_path</span>          <span class="n">has_no_button?</span>         <span class="n">refute_selector</span>          <span class="n">within_table</span>
</span><span class='line'>  <span class="n">current_scope</span>         <span class="n">has_no_checked_field?</span>  <span class="n">reset!</span>                   <span class="n">within_window</span>
</span><span class='line'>  <span class="n">current_url</span>           <span class="n">has_no_content?</span>        <span class="n">reset_session!</span>
</span><span class='line'>  <span class="n">current_window</span>        <span class="n">has_no_css?</span>            <span class="n">resolve</span>
</span><span class='line'>  <span class="n">dismiss_confirm</span>       <span class="n">has_no_field?</span>          <span class="n">response_headers</span>
</span><span class='line'><span class="n">instance</span> <span class="n">variables</span><span class="p">:</span> <span class="vi">@app</span>  <span class="vi">@document</span>  <span class="vi">@driver</span>  <span class="vi">@mode</span>  <span class="vi">@scopes</span>  <span class="vi">@server</span>  <span class="vi">@synchronized</span>  <span class="vi">@touched</span>
</span></code></pre></td></tr></table></div></figure>

<p>Looks like there are some good methods available to us. Methods to <code>click_on</code> things,
<code>fill_in</code> forms (I would assume), a <code>go_back</code> method, that&#8217;s probably like our
back button in the browser. Oh,<code>current_url</code> looks like it should tell us where
we are, lets try that.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">browser</span><span class="o">.</span><span class="n">current_url</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;http://www.denverpost.com/frontpage&quot;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Yep! Oh, and that <code>all</code> looks promising, lets try and use it like we did with Nokogiri&#8217;s <code>css</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">pry</span><span class="o">&gt;</span> <span class="n">links</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">all</span> <span class="s1">&#39;li a&#39;</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;Capybara::Element tag=&quot;a&quot;&gt;, ...</span>
</span><span class='line'>
</span><span class='line'><span class="n">pry</span> <span class="o">&gt;</span> <span class="n">links</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;Capybara::Element tag=&quot;a&quot;&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Great, and now what can we do with a link?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">ls</span> <span class="o">-</span><span class="n">v</span> <span class="n">links</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'><span class="c1"># ...</span>
</span><span class='line'><span class="no">Capybara</span><span class="o">::</span><span class="no">Node</span><span class="o">::</span><span class="no">Finders</span><span class="c1">#methods:</span>
</span><span class='line'>  <span class="n">all</span>  <span class="n">field_labeled</span>  <span class="n">find</span>  <span class="n">find_button</span>  <span class="n">find_by_id</span>  <span class="n">find_field</span>  <span class="n">find_link</span>  <span class="n">first</span>
</span><span class='line'><span class="no">Capybara</span><span class="o">::</span><span class="no">Node</span><span class="o">::</span><span class="no">Actions</span><span class="c1">#methods:</span>
</span><span class='line'>  <span class="n">attach_file</span>  <span class="n">choose</span>        <span class="n">click_link</span>            <span class="n">click_on</span>  <span class="nb">select</span>   <span class="n">unselect</span>
</span><span class='line'>  <span class="n">check</span>        <span class="n">click_button</span>  <span class="n">click_link_or_button</span>  <span class="n">fill_in</span>   <span class="n">uncheck</span>
</span><span class='line'><span class="no">Capybara</span><span class="o">::</span><span class="no">Node</span><span class="o">::</span><span class="no">Matchers</span><span class="c1">#methods:</span>
</span><span class='line'>  <span class="o">==</span>                  <span class="n">has_css?</span>               <span class="n">has_no_link?</span>             <span class="n">has_selector?</span>
</span><span class='line'>  <span class="n">assert_no_selector</span>  <span class="n">has_field?</span>             <span class="n">has_no_select?</span>           <span class="n">has_table?</span>
</span><span class='line'>  <span class="n">assert_no_text</span>      <span class="n">has_link?</span>              <span class="n">has_no_selector?</span>         <span class="n">has_text?</span>
</span><span class='line'>  <span class="n">assert_selector</span>     <span class="n">has_no_button?</span>         <span class="n">has_no_table?</span>            <span class="n">has_unchecked_field?</span>
</span><span class='line'>  <span class="n">assert_text</span>         <span class="n">has_no_checked_field?</span>  <span class="n">has_no_text?</span>             <span class="n">has_xpath?</span>
</span><span class='line'>  <span class="n">has_button?</span>         <span class="n">has_no_content?</span>        <span class="n">has_no_unchecked_field?</span>  <span class="n">refute_selector</span>
</span><span class='line'>  <span class="n">has_checked_field?</span>  <span class="n">has_no_css?</span>            <span class="n">has_no_xpath?</span>
</span><span class='line'>  <span class="n">has_content?</span>        <span class="n">has_no_field?</span>          <span class="n">has_select?</span>
</span><span class='line'><span class="no">Capybara</span><span class="o">::</span><span class="no">Node</span><span class="o">::</span><span class="no">Base</span><span class="c1">#methods: base  find_css  find_xpath  parent  session  synchronize</span>
</span><span class='line'><span class="no">Capybara</span><span class="o">::</span><span class="no">Node</span><span class="o">::</span><span class="no">Element</span><span class="c1">#methods:</span>
</span><span class='line'>  <span class="o">[]</span>             <span class="n">click</span>         <span class="n">drag_to</span>  <span class="n">native</span>  <span class="n">right_click</span>    <span class="n">set</span>       <span class="n">trigger</span>          <span class="n">visible?</span>
</span><span class='line'>  <span class="n">allow_reload!</span>  <span class="n">disabled?</span>     <span class="n">hover</span>    <span class="n">path</span>    <span class="n">select_option</span>  <span class="n">tag_name</span>  <span class="n">unselect_option</span>
</span><span class='line'>  <span class="n">checked?</span>       <span class="n">double_click</span>  <span class="nb">inspect</span>  <span class="n">reload</span>  <span class="n">selected?</span>      <span class="n">text</span>      <span class="n">value</span>
</span><span class='line'><span class="n">instance</span> <span class="n">variables</span><span class="p">:</span> <span class="vi">@base</span>  <span class="vi">@parent</span>  <span class="vi">@query</span>  <span class="vi">@session</span>
</span></code></pre></td></tr></table></div></figure>

<p>Hmm, a <code>text</code> method, a <code>value</code> method, both of those look promising.
Oh, and brackets, too. Lets try them out.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">links</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">text</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;News&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">links</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">value</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kp">nil</span>
</span><span class='line'>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">links</span><span class="o">.</span><span class="n">first</span><span class="o">[</span><span class="s1">&#39;href&#39;</span><span class="o">]</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;http://www.denverpost.com/breakingnews&quot;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Okay, so value isn&#8217;t interesting, but text is, and we seem to be able
to access the element&#8217;s attributes with brackets like we could do with Nokogiri.</p>

<p>Lets try clicking that link. Notice in the methods it got from
<code>Capybara::Node::Actions</code> that we have a <code>click_link</code> method,
and down on the element, we have a <code>click</code> method. Lets try those out.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">links</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">click_link</span>
</span><span class='line'><span class="no">ArgumentError</span><span class="p">:</span> <span class="n">wrong</span> <span class="n">number</span> <span class="n">of</span> <span class="n">arguments</span> <span class="p">(</span><span class="mi">0</span> <span class="k">for</span> <span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'><span class="n">from</span><span class="sr"> /Users/</span><span class="n">josh</span><span class="o">/.</span><span class="n">gem</span><span class="o">/</span><span class="n">ruby</span><span class="o">/</span><span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">1</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">capybara</span><span class="o">-</span><span class="mi">2</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="mi">1</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">capybara</span><span class="o">/</span><span class="n">node</span><span class="o">/</span><span class="n">actions</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">26</span><span class="ss">:in</span> <span class="sb">`click_link</span>
</span><span class='line'>
</span><span class='line'><span class="sb">pry(main)&gt; links.first.click</span>
</span><span class='line'><span class="sb">=&gt; {&quot;status&quot;=&gt;&quot;success&quot;}</span>
</span><span class='line'>
</span><span class='line'><span class="sb">pry(main)&gt; browser.current_url</span>
</span><span class='line'><span class="sb">=&gt; &quot;http://www.denverpost.com/breakingnews&quot;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Okay, so we followed the link! Oh, but I forgot to print the links on the last
page. Remember that <code>go_back</code> method? lets try that out now.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">browser</span><span class="o">.</span><span class="n">current_url</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;http://www.denverpost.com/breakingnews&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">browser</span><span class="o">.</span><span class="n">go_back</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">browser</span><span class="o">.</span><span class="n">current_url</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;http://www.denverpost.com/frontpage&quot;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Great, we&#8217;re back, now lets print the text and href:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">browser</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="s1">&#39;li a&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;Capybara::Element tag=&quot;a&quot;&gt;, ...</span>
</span><span class='line'>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">browser</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="s1">&#39;li a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">class</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Capybara</span><span class="o">::</span><span class="no">Result</span>
</span><span class='line'>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">browser</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="s1">&#39;li a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">ancestors</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="o">[</span><span class="no">Capybara</span><span class="o">::</span><span class="no">Result</span><span class="p">,</span>
</span><span class='line'> <span class="no">Enumerable</span><span class="p">,</span>
</span><span class='line'> <span class="no">Object</span><span class="p">,</span>
</span><span class='line'> <span class="no">JSON</span><span class="o">::</span><span class="no">Ext</span><span class="o">::</span><span class="no">Generator</span><span class="o">::</span><span class="no">GeneratorMethods</span><span class="o">::</span><span class="no">Object</span><span class="p">,</span>
</span><span class='line'> <span class="no">PP</span><span class="o">::</span><span class="no">ObjectMixin</span><span class="p">,</span>
</span><span class='line'> <span class="no">Kernel</span><span class="p">,</span>
</span><span class='line'> <span class="no">BasicObject</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>

<p>So, it gives me back a <code>Capybara::Result</code>, but notice that we inherit from
Enumerable. I know how to deal with Enumerable!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">browser</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="s1">&#39;li a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">a</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;  </span><span class="si">#{</span><span class="n">a</span><span class="o">[</span><span class="s1">&#39;href&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="no">News</span>
</span><span class='line'>  <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">www</span><span class="o">.</span><span class="n">denverpost</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">breakingnews</span>
</span><span class='line'>
</span><span class='line'><span class="no">Sports</span>
</span><span class='line'>  <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">www</span><span class="o">.</span><span class="n">denverpost</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">sports</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># ...</span>
</span></code></pre></td></tr></table></div></figure>

<p>Great, we did it!
The real power of Capybara becomes apparent when you need to fill in forms,
follow redirects, be authenticated, upload files and all that jazz.</p>

<h3>What About Filling In Forms and Logging In?</h3>

<p>Capybara is able to do more than request a page and look at its links.
It can fill in forms, too!
When you talk to a website, the website sets a header in the HTTP request called a cookie.
The browser then sends this back to the site whenever you interact with it.
This allows the site to set the cookie to be something that allows them to identify you.
Which, in turn, means they can do things like authenticate that you are the user
you say you are, and then store that in a cookie.
If you didn&#8217;t send the cookie back, it would look like you weren&#8217;t logged in.
So for us to crawl sites, we often need to remember the cookies the site has set,
and then re-submit them for all future requests.</p>

<p>If we call our current browsing process a &quot;session&quot;,
then we will want to remember cookies for this session.
Fortunately, Phantom takes care of this for us,
it keeps track of the cookies the website has sent,
for the duration of our session, and continues to re-submit them.
This means that when we fill in a form to log into a website,
we will continue to be logged in.
You can configure Nokogiri, or other web crawling tools to log into your accounts,
and perform tasks for you, collect data for you, whatever it happens to be.</p>

<h3>Lets try it out!</h3>

<p>Lets try submitting that form. I took a look at
<a href="https://github.com/jnicklas/capybara#clicking-links-and-buttons">Capybara&#8217;s readme</a>,
under the sections about clicking links and buttons, and the section about interacting
with forms, and then used my web inspector to dtermine which things I wanted to
fill in and click on.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">browser</span><span class="o">.</span><span class="n">fill_in</span> <span class="s1">&#39;yahooSearchField&#39;</span><span class="p">,</span> <span class="n">with</span><span class="p">:</span> <span class="s1">&#39;ruby&#39;</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">browser</span><span class="o">.</span><span class="n">click_on</span> <span class="s1">&#39;Go&#39;</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="o">=&gt;</span><span class="mi">983</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="o">=&gt;</span><span class="mi">165</span><span class="p">}}</span>
</span><span class='line'>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">browser</span><span class="o">.</span><span class="n">current_url</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;http://www.denverpost.com/circare/html/gsa_template.jsp?sortBy=mngi&amp;similarTo=&amp;similarType=find&amp;type=any&amp;aff=3&amp;view=entiresitesppublished&amp;query=ruby&amp;searchbutton=Go&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">pry</span> <span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">browser</span><span class="o">.</span><span class="n">save_and_open_page</span>
</span></code></pre></td></tr></table></div></figure>

<h3>Give It A Try</h3>

<p>Our form won&#8217;t require a session, but the process is the same.
We&#8217;re going to give you a list of ISBNs that identify books about Ruby
(for a liberal definition of &quot;Ruby&quot;). Your task is to go to
<a href="http://www.amazon.com">amazon.com</a>, fill the isbn into the form, submit it,
and then extract the data from the resulting page into a format of your choice.</p>

<p>You have completed the task when you can show me a text file with all of the data.
You can verify your data against <a href="https://gist.githubusercontent.com/JoshCheek/1ef1c6fbe7ff7ee28de4/raw/4637ee480fad96f2808583e04d7c9b74e90da492/books_selected#">this list</a>.</p>

<p>Here are the ISBNS:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">1405232501</span> <span class="mi">082172388</span><span class="n">X</span> <span class="mo">076422222</span><span class="mi">8</span>
</span><span class='line'><span class="mo">05</span><span class="mi">90474235</span> <span class="mo">0672320</span><span class="mi">835</span> <span class="mo">043</span><span class="mi">9539439</span>
</span><span class='line'><span class="mo">0375434461</span> <span class="mo">0752</span><span class="mi">859978</span> <span class="mo">0752</span><span class="mi">860224</span>
</span><span class='line'><span class="mi">2745945475</span> <span class="mo">0425032337</span> <span class="mo">07445</span><span class="mi">9040</span><span class="n">X</span>
</span><span class='line'><span class="mi">1860393225</span> <span class="mi">1405232501</span> <span class="mi">082172388</span><span class="n">X</span>
</span><span class='line'><span class="mo">07642</span><span class="mi">90762</span> <span class="mo">05</span><span class="mi">90474235</span> <span class="mo">0672320</span><span class="mi">835</span>
</span><span class='line'><span class="mi">3826672429</span> <span class="mo">0375434461</span> <span class="mo">0752</span><span class="mi">859978</span>
</span><span class='line'><span class="mo">03</span><span class="mi">8079392</span><span class="n">X</span> <span class="mi">2745945475</span> <span class="mo">0425032337</span>
</span><span class='line'><span class="mo">07011</span><span class="mi">84361</span> <span class="mi">1860393225</span> <span class="mo">075</span><span class="mi">8238614</span>
</span><span class='line'><span class="mo">015204</span><span class="mi">9215</span> <span class="mi">3826672429</span> <span class="mi">1921656573</span>
</span><span class='line'><span class="mo">0747203</span><span class="mi">873</span> <span class="mo">07011</span><span class="mi">84361</span> <span class="mo">076422222</span><span class="mi">8</span>
</span><span class='line'><span class="mo">043</span><span class="mi">9539439</span> <span class="mo">015204</span><span class="mi">9215</span> <span class="mo">0752</span><span class="mi">860224</span>
</span><span class='line'><span class="mo">07445</span><span class="mi">9040</span><span class="n">X</span> <span class="mo">0747203</span><span class="mi">873</span> <span class="mo">07642</span><span class="mi">90762</span>
</span><span class='line'><span class="mo">03</span><span class="mi">8079392</span><span class="n">X</span> <span class="mi">1921656573</span> <span class="mo">075</span><span class="mi">8238614</span>
</span></code></pre></td></tr></table></div></figure>

<p><a href="http://www.isbnsearch.org/isbn/1860393225">Here</a> is an example.
You should be able to extract the title, isbn10, isbn13, author,
binding, publisher, and published date.</p>

<h3>You Know What You Want To Do&#8230; But How Do You Do It?</h3>

<p>Our pry method works really well, and is usually what I turn to first.
But, docs are good too. The <a href="https://github.com/jnicklas/capybara">Capybara readme</a>
has some great examples. And there is also
<a href="http://rdoc.info/gems/capybara/frames">API documentation</a>
available.</p>

<h3>Things to consider:</h3>

<ul>
<li>How do you want to store the data?</li>
<li>What happens if you get 90% finished with the scraping, and then it blows up for some reason? Maybe you should persist the results ASAP, so you can skip work you&#8217;ve already done when you fix the error and rerun it.</li>
<li>What are things that could break your scraper?</li>
</ul>

<h3>Finished and bored?</h3>

<ul>
<li>Got all the data? Nice. How about reading it in and generating a html page that lists all the books.</li>
<li>Pull down other useful information, as well. How about the image and the relevant links.</li>
</ul>

    
    
      <footer>
        
        
          <div class="sharing">
  
  
</div>

        
      </footer>
    
  </article>


</div>



    </div>

    <div class="footer">
  <p>
    All materials licensed <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0</a>&nbsp;
    <img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" />
  </p>
</div>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-42709122-1', 'jumpstartlab.com');
ga('send', 'pageview');
</script>
  </div>

  


  <div class="slide-out-div">
  <a class="handle" href="#">Feedback</a>
  <h3>Have Feedback?</h3>
  <p>Did you find an error? Something confusing? We'd love your help:</p>
  <ul>
    <li><a href="#" id="edit_source">Edit the source code of this page directly on GitHub</a></li>
    <li><a href="https://github.com/JumpstartLab/curriculum/issues">Create a new issue on the project's GitHub page</a></li>
  </ul>
  <p>Thanks!</p>
</div>

<script>
  $(function(){
    var pathname = window.location.pathname.replace( ".html", ".markdown" );
    var github_url = "https://github.com/JumpstartLab/curriculum/blob/master/source" + pathname;
    $("a#edit_source").attr('href', github_url);
  });
</script>

</body>
</html>
