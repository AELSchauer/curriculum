
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Maximizing Heroku - Jumpstart Lab Curriculum</title>
  <meta name="author" content="Jumpstart Lab">

  
  <meta name="description" content="Salesforce Elevate                                      Maximizing Heroku                              You&#8217;ve gotten an &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tutorials.jumpstartlab.com/paths/elevate/maximizing_heroku.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet" type="text/css">

  <link href="/atom.xml" rel="alternate" title="Jumpstart Lab Curriculum" type="application/atom+xml">

  <!-- TAB SLIDE OUT -->
  <script src="/javascripts/jquery-1.3.2.min.js" type="text/javascript"></script>
  <script src="/javascripts/jquery.tabSlideOut.v1.3.js"></script>

  <!-- SEARCH -->
  <script src="/search.js"></script>

  <script type="text/javascript">
    $(function(){
      $('.slide-out-div').tabSlideOut({
        tabHandle: '.handle',                     //class of the element that will become your tab
        pathToTabImage: '/images/feedback_tabv2.png', //path to the image for the tab //Optionally can be set using css
        imageHeight: '130px',                     //height of tab image           //Optionally can be set using css
        imageWidth: '36px',                       //width of tab image            //Optionally can be set using css
        tabLocation: 'left',                      //side of screen where tab lives, top, right, bottom, or left
        speed: 300,                               //speed of animation
        action: 'click',                          //options: 'click' or 'hover', action to trigger animation
        topPos: '200px',                          //position from the top/ use if tabLocation is left or right
        leftPos: '20px',                          //position from left/ use if tabLocation is bottom or top
        fixedPosition: true                      //options: true makes it stick(fixed position) on scroll
        });
      });
  </script>

  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body  >
  <header role="banner">
    <hgroup>
  <h1>Jumpstart Lab Curriculum</h1>
  
</hgroup>

  </header>

  <nav role="navigation">
    <ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tutorials.jumpstartlab.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>

<ul class="main-navigation">
  <li><a href="/">Curriculum Index</a></li>
  <li><div id="search">
  <form>
    <input type="text" id="st-search-input" class="st-search-input" />
  </form>
</div>
</li>
</ul>
  </nav>

  <div id="main">
    <div id="content">
      <div>
  <article role="article">
    
      
        <a href=/elevate>Salesforce Elevate</a>
      
    
    
      <header>
        <h1 class="entry-title">
          Maximizing Heroku
        </h1>
        
      </header>
    
    <p>You&#8217;ve gotten an application up and running, but how do you make sure it stays up and highly responsive?</p>

<h2>Touring the Web Interface</h2>

<p>A poweruser is going to use Toolbelt to do most everything from the terminal. But there are a lot of things you can do in the web interface. Let&#8217;s take a look at several of them including:</p>

<ul>
<li>scaling dyno numbers and size</li>
<li>browse and manage add-ons</li>
<li>display the deployment history</li>
<li>control who has deployment access</li>
<li>change the name, 404, domain names, and ownership</li>
</ul>

<h2>Scaling Web Dynos</h2>

<p>Even with threading, the traffic a single dyno can serve is limited. The easiest way to scale the number of concurrent requests your application can handle is to increase the number of dynos.</p>

<h3>Through the GUI</h3>

<p>Option one is to use the graphical interface on Heroku.com. You should:</p>

<ul>
<li>Visit <a href="https://dashboard.heroku.com/apps">https://dashboard.heroku.com/apps</a></li>
<li>Click the name of the application you want to manipulate</li>
<li>Under &quot;Dynos&quot;, slide the marker to the right</li>
<li>Click &quot;Apply Changes&quot; (your account will really be debited by the minute)</li>
</ul>

<h3>From the CLI</h3>

<p>Scaling through the GUI is cute, but it&#8217;s not fast and difficult to script. Maybe, for instance, you find that your traffic spikes during certain hours and want to scale up your dynos <em>just for those hours</em>. You could write a script to manipulate the dynos from the command line.</p>

<p>Within your project directory you can check on your current dynos:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
<br><span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>heroku ps</span><span class='line output'>=== web (1X): `target/start -Dhttp.port=${PORT} ${JAVA_OPTS} -DapplyEvolutions.default=true -Ddb.default.driver=org.postgresql.Driver -Ddb.default.url=${DATABASE_URL}`</span><span class='line output'>web.1: up 2014/03/24 19:53:41 (~ 25m ago)</span></code></pre></td></tr></table></div></div>
        </div>

<p>From that we know:</p>

<ul>
<li><code>web (1X)</code> shows that we&#8217;re using Heroku&#8217;s smallest, cheapest dyno type</li>
<li><code>target/start</code> is the actual command that is executed on the dyno</li>
<li><code>web.1</code> tells us that only a single dyno is running</li>
</ul>

<p>From there you can do everything available in the GUI, such as changing the dyno type:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>heroku ps:resize web=2X</span><span class='line output'>Resizing and restarting the specified dynos... done</span><span class='line output'>web dynos now 2X ($0.10/dyno-hour)</span></code></pre></td></tr></table></div></div>
        </div>

<p>And changing the number of dynos up to 8:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>heroku ps:scale web=8</span><span class='line output'>Scaling dynos... done, now running web at 8:2X.web dynos now 2X ($0.10/dyno-hour)</span></code></pre></td></tr></table></div></div>
        </div>

<p>And checking the results with <code>ps</code> again:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
<br><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>heroku ps</span><span class='line output'>=== web (2X): `target/start -Dhttp.port=${PORT} ${JAVA_OPTS} -DapplyEvolutions.default=true -Ddb.default.driver=org.postgresql.Driver -Ddb.default.url=${DATABASE_URL}`</span><span class='line output'>web.1: up 2014/03/20 11:50:59 (~ 1m ago)</span><span class='line output'>web.2: up 2014/03/20 11:51:45 (~ 38s ago)</span><span class='line output'>web.3: up 2014/03/20 11:51:44 (~ 39s ago)</span><span class='line output'>web.4: up 2014/03/20 11:51:45 (~ 38s ago)</span><span class='line output'>web.5: up 2014/03/20 11:51:46 (~ 38s ago)</span><span class='line output'>web.6: up 2014/03/20 11:51:45 (~ 39s ago)</span><span class='line output'>web.7: up 2014/03/20 11:51:45 (~ 39s ago)</span><span class='line output'>web.8: up 2014/03/20 11:51:47 (~ 37s ago)</span></code></pre></td></tr></table></div></div>
        </div>

<p>Now your dynos are twice as powerful, and there are eight times as many of them! Get back to the free settings with:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
<br><span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>heroku ps:resize web=1X</span><span class='line output'>Resizing and restarting the specified dynos... done</span><span class='line output'>web dynos now 1X ($0.05/dyno-hour)</span><span class='line command'>heroku ps:scale web=1</span><span class='line output'>web dynos now 1X ($0.05/dyno-hour)</span><span class='line command'>heroku ps</span><span class='line output'>=== web (1X): `target/start -Dhttp.port=${PORT} ${JAVA_OPTS} -DapplyEvolutions.default=true -Ddb.default.driver=org.postgresql.Driver -Ddb.default.url=${DATABASE_URL}`</span><span class='line output'>web.1: up 2014/03/20 11:55:08 (~ 57s ago)</span></code></pre></td></tr></table></div></div>
        </div>

<h3>Scaling in Action</h3>

<p>In the sample application we&#8217;ve embedded a small test script that will make several requests to your application. Run it like this:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>java generate_requests</span></code></pre></td></tr></table></div></div>
        </div>

<p>And you will see output that starts like this:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line output'>Starting the test.</span><span class='line output'>Request 1 responded after 2.0 seconds</span><span class='line output'>Request 2 responded after 4.0 seconds</span><span class='line output'>Request 3 responded after 6.0 seconds</span><span class='line output'>Request 4 responded after 8.0 seconds</span><span class='line output'>Request 5 responded after 10.0 seconds</span></code></pre></td></tr></table></div></div>
        </div>

<p>Note that the total response time is increasing linearly because the requests are queuing up for the single dyno.</p>

<h4>Parallelizing with Dynos</h4>

<p>Now let&#8217;s ramp up four dynos and see what happens:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>heroku ps:scale web=4</span></code></pre></td></tr></table></div></div>
        </div>

<p>And run the test again:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>java generate_requests</span><span class='line output'>Starting the test.</span><span class='line output'>Request 1 responded after 2.0 seconds</span><span class='line output'>Request 2 responded after 2.0 seconds</span><span class='line output'>Request 3 responded after 2.0 seconds</span><span class='line output'>Request 4 responded after 2.0 seconds</span><span class='line output'>Request 5 responded after 4.0 seconds</span></code></pre></td></tr></table></div></div>
        </div>

<p>Your numbers will vary, but you will see greater variability in the total response time but <em>all</em> of them should be well under the slowest from the first run. Our requests are getting served by multiple dynos, balancing the load.</p>

<h4>Scaling Memory</h4>

<p>It turns out that the end point we&#8217;re hitting makes use of a lot of RAM. Our 1X dynos are struggling. Let&#8217;s scale up the memory available by using a 2X dyno and run the test again:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>heroku ps:size web=2X</span><span class='line command'>java generate_requests</span></code></pre></td></tr></table></div></div>
        </div>

<p>You should observe your responses coming back even faster.</p>

<h2>Using the <code>Procfile</code></h2>

<p>Heroku&#8217;s <em>Cedar</em> stack allows you a lot of flexibility through the <code>Procfile</code>. You can define and name one or more commands that your application should run when deployed. We saw an example of a command to start the Play application earlier.</p>

<h3>A Basic <code>Procfile</code></h3>

<p>Typically this starts with a <code>web</code> server. A <code>web</code> process type for a Play application looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>web: target/start -Dhttp.port=${PORT} ${JAVA_OPTS} -DapplyEvolutions.default=true -Ddb.default.driver=org.postgresql.Driver -Ddb.default.url=${DATABASE_URL}</span></code></pre></td></tr></table></div></figure>

<ul>
<li>The <code>web</code> part defines the name of the process type</li>
<li>The part to the right of the <code>:</code> is what you&#8217;d run from a UNIX terminal to execute the command</li>
<li>Environment variables can be used (like <code>$PORT</code> and <code>$RACK_ENV</code> here)</li>
<li>Runs the command <code>target/start</code></li>
<li>Passes several options from the environment variables (<code>PORT</code>, <code>JAVA_OPTS</code>, <code>DATABASE_URL</code>)</li>
<li>Automatically runs the database &quot;evolutions&quot; if needed</li>
</ul>

<h3>Defining Multiple Process Types</h3>

<p>If you want to run multiple dynos each running the same application, like eight instances of your <code>web</code> process type, then you&#8217;re already done.</p>

<p>Commonly, however, you&#8217;ll want to run multiple <em>different</em> process types. An application, for instance, might want to have 16 dynos running the <code>web</code> process to respond to web requests, then four dynos running as background workers sending email or doing other jobs.</p>

<p>You can define multiple process types in the <code>Procfile</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>web: bundle exec thin start -p $PORT -e $RACK_ENV
</span><span class='line'>worker: bundle exec rake jobs:work</span></code></pre></td></tr></table></div></figure>

<p>Other than <code>web</code> to respond to requests, you can makeup whatever process names are germane to your domain. Whatever name you used can be used from the web interface or CLI to scale dynos up and down.</p>

<h3>References</h3>

<ul>
<li><a href="http://Dev Center.heroku.com/articles/procfile">Procfile configuration options</a> on Heroku&#8217;s Dev Center</li>
</ul>

<h2>Configuration</h2>

<p>Web applications typically rely on some pieces of data that either can&#8217;t or shouldn&#8217;t be stored in the source code. This might include:</p>

<ul>
<li>Resource locations, like the IP address of the database</li>
<li>Security credentials, like OAuth tokens</li>
<li>Execution environment markers, like <em>&quot;production&quot;</em> and <em>&quot;development&quot;</em></li>
</ul>

<p>These bits of data can be stored on Heroku and made available as environment variables.</p>

<h3>Querying the Config</h3>

<p>All apps start out with a default set of variables. From within a Heroku project&#8217;s directory on your local system, run <code>heroku config</code>. The below example is from a Java Play application with some pieces removed for security:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<br><span class='line-number'>&nbsp;</span>
<br><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>heroku config</span><span class='line output'>=== boiling-island-2815 Config Vars</span><span class='line output'>DATABASE_URL:               postgres://username:password@ec2-54-225-101-119.compute-1.amazonaws.com:5432/d4tstdg3etpui8</span><span class='line output'>HEROKU_POSTGRESQL_JADE_URL: postgres://username:password@ec2-54-225-101-119.compute-1.amazonaws.com:5432/d4tstdg3etpui8</span><span class='line output'>JAVA_OPTS:                  -Xmx384m -Xss512k -XX:+UseCompressedOops</span><span class='line output'>PATH:                       .jdk/bin:.sbt_home/bin:/usr/local/bin:/usr/bin:/bin</span><span class='line output'>REPO:                       /app/.sbt_home/.ivy2/cache</span><span class='line output'>SBT_OPTS:                   -Xmx384m -Xss512k -XX:+UseCompressedOops</span></code></pre></td></tr></table></div></div>
        </div>

<p>Note, particularly, the <code>DATABASE_URL</code> which is the location of the PostgreSQL database provisioned for this application.</p>

<h3>Adding a Value</h3>

<p>Say we now want to store a key named <code>OAUTH_SHARED_SECRET</code> on the server. We use <code>heroku config:add</code>:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>heroku config:add OAUTH_SHARED_SECRET="helloworld"</span><span class='line output'>Setting config vars and restarting boiling-island-2815... done, v8</span><span class='line output'>OAUTH_SHARED_SECRET: helloworld</span></code></pre></td></tr></table></div></div>
        </div>

<p>Then we can query for the defined values again to verify it&#8217;s there:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<br><span class='line-number'>&nbsp;</span>
<br><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>heroku config</span><span class='line output'>=== boiling-island-2815 Config Vars</span><span class='line output'>DATABASE_URL:               postgres://zvxdqpyretrsgk:DNKuFujjxCLKoCV3qQFyH7kz_E@ec2-54-225-101-119.compute-1.amazonaws.com:5432/d4tstdg3etpui8</span><span class='line output'>HEROKU_POSTGRESQL_JADE_URL: postgres://zvxdqpyretrsgk:DNKuFujjxCLKoCV3qQFyH7kz_E@ec2-54-225-101-119.compute-1.amazonaws.com:5432/d4tstdg3etpui8</span><span class='line output'>JAVA_OPTS:                  -Xmx384m -Xss512k -XX:+UseCompressedOops</span><span class='line output'>OAUTH_SHARED_SECRET:        helloworld</span><span class='line output'>PATH:                       .jdk/bin:.sbt_home/bin:/usr/local/bin:/usr/bin:/bin</span><span class='line output'>REPO:                       /app/.sbt_home/.ivy2/cache</span><span class='line output'>SBT_OPTS:                   -Xmx384m -Xss512k -XX:+UseCompressedOops</span></code></pre></td></tr></table></div></div>
        </div>

<h3>Accessing Values in Code</h3>

<p>Defining those pieces of data is only useful if you can access them from your code. Below are examples for both Ruby and Java. The implementation will depend on your language of choice, not Heroku. Typically if you ask for a key that is not defined you&#8217;ll get back an empty string.</p>

<h4>Java</h4>

<p>In Java, accessing environment variables is as easy as calling <code>System.getenv</code> and passing the name of the key:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>heroku run sbt play console</span><span class='line output'>Running `sbt play console` attached to terminal... up, run.2176</span><span class='line output'>Picked up JAVA_TOOL_OPTIONS:  -Djava.rmi.server.useCodebaseOnly=true</span><span class='line output'>Getting org.scala-tools.sbt sbt_2.9.1 0.11.2 ...</span><span class='line output'>...</span><span class='line output'>scala> System.getenv("OAUTH_SHARED_SECRET")</span><span class='line output'>res0: java.lang.String = helloworld</span></code></pre></td></tr></table></div></div>
        </div>

<h3>Considering Security</h3>

<p>Environment variables are an appropriate place to store secure credentials, but you must keep in mind who has read access to them. Any of the following people could read your environment variables:</p>

<ul>
<li>Collaborators on an application</li>
<li>A person who steals your laptop and can login as you and you have no SSH passphrase</li>
<li>A person who accesses your computer while the SSH keychain is unlocked</li>
</ul>

<p>If that&#8217;s a concern, then you can mitigate the issue by reducing deployment access. For instance, you could setup a Continuous Integration server which runs your tests and, if they pass, it deploys the code. The majority of developers wouldn&#8217;t need access to the Heroku application itself, so there&#8217;s less risk.</p>

<h3>References</h3>

<ul>
<li><a href="http://Dev Center.heroku.com/articles/config-vars">Configuration Variables</a> on Heroku&#8217;s Dev Center</li>
</ul>

<h2>Installing an Add-on / Upgrading Your Database</h2>

<p>One of Heroku&#8217;s great strengths is the rich library of add-ons. There are dozen of options available at <a href="https://addons.heroku.com/">https://addons.heroku.com/</a> , giving you everything from data storage to video processing. Many of them can be installed/setup with little or no change to your application code.</p>

<p>Heroku offers <a href="https://addons.heroku.com/#data-stores">many different data storage options</a>, but most applications are centered around PostgreSQL. Let&#8217;s look at how to upgrade to a production-tier Postgres instance using the add-ons system.</p>

<h3>PostgreSQL Levels</h3>

<p>When you provision an application on Heroku it automatically comes with the <strong>Hobby-Dev</strong> level database.</p>

<h4>Hobby-Dev Limitations</h4>

<p>You should be aware that the free Hobby-Dev database has some significant limitations:</p>

<ul>
<li>It allows only 10,000 rows of data in aggregate across all tables</li>
<li>It does not allow for &quot;follower&quot; databases, making backup more complex</li>
<li>Max 20 connections</li>
<li>0mb of RAM</li>
</ul>

<h4>Standard-Yanari</h4>

<p>We&#8217;ll upgrade to the Standard-Yanari level which:</p>

<ul>
<li>Costs $50/month</li>
<li>Unlimited data rows, 64gb total data</li>
<li>Follower databases enabled</li>
<li>Max 60 connections</li>
<li>410mb RAM</li>
</ul>

<p>From there it goes up and up. You can spend $6,000/month on an instance with 68gb of dedicated RAM and support for a terrabyte of data. You can <a href="https://addons.heroku.com/heroku-postgresql">see all the options here</a>.</p>

<h3>Replacement vs Migration</h3>

<p>Let&#8217;s look at how to upgrade an application from the &quot;Hobby Dev&quot; to &quot;Standard Yanari&quot;, the bottom level that Heroku considers &quot;production scale.&quot;</p>

<p>There are different procedures for replacing the database with a new one versus migrating the existing data to a new instance. Let&#8217;s look at the easier of the two, full replacement.</p>

<h3>Checking the Before-State</h3>

<p>Before we start changing things around, let&#8217;s look at the existing application configurations <code>DATABASE_URL</code> and <code>HEROKU_POSTGRESQL</code> keys:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<br><span class='line-number'>&nbsp;</span>
<br></pre></td><td class='code'><pre><code><span class='line output'>heroku config</span><span class='line output'>=== boiling-island-2815 Config Vars</span><span class='line output'>DATABASE_URL:               postgres://username:password@ec2-54-225-101-119.compute-1.amazonaws.com:5432/d4tstdg3etpui8</span><span class='line output'>HEROKU_POSTGRESQL_JADE_URL: postgres://username:password@ec2-54-225-101-119.compute-1.amazonaws.com:5432/d4tstdg3etpui8</span></code></pre></td></tr></table></div></div>
        </div>

<p>When we add a new database that <code>JADE</code> URL will stick around. This allows us to connect to the old database, in this case a free instance, if we wanted to access old data.</p>

<p>If, however, the old database were a paid plan, we&#8217;d keep getting charged until it&#8217;s deprovisioned.</p>

<h3>Using <code>pg:info</code></h3>

<p>The key name is a random color and doesn&#8217;t tell you anything about what actual database type is at that address. For much more useful information, we can use <code>pg:info</code>:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>heroku pg:info</span><span class='line output'>=== HEROKU_POSTGRESQL_JADE_URL (DATABASE_URL)</span><span class='line output'>Plan:        Dev</span><span class='line output'>Status:      available</span><span class='line output'>Connections: 5</span><span class='line output'>PG Version:  9.3.3</span><span class='line output'>Created:     2014-03-26 03:19 UTC</span><span class='line output'>Data Size:   6.7 MB</span><span class='line output'>Tables:      3</span><span class='line output'>Rows:        574/10000 (In compliance)</span><span class='line output'>Fork/Follow: Unsupported</span><span class='line output'>Rollback:    Unsupported</span></code></pre></td></tr></table></div></div>
        </div>

<p>If your application had more than one PostgreSQL database then there&#8217;d be more than one listing here.</p>

<h3>Provisioning</h3>

<p>To add the new database instance we just need a single instruction:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>heroku addons:add heroku-postgresql:standard-yanari</span><span class='line output'>Adding heroku-postgresql:standard-yanari on boiling-island-2815... done, v9 ($50/mo)</span><span class='line output'>Attached as HEROKU_POSTGRESQL_ROSE_URL</span><span class='line output'>The database should be available in 3-5 minutes.</span><span class='line output'>! The database will be empty. If upgrading, you can transfer</span><span class='line output'>! data from another database with pgbackups:restore.</span><span class='line output'>Use `heroku pg:wait` to track status.</span><span class='line output'>Use `heroku addons:docs heroku-postgresql` to view documentation.</span></code></pre></td></tr></table></div></div>
        </div>

<p>As instructed, you can run <code>heroku pg:wait</code> which will hang until the new instance is ready.</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>heroku pg:wait</span><span class='line output'>Waiting for database HEROKU_POSTGRESQL_ROSE_URL... available</span></code></pre></td></tr></table></div></div>
        </div>

<p>Now you&#8217;re ready to actually use it.</p>

<h3>Configuring</h3>

<p>Your application, either through the <code>Procfile</code> or code itself, should be relying on the <code>DATABASE_URL</code> environment variable. Therefore, using this database should be as easy as:</p>

<ul>
<li>Change the <code>DATABASE_URL</code> variable to the newly provisioned instance</li>
<li>Restart the application</li>
<li>Run any data migrations / evolutions</li>
</ul>

<h4>Change the <code>DATABASE_URL</code></h4>

<p>If you run <code>heroku config</code> again, you&#8217;ll see the new database location defined:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<br><span class='line-number'>&nbsp;</span>
<br><span class='line-number'>&nbsp;</span>
<br></pre></td><td class='code'><pre><code><span class='line command'>heroku config</span><span class='line output'>=== boiling-island-2815 Config Vars</span><span class='line output'>DATABASE_URL:               postgres://username:password@ec2-54-225-101-119.compute-1.amazonaws.com:5432/d4tstdg3etpui8</span><span class='line output'>HEROKU_POSTGRESQL_JADE_URL: postgres://username:password@ec2-54-225-101-119.compute-1.amazonaws.com:5432/d4tstdg3etpui8</span><span class='line output'>HEROKU_POSTGRESQL_ROSE_URL: postgres://username:password@ec2-54-83-63-243.compute-1.amazonaws.com:5542/d4bibagdniev3f</span></code></pre></td></tr></table></div></div>
        </div>

<p>Then <code>unset</code> the <code>DATABASE_URL</code>&#8230;</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>heroku config:unset DATABASE_URL</span><span class='line output'>Unsetting DATABASE_URL and restarting boiling-island-2815... done, v10</span></code></pre></td></tr></table></div></div>
        </div>

<p>And set it using the value of <code>HEROKU_POSTGRESQL_ROSE_URL</code> from above:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<br><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<br></pre></td><td class='code'><pre><code><span class='line command'>heroku config:set DATABASE_URL=postgres://username:password@ec2-54-83-63-243.compute-1.amazonaws.com:5542/d4bibagdniev3f</span><span class='line output'>Setting config vars and restarting boiling-island-2815... done, v11</span><span class='line output'>DATABASE_URL: postgres://username:password@ec2-54-83-63-243.compute-1.amazonaws.com:5542/d4bibagdniev3f</span></code></pre></td></tr></table></div></div>
        </div>

<h4>Migrating / Evolving</h4>

<p>At this point you&#8217;ve got a blank database. If you&#8217;re deploying a Rails application, you&#8217;d want to run your migrations:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>heroku run bundle exec rake db:migrate</span></code></pre></td></tr></table></div></div>
        </div>

<p>If you&#8217;re running a Play application with auto-apply evolutions enabled, then they&#8217;ll be run on the first request.</p>

<h3>Deprovisioning</h3>

<p><strong>Please carefully think through what you&#8217;re doing before following these instructions.</strong> If you deprovision a database on Heroku you cannot get the data back.</p>

<p>That production-quality instance we just added upped our bill by $50/month. That far exceed the budget of a little sample application. Let&#8217;s undo it:</p>

<ul>
<li>Change the <code>DATABASE_URL</code> back to the free instance</li>
<li>Remove the Yanari instance</li>
</ul>

<p>It&#8217;s the reverse of what we did before:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>$</span>
<br><span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>heroku config:unset DATABASE_URL</span><span class='line command'>heroku config:set DATABASE_URL=postgres://username:password@ec2-54-225-101-119.compute-1.amazonaws.com:5432/d4tstdg3etpui8</span><span class='line command'>heroku addons:remove heroku-postgresql:standard-yanari</span></code></pre></td></tr></table></div></div>
        </div>

<p>Where the URL in step two was our original <code>HEROKU_POSTGRESQL_JADE_URL</code>.</p>

<p>The add-on removal will ask you for a confirmation. <strong>Consider</strong> that a person who has access to your application could similarly <em>drop the production database</em>.</p>

<h3>References</h3>

<ul>
<li><a href="https://Dev Center.heroku.com/articles/heroku-postgres-plans#hobby-tier">Choosing the Right Heroku PostgreSQL Plan</a></li>
<li><a href="https://Dev Center.heroku.com/articles/heroku-postgres-follower-databases">Creating and Managing Postgres Follower Database</a></li>
</ul>

<h2>Setting Up Custom Domains</h2>

<p>Heroku&#8217;s haiku-inspired generated URLs like <em>&quot;boiling island&quot;</em> are cute, but most of the time you&#8217;ll want to use a custom domain you&#8217;ve purchased elsewhere.</p>

<h3>Adding a Domain Name</h3>

<p>Add the domain names like this:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>heroku domains:add www.example.com</span><span class='line command'>heroku domains:add example.com</span></code></pre></td></tr></table></div></div>
        </div>

<p>Note that, yes, you need both if you want both <a href="http://example.com">http://example.com</a> and <a href="http://www.example.com">http://www.example.com</a> to resolve to your application.</p>

<h3>DNS Configuration</h3>

<p>Your DNS settings are likely controlled by the registrar you used to purchase the domain (like <a href="http://dnsimple.com">http://dnsimple.com</a> or <a href="http://namecheap.com">http://namecheap.com</a>). You&#8217;ve configured Heroku to <strong>listen</strong> for requests to those domains, but you need to configure the DNS server to <strong>send</strong> the traffic to Heroku in the first place.</p>

<p>The exact settings and process will vary per registrar, but essentially you want to create a CNAME record pointing to your application&#8217;s <code>herokuapp</code> URL, like <code>boiling-island-2815.herokuapp.com</code>.</p>

<h3>References</h3>

<ul>
<li><a href="https://Dev Center.heroku.com/articles/custom-domains">Custom Domains</a> on Heroku&#8217;s Dev Center</li>
</ul>

    
      <a class="print-hidden" href=/elevate><< BACK</a>
    
    
      <footer>
        
        
          <div class="sharing">
  
  
</div>

        
      </footer>
    
  </article>


</div>


  <span class="toggle-sidebar"></span>

<aside class="sidebar">
  <div> </div>
</aside>

<script src="/javascripts/sidebar.js" type="text/javascript"> </script>


    </div>

    <div class="footer">
  <p>
    All materials licensed <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0</a>&nbsp;
    <img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" />
  </p>
</div>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-42709122-1', 'jumpstartlab.com');
ga('send', 'pageview');
</script>
  </div>

  


  <div class="slide-out-div">
  <a class="handle" href="#">Feedback</a>
  <h3>Have Feedback?</h3>
  <p>Did you find an error? Something confusing? We'd love your help:</p>
  <ul>
    <li><a href="#" id="edit_source">Edit the source code of this page directly on GitHub</a></li>
    <li><a href="https://github.com/JumpstartLab/curriculum/issues">Create a new issue on the project's GitHub page</a></li>
  </ul>
  <p>Thanks!</p>
</div>

<script>
  $(function(){
    var pathname = window.location.pathname.replace( ".html", ".markdown" );
    var github_url = "https://github.com/JumpstartLab/curriculum/blob/master/source" + pathname;
    $("a#edit_source").attr('href', github_url);
  });
</script>

</body>
</html>
