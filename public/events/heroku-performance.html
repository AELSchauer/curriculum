
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Heroku Performance Workshop - Jumpstart Lab Curriculum</title>
  <meta name="author" content="Jumpstart Lab">

  
  <meta name="description" content="Heroku Performance Workshop                              Instructional ProgramIntroductionTerence Lee and Jeff &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tutorials.jumpstartlab.com/events/heroku-performance.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet" type="text/css">

  <link href="/atom.xml" rel="alternate" title="Jumpstart Lab Curriculum" type="application/atom+xml">

  <!-- TAB SLIDE OUT -->
  <script src="/javascripts/jquery-1.3.2.min.js" type="text/javascript"></script>
  <script src="/javascripts/jquery.tabSlideOut.v1.3.js"></script>

  <!-- SEARCH -->
  <script src="/search.js"></script>

  <script type="text/javascript">
    $(function(){
      $('.slide-out-div').tabSlideOut({
        tabHandle: '.handle',                     //class of the element that will become your tab
        pathToTabImage: '/images/feedback_tabv2.png', //path to the image for the tab //Optionally can be set using css
        imageHeight: '130px',                     //height of tab image           //Optionally can be set using css
        imageWidth: '36px',                       //width of tab image            //Optionally can be set using css
        tabLocation: 'left',                      //side of screen where tab lives, top, right, bottom, or left
        speed: 300,                               //speed of animation
        action: 'click',                          //options: 'click' or 'hover', action to trigger animation
        topPos: '200px',                          //position from the top/ use if tabLocation is left or right
        leftPos: '20px',                          //position from left/ use if tabLocation is bottom or top
        fixedPosition: true                      //options: true makes it stick(fixed position) on scroll
        });
      });
  </script>

  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body  >
  <header role="banner">
    <hgroup>
  <h1>Jumpstart Lab Curriculum</h1>
  
</hgroup>

  </header>

  <nav role="navigation">
    <ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tutorials.jumpstartlab.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>

<ul class="main-navigation">
  <li><a href="/">Curriculum Index</a></li>
  <li><div id="search">
  <form>
    <input type="text" id="st-search-input" class="st-search-input" />
  </form>
</div>
</li>
</ul>
  </nav>

  <div id="main">
    <div id="content">
      <div>
  <article role="article">
    
    
      <header>
        <h1 class="entry-title">
          Heroku Performance Workshop
        </h1>
        
      </header>
    
    <h2>Instructional Program</h2>

<h3>Introduction</h3>

<p>Terence Lee and Jeff Casimir will give a quick introduction to the evening.</p>

<h3>Understanding the Heroku Platform</h3>

<ul>
<li>How a request is served on Heroku</li>
<li>What is a &quot;dyno&quot;?</li>
<li>Why concurrent requests matter</li>
<li>Ceder &amp; Webrick</li>
<li>Understanding a Procfile</li>
<li>Writing and deploying a Procfile</li>
</ul>

<h4>A Standard Procfile</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>web: bundle exec rails server -p $PORT</span></code></pre></td></tr></table></div></figure>

<h4>A Puma Procfile</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>web: bundle exec rails server Puma -p $PORT</span></code></pre></td></tr></table></div></figure>

<h4>Using Foreman Locally</h4>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>gem install foreman</span><span class='line command'>foreman start</span></code></pre></td></tr></table></div></div>
        </div>

<h3>Improving Queries</h3>

<ul>
<li>You develop with insufficient data</li>
<li>Query problems don&#8217;t stand out</li>
<li>Two key problems

<ul>
<li>Search Speed</li>
<li>N+1 Queries</li>
</ul></li>
</ul>

<h4>N + 1 Queries</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span class='line'><span class="n">article</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">count</span>
</span><span class='line'><span class="n">article</span><span class="o">.</span><span class="n">tags</span>
</span><span class='line'><span class="n">article</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">collect</span><span class="p">{</span> <span class="o">|</span><span class="n">tag</span><span class="o">|</span> <span class="n">tag</span><span class="o">.</span><span class="n">articles</span><span class="o">.</span><span class="n">count</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

<ul>
<li>There&#8217;s no global solution for N+1</li>
<li>Memory Cache</li>
<li>Counter Cache</li>
<li>Using <code>.includes</code></li>
</ul>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span class='line'><span class="n">article</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">includes</span><span class="p">(</span><span class="ss">:articles</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Query Speed</h4>

<ul>
<li>Full-table reads are slow</li>
<li>Primary keys, like <code>id</code>, are the main lookup mechanism</li>
<li>The database creates an index on the primary key automatically</li>
<li>But if you use <code>find_by_(X)</code> you need an index</li>
<li>If you use <code>where</code>, you need an index</li>
<li>Creating an index</li>
<li>Creating a compound index</li>
</ul>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">AddIndexes</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">change</span>
</span><span class='line'>    <span class="n">add_index</span> <span class="ss">:articles</span><span class="p">,</span> <span class="ss">:published</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Code Tutorial</h4>

<p><a href="http://tutorials.jumpstartlab.com/topics/performance/queries.html">http://tutorials.jumpstartlab.com/topics/performance/queries.html</a></p>

<h3>Using Caching</h3>

<ul>
<li>Why caching works</li>
<li>Understanding a key-value store</li>
<li>Caching fragments</li>
</ul>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">% cache </span><span class="n">article</span> <span class="k">do</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">  &lt;%= link_to article.title, article_path(article) %&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s1">&#39;tag_list&#39;</span><span class="o">&gt;&lt;%=</span> <span class="n">article</span><span class="o">.</span><span class="n">tag_list</span> <span class="sx">%&gt;&lt;/span&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sx">% end </span><span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<ul>
<li>The expiry problem</li>
<li>Ignore rather than expire</li>
<li>Computing digests</li>
</ul>

<h4>Code Tutorial</h4>

<p><a href="http://tutorials.jumpstartlab.com/topics/performance/caching.html">http://tutorials.jumpstartlab.com/topics/performance/caching.html</a></p>

<h2>Performance Workshop</h2>

<p>During this session you need to put the ideas we&#8217;ve discussed into practice.</p>

<h3>Getting Started</h3>

<p>Clone the repository and install dependencies:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
<span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>git clone https://github.com/jumpstartlab/store_demo</span><span class='line command'>bundle</span></code></pre></td></tr></table></div></div>
        </div>

<p>Then follow the notes and instructions in the <code>README.markdown</code> to finish setup including loading the sample database.</p>

<h3>Running the Tests</h3>

<p>First, run the functional tests to make sure everything is working properly on your system:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>bundle exec rake</span></code></pre></td></tr></table></div></div>
        </div>

<p>Then start the server so it is available at the url you specified in
<code>store_config.rb</code>:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>bundle exec rails server</span></code></pre></td></tr></table></div></div>
        </div>

<p>Then run the performance suite:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>bundle exec rake performance:local</span></code></pre></td></tr></table></div></div>
        </div>

<p>The tests should pass and result in a total runtime number at the end.</p>

<h3>Improving the App</h3>

<p>Let&#8217;s see what we can do to implement the techniques discussed to drive that total suite time down.</p>

<h3>Measuring Results</h3>

<p>The suite should, at first, take about 50 seconds.  </p>

<p>Then see if you can get the total time under:</p>

<ul>
<li>Bronze: 42 seconds</li>
<li>Silver: 30 seconds</li>
<li>Gold: 15 seconds</li>
</ul>

<h2>Sponsors</h2>

<h3>Prize Sponsors</h3>

<p>In addition to Heroku and Jumpstart Lab, we have great prizes from our friends at:</p>

<div style="max-width:300px" >
<img src='http://railscasts.com/assets/railscasts_logo-7101a7cd0a48292a0c07276981855edb.png'/>
</div>

<p>RailsCasts is produced by Ryan Bates (rbates on Twitter and ryanb on GitHub) featuring tips and tricks with Ruby on Rails. The screencasts are short and focus on one technique so you can quickly move on to applying it to your own project. The topics target the intermediate Rails developer, but beginners and experts will get something out of it as well. </p>

<div style="max-width:300px" >
<img src='/images/code-climate-logo.jpg'/>
</div>

<p>Code Climate provides continuous code inspection for your Ruby app, letting you fix quality and security issues before they hit production. </p>

<p>After each Git push, Code Climate analyzes your code to identify changes in quality and surface technical debt hotspots. Urgent notifications are sent immediately via Campfire chat, email or RSS so you can address potential quality issues as soon as they occur.</p>

    
    
      <footer>
        
        
          <div class="sharing">
  
  
</div>

        
      </footer>
    
  </article>


</div>



    </div>

    <div class="footer">
  <p>
    All materials licensed <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0</a>&nbsp;
    <img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" />
  </p>
</div>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-42709122-1', 'jumpstartlab.com');
ga('send', 'pageview');
</script>
  </div>

  


  <div class="slide-out-div">
  <a class="handle" href="#">Feedback</a>
  <h3>Have Feedback?</h3>
  <p>Did you find an error? Something confusing? We'd love your help:</p>
  <ul>
    <li><a href="#" id="edit_source">Edit the source code of this page directly on GitHub</a></li>
    <li><a href="https://github.com/JumpstartLab/curriculum/issues">Create a new issue on the project's GitHub page</a></li>
  </ul>
  <p>Thanks!</p>
</div>

<script>
  $(function(){
    var pathname = window.location.pathname.replace( ".html", ".markdown" );
    var github_url = "https://github.com/JumpstartLab/curriculum/blob/master/source" + pathname;
    $("a#edit_source").attr('href', github_url);
  });
</script>

</body>
</html>
